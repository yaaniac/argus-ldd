<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caso ARG-2025-0043 ¬∑ Argus Back Office</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <script src="client-config.js"></script>
</head>
<body>

<div class="bo-shell">

  <!-- SIDEBAR (identical to dashboard) -->
  <aside class="bo-sidebar" id="sidebar">
    <div class="bo-sidebar-header">
      <div class="bo-logo">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="#0097A7"/>
          <path d="M8 10h16M8 16h10M8 22h13" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/>
          <circle cx="24" cy="22" r="4" fill="#fff"/>
          <path d="M22.5 22l1 1 2-2" stroke="#0097A7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <div class="bo-logo-name">Argus<span style="color:#0097A7">.</span></div>
          <div class="bo-logo-sub" id="sidebar-tenant-label">Back Office</div>
        </div>
      </div>
      <button class="bo-sidebar-toggle" id="sidebarToggleBtn" onclick="toggleSidebar()" aria-label="Colapsar o expandir men√∫">
        <svg class="sidebar-icon-collapse" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M10 3L5 8l5 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <svg class="sidebar-icon-expand" width="16" height="16" viewBox="0 0 16 16" fill="none" style="display:none"><path d="M6 3l5 5-5 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>

    <nav class="bo-nav">
      <div class="bo-nav-section">
        <span class="bo-nav-label">Principal</span>
        <a id="nav-dashboard-link" href="backoffice.html" class="bo-nav-item">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="2" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="10" y="2" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="2" y="10" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="10" y="10" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/></svg>
          <span>Dashboard</span>
        </a>
        <a id="nav-casos-link" href="backoffice.html" class="bo-nav-item active">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M14 3H4a1 1 0 00-1 1v10a1 1 0 001 1h10a1 1 0 001-1V4a1 1 0 00-1-1z" stroke="currentColor" stroke-width="1.5"/><path d="M6 7h6M6 10h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          <span>Casos</span>
        </a>
        <a id="nav-tareas-link" href="backoffice.html" class="bo-nav-item">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M6 9l2 2 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><rect x="2" y="2" width="14" height="14" rx="3" stroke="currentColor" stroke-width="1.5"/></svg>
          <span>Mis tareas</span>
          <span class="bo-badge-count bo-badge-danger">3</span>
        </a>
      </div>

      <div class="bo-nav-section">
        <span class="bo-nav-label">Gesti√≥n</span>
        <a id="nav-comms-link" href="backoffice.html" class="bo-nav-item">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M15 3H3a1 1 0 00-1 1v8a1 1 0 001 1h3l3 3 3-3h3a1 1 0 001-1V4a1 1 0 00-1-1z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
          <span>Comunicaciones</span>
        </a>
        <a id="nav-reportes-link" href="backoffice-reportes.html" class="bo-nav-item">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M3 14V8M7 14V5M11 14V9M15 14V3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
          <span>Reportes</span>
        </a>
      </div>

      <div class="bo-nav-section">
        <span class="bo-nav-label">Sistema</span>
        <a id="nav-auditoria-link" href="backoffice.html" class="bo-nav-item">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2L3 5v5c0 4 2.8 7.3 6 8 3.2-.7 6-4 6-8V5L9 2z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
          <span>Auditor√≠a / Log</span>
        </a>
        <a id="nav-usuarios-link" href="backoffice.html" class="bo-nav-item">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="7" cy="6" r="3" stroke="currentColor" stroke-width="1.5"/><path d="M1 16c0-3.3 2.7-6 6-6h0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><circle cx="13" cy="11" r="3" stroke="currentColor" stroke-width="1.5"/><path d="M10 16h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M13 13.5v5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          <span>Usuarios y roles</span>
        </a>
        <a id="nav-config-link" href="backoffice.html" class="bo-nav-item">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2a1 1 0 011 1v.6a5.5 5.5 0 011.3.75l.52-.3a1 1 0 011.37.37l1 1.73a1 1 0 01-.37 1.37l-.52.3c.04.27.07.54.07.83s-.03.56-.07.83l.52.3a1 1 0 01.37 1.37l-1 1.73a1 1 0 01-1.37.37l-.52-.3A5.5 5.5 0 0110 14.4V15a1 1 0 01-2 0v-.6a5.5 5.5 0 01-1.3-.75l-.52.3a1 1 0 01-1.37-.37l-1-1.73a1 1 0 01.37-1.37l.52-.3A5.6 5.6 0 014.6 9c0-.29.03-.56.07-.83l-.52-.3a1 1 0 01-.37-1.37l1-1.73a1 1 0 011.37-.37l.52.3A5.5 5.5 0 018 3.6V3a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><circle cx="9" cy="9" r="2.2" stroke="currentColor" stroke-width="1.4"/></svg>
          <span>Configuraci√≥n</span>
        </a>
        <a id="nav-portal-link" href="index.html" class="bo-nav-item" target="_blank">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M7 3H3a1 1 0 00-1 1v11a1 1 0 001 1h11a1 1 0 001-1v-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M11 2h5v5M16 2l-7 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Ir al portal</span>
        </a>
        <a href="#" class="bo-nav-item" onclick="event.preventDefault(); gateLogout()" style="color:#F87171">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M7 3H3a1 1 0 00-1 1v10a1 1 0 001 1h4M12 12l3-3-3-3M7 9h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Cambiar empresa</span>
        </a>
      </div>
    </nav>

    <div class="bo-sidebar-user">
      <div class="bo-user-avatar">MA</div>
      <div class="bo-user-info"><strong>Mar√≠a √Ålvarez</strong><span>Compliance Officer</span></div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="bo-main" id="boMain">

    <!-- TOPBAR -->
    <header class="bo-topbar">
      <div class="bo-topbar-left">
        <button class="bo-mobile-menu" onclick="toggleSidebar()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        </button>
        <div class="bo-breadcrumb">
          <a href="backoffice.html" style="color:var(--gray-400)">Dashboard</a>
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M5 3l4 4-4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
          <a href="backoffice.html" style="color:var(--gray-400)">Casos</a>
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M5 3l4 4-4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
          <span id="caseIdBreadcrumb">ARG-2025-0043</span>
        </div>
      </div>
      <div class="bo-topbar-right">
        <div class="bo-notif-btn"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2a5 5 0 015 5v3l2 2H2l2-2V7a5 5 0 015-5z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/><path d="M7 15a2 2 0 004 0" stroke="currentColor" stroke-width="1.5"/></svg><span class="bo-notif-dot"></span></div>
        <div class="bo-topbar-avatar">MA</div>
      </div>
    </header>

    <!-- PAGE -->
    <div class="bo-case-page">

      <!-- ‚ïê‚ïê‚ïê CASE HEADER ‚ïê‚ïê‚ïê -->
      <div class="case-header-bar">
        <div class="case-header-left">
          <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
            <code class="bo-code-lg">ARG-2025-0043</code>
            <span class="risk-tag risk-critical">CR√çTICO</span>
            <span class="status-tag status-investigating" id="caseStatusBadge">Investigando</span>
            <span class="conf-tag">üîí Confidencial</span>
          </div>
          <h1 class="case-title">Fraude financiero ‚Äî Compras a proveedores ficticios</h1>
          <div class="case-meta">
            <span>üìÖ Recibido: 18 feb 2025, 11:23 hs</span>
            <span>¬∑</span>
            <span>üì° Canal: Email</span>
            <span>¬∑</span>
            <span>üë§ An√≥nima</span>
            <span>¬∑</span>
            <span>üè¢ √Årea: Finanzas / Contabilidad</span>
            <span>¬∑</span>
            <span>üåç Argentina</span>
          </div>
        </div>
        <div class="case-header-actions">
          <select class="bo-select" onchange="changeStatus(this.value)">
            <option value="new">Nuevo</option>
            <option value="eval">En evaluaci√≥n</option>
            <option value="investigating" selected>Investigando</option>
            <option value="review">En revisi√≥n legal</option>
            <option value="closed">Cerrar caso</option>
          </select>
          <button class="bo-btn bo-btn-outline" onclick="exportCasoPdf()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M7 1v9M3 6l4 4 4-4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M1 11h12v2H1z" fill="currentColor" opacity=".3"/></svg>
            Exportar PDF
          </button>
          <button class="bo-btn" onclick="exportCasoCsv()" style="background:var(--primary-100);color:var(--primary-800);border:1.5px solid var(--primary-200);font-weight:600">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M2 2h6l4 4v6a1 1 0 01-1 1H3a1 1 0 01-1-1V3a1 1 0 011-1z" stroke="currentColor" stroke-width="1.3"/><path d="M8 2v4h4M4 8h6M4 10.5h4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg>
            Exportar CSV
          </button>
          <button class="bo-btn bo-btn-primary" onclick="openCloseModal()">Resolver caso</button>
        </div>
      </div>

      <!-- SLA BAR -->
      <div class="sla-bar">
        <div class="sla-bar-info">
          <span class="sla-bar-label">SLA: <strong style="color:#EA580C">8 d√≠as restantes</strong> (vence 02/03/2025)</span>
          <span class="sla-bar-label">Inicio: 18/02/2025 ¬∑ Objetivo: 60 d√≠as ¬∑ Transcurridos: 4 d√≠as</span>
        </div>
        <div class="sla-bar-track">
          <div class="sla-bar-fill" style="width:7%;background:var(--primary)"></div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê MAIN GRID ‚ïê‚ïê‚ïê -->
      <div class="case-grid">

        <!-- ‚ïê‚ïê LEFT COLUMN ‚ïê‚ïê -->
        <div class="case-left">

          <!-- TABS -->
          <div class="case-tabs">
            <button class="case-tab active" onclick="switchTab('resumen',this)">Resumen</button>
            <button class="case-tab" onclick="switchTab('investigacion',this)">Investigaci√≥n</button>
            <button class="case-tab" onclick="switchTab('evidencia',this)">Evidencia</button>
            <button class="case-tab" onclick="switchTab('entrevistas',this)">Entrevistas</button>
            <button class="case-tab" onclick="switchTab('comunicacion',this)">Comunicaci√≥n</button>
            <button class="case-tab" onclick="switchTab('log',this)">Log / Auditor√≠a</button>
          </div>

          <!-- TAB: RESUMEN -->
          <div class="tab-panel active" id="tab-resumen">

            <!-- Descripci√≥n -->
            <div class="bo-card">
              <div class="bo-card-header"><h3>Descripci√≥n del hecho</h3></div>
              <div class="case-description">
                <p>El denunciante reporta que el √°rea de Compras habr√≠a aprobado facturas de al menos tres proveedores cuya existencia no puede verificarse en los registros del BCRA ni en el AFIP. Los montos involucrados superar√≠an los $4.200.000 en los √∫ltimos 6 meses. Menciona espec√≠ficamente al Gerente de Compras como posible responsable.</p>
                <p style="margin-top:12px">Los pagos habr√≠an sido aprobados con firmas que no corresponden a los autorizados seg√∫n el manual de poderes vigente. El denunciante indica tener capturas de pantalla de dos transferencias y un contrato con fecha adulterada.</p>
                <div class="case-tags" style="margin-top:16px">
                  <span class="bo-tag">Fraude</span>
                  <span class="bo-tag">Proveedores ficticios</span>
                  <span class="bo-tag">Facturas ap√≥crifas</span>
                  <span class="bo-tag">AML</span>
                  <span class="bo-tag">Firma irregular</span>
                </div>
              </div>
            </div>

            <!-- Personas involucradas -->
            <div class="bo-card">
              <div class="bo-card-header"><h3>Personas involucradas</h3><button class="bo-btn bo-btn-ghost" style="font-size:12px">+ Agregar</button></div>
              <div class="involved-list">
                <div class="involved-item">
                  <div class="involved-avatar" style="background:#FEF2F2;color:#DC2626">LP</div>
                  <div>
                    <strong>Luis Pereyra</strong>
                    <span>Gerente de Compras ¬∑ Principal denunciado</span>
                  </div>
                  <span class="risk-tag risk-high" style="margin-left:auto">ALTO</span>
                </div>
                <div class="involved-item">
                  <div class="involved-avatar" style="background:#FFF7ED;color:#EA580C">VP</div>
                  <div>
                    <strong>Vendedora Proveedora S.A.</strong>
                    <span>Proveedor sospechoso ‚Äî No verificado en AFIP</span>
                  </div>
                  <span class="risk-tag risk-critical" style="margin-left:auto">CR√çTICO</span>
                </div>
                <div class="involved-item">
                  <div class="involved-avatar" style="background:#FFFBEB;color:#D97706">??</div>
                  <div>
                    <strong>Persona sin identificar</strong>
                    <span>Firmante de contratos ‚Äî Identidad a verificar</span>
                  </div>
                  <span class="risk-tag risk-medium" style="margin-left:auto">MEDIO</span>
                </div>
              </div>
            </div>

            <!-- Evaluaci√≥n de riesgo -->
            <div class="bo-card">
              <div class="bo-card-header"><h3>Evaluaci√≥n de riesgo</h3><button class="bo-btn bo-btn-ghost" style="font-size:12px">Editar</button></div>
              <div class="risk-eval-grid">
                <div class="risk-eval-item">
                  <span class="risk-eval-label">Riesgo financiero</span>
                  <div class="risk-eval-bar"><div style="width:85%;background:#DC2626"></div></div>
                  <span class="risk-eval-val">Cr√≠tico</span>
                </div>
                <div class="risk-eval-item">
                  <span class="risk-eval-label">Riesgo reputacional</span>
                  <div class="risk-eval-bar"><div style="width:70%;background:#EA580C"></div></div>
                  <span class="risk-eval-val">Alto</span>
                </div>
                <div class="risk-eval-item">
                  <span class="risk-eval-label">Riesgo legal / regulatorio</span>
                  <div class="risk-eval-bar"><div style="width:60%;background:#D97706"></div></div>
                  <span class="risk-eval-val">Alto</span>
                </div>
                <div class="risk-eval-item">
                  <span class="risk-eval-label">Riesgo de represalias</span>
                  <div class="risk-eval-bar"><div style="width:40%;background:#D97706"></div></div>
                  <span class="risk-eval-val">Medio</span>
                </div>
              </div>
              <div class="risk-eval-notes">
                <strong>Notas del evaluador:</strong>
                <p>Caso con alto impacto financiero potencial. Se requiere intervenci√≥n del √°rea Legal y posible denuncia penal. Verificar en AFIP, BCRA y UIF. Paralizar pagos a proveedores involucrados de forma preventiva.</p>
              </div>
            </div>

          </div><!-- /tab-resumen -->

          <!-- TAB: INVESTIGACI√ìN -->
          <div class="tab-panel" id="tab-investigacion">
            <div class="bo-card">
              <div class="bo-card-header"><h3>Plan de investigaci√≥n</h3><button class="bo-btn bo-btn-ghost" style="font-size:12px">+ Agregar tarea</button></div>
              <div class="inv-tasks">

                <div class="inv-task done">
                  <div class="task-check done">‚úì</div>
                  <div class="task-body">
                    <strong>Evaluaci√≥n de admisibilidad</strong>
                    <p>Revisar si la denuncia entra en el √°mbito del canal y tiene contenido suficiente para investigar.</p>
                    <div class="task-meta"><span>Asignado: M. √Ålvarez</span><span>Completado: 19/02/2025</span></div>
                  </div>
                </div>

                <div class="inv-task done">
                  <div class="task-check done">‚úì</div>
                  <div class="task-body">
                    <strong>Solicitud de documentaci√≥n contable</strong>
                    <p>Requerir al CFO las √≥rdenes de compra, facturas y comprobantes de transferencia de los √∫ltimos 6 meses del √°rea de Compras.</p>
                    <div class="task-meta"><span>Asignado: R. Mendoza</span><span>Completado: 20/02/2025</span></div>
                  </div>
                </div>

                <div class="inv-task in-progress">
                  <div class="task-check in-progress"></div>
                  <div class="task-body">
                    <strong>Verificaci√≥n de proveedores en AFIP / BCRA / UIF</strong>
                    <p>Consultar estado fiscal, habilitaci√≥n y antecedentes de los 3 proveedores mencionados.</p>
                    <div class="task-meta"><span>Asignado: R. Mendoza</span><span class="task-due warn">Vence: 25/02/2025</span></div>
                  </div>
                </div>

                <div class="inv-task in-progress">
                  <div class="task-check in-progress"></div>
                  <div class="task-body">
                    <strong>An√°lisis de firmas y poderes</strong>
                    <p>Cotejar las firmas de los contratos con el manual de poderes vigente. Involucrar a Legal.</p>
                    <div class="task-meta"><span>Asignado: J. Torres</span><span class="task-due warn">Vence: 26/02/2025</span></div>
                  </div>
                </div>

                <div class="inv-task pending">
                  <div class="task-check pending"></div>
                  <div class="task-body">
                    <strong>Entrevista al Gerente de Compras</strong>
                    <p>Entrevista formal con L. Pereyra. Coordinar con RRHH y Legal. Garantizar el debido proceso.</p>
                    <div class="task-meta"><span>Asignado: M. √Ålvarez</span><span class="task-due">Pendiente</span></div>
                  </div>
                </div>

                <div class="inv-task pending">
                  <div class="task-check pending"></div>
                  <div class="task-body">
                    <strong>Informe preliminar de hallazgos</strong>
                    <p>Consolidar evidencias, redactar informe preliminar y elevar a Comit√© de Compliance.</p>
                    <div class="task-meta"><span>Asignado: M. √Ålvarez</span><span class="task-due">Pendiente</span></div>
                  </div>
                </div>

                <div class="inv-task pending">
                  <div class="task-check pending"></div>
                  <div class="task-body">
                    <strong>Decisi√≥n final y medidas correctivas</strong>
                    <p>Definir sanci√≥n, medidas correctivas y posible denuncia penal. Aprobaci√≥n del Directorio.</p>
                    <div class="task-meta"><span>Asignado: Comit√©</span><span class="task-due">Pendiente</span></div>
                  </div>
                </div>

              </div>
            </div>

            <!-- Hallazgos -->
            <div class="bo-card">
              <div class="bo-card-header"><h3>Registro de hallazgos</h3><button class="bo-btn bo-btn-primary" style="font-size:12px" onclick="document.getElementById('newFindingArea').style.display='block'">+ Agregar hallazgo</button></div>
              <div class="findings-list">
                <div class="finding-item">
                  <div class="finding-meta"><strong>R. Mendoza</strong> ¬∑ 20/02/2025 14:10</div>
                  <p>Se verific√≥ que "Vendedora Proveedora S.A." (CUIT 30-99999999-0) no posee alta en AFIP como contribuyente activo. El CUIT corresponde a una empresa dada de baja en 2019.</p>
                  <div style="margin-top:8px"><span class="bo-tag bo-tag-danger">Alta relevancia</span></div>
                </div>
                <div class="finding-item">
                  <div class="finding-meta"><strong>J. Torres</strong> ¬∑ 21/02/2025 09:45</div>
                  <p>Las firmas en los contratos no coinciden con las del manual de poderes. La firma del segundo firmante autorizado no puede ser validada. Se sugiere pericia caligr√°fica.</p>
                  <div style="margin-top:8px"><span class="bo-tag bo-tag-warn">Relevancia media</span></div>
                </div>
              </div>
              <div id="newFindingArea" style="display:none;padding:16px 20px;border-top:1px solid var(--gray-100)">
                <textarea class="bo-textarea" rows="3" placeholder="Describ√≠ el hallazgo, su relevancia y fuente de informaci√≥n..."></textarea>
                <div style="display:flex;gap:8px;margin-top:10px">
                  <select class="bo-select-sm"><option>Alta relevancia</option><option>Relevancia media</option><option>Informativo</option></select>
                  <button class="bo-btn bo-btn-primary" style="font-size:12px">Guardar hallazgo</button>
                  <button class="bo-btn bo-btn-ghost" style="font-size:12px" onclick="document.getElementById('newFindingArea').style.display='none'">Cancelar</button>
                </div>
              </div>
            </div>

            <!-- Recomendaciones -->
            <div class="bo-card">
              <div class="bo-card-header"><h3>An√°lisis y recomendaciones</h3><button class="bo-btn bo-btn-ghost" style="font-size:12px">Editar</button></div>
              <div style="padding:20px">
                <div class="rec-box">
                  <strong>Medidas preventivas inmediatas</strong>
                  <ul>
                    <li>Suspender preventivamente todos los pagos a los proveedores identificados</li>
                    <li>Reasignar a L. Pereyra fuera del √°rea de Compras hasta resoluci√≥n</li>
                    <li>Solicitar bloqueo de acceso al sistema ERP de las cuentas involucradas</li>
                  </ul>
                </div>
                <div class="rec-box" style="margin-top:12px">
                  <strong>Posibles sanciones seg√∫n hallazgos</strong>
                  <ul>
                    <li>Desvinculaci√≥n con causa (si se confirman irregularidades)</li>
                    <li>Denuncia penal por defraudaci√≥n (art. 173 CP)</li>
                    <li>Reporte a UIF si se configura tipolog√≠a de lavado</li>
                  </ul>
                </div>
              </div>
            </div>
          </div><!-- /tab-investigacion -->

          <!-- TAB: EVIDENCIA -->
          <div class="tab-panel" id="tab-evidencia">
            <div class="bo-card">
              <div class="bo-card-header"><h3>Documentos y evidencia</h3>
                <div style="display:flex;gap:8px">
                  <button class="bo-btn bo-btn-outline" style="font-size:12px">Descargar todo (ZIP)</button>
                  <button class="bo-btn bo-btn-primary" style="font-size:12px">+ Subir archivo</button>
                </div>
              </div>
              <div class="evidence-table">
                <div class="evidence-header">
                  <span>Nombre</span><span>Tipo</span><span>Subido por</span><span>Fecha</span><span>Custodia</span><span></span>
                </div>
                <div class="evidence-row">
                  <div class="evidence-name"><span class="file-icon pdf">PDF</span> factura_vendedora_01.pdf</div>
                  <div>Factura</div>
                  <div>R. Mendoza</div>
                  <div>20/02/2025</div>
                  <div><span class="custody-tag">‚úì Verificada</span></div>
                  <div class="evidence-actions"><a href="#" class="bo-link">Ver</a> ¬∑ <a href="#" class="bo-link">Descargar</a></div>
                </div>
                <div class="evidence-row">
                  <div class="evidence-name"><span class="file-icon img">IMG</span> captura_transferencia_1.png</div>
                  <div>Captura</div>
                  <div>Denunciante</div>
                  <div>18/02/2025</div>
                  <div><span class="custody-tag">‚úì Verificada</span></div>
                  <div class="evidence-actions"><a href="#" class="bo-link">Ver</a> ¬∑ <a href="#" class="bo-link">Descargar</a></div>
                </div>
                <div class="evidence-row">
                  <div class="evidence-name"><span class="file-icon doc">DOC</span> contrato_proveedor_2024.docx</div>
                  <div>Contrato</div>
                  <div>R. Mendoza</div>
                  <div>21/02/2025</div>
                  <div><span class="custody-tag pending-c">‚è≥ Pendiente</span></div>
                  <div class="evidence-actions"><a href="#" class="bo-link">Ver</a> ¬∑ <a href="#" class="bo-link">Descargar</a></div>
                </div>
                <div class="evidence-row">
                  <div class="evidence-name"><span class="file-icon xls">XLS</span> ordenes_compra_6m.xlsx</div>
                  <div>Contabilidad</div>
                  <div>M. √Ålvarez</div>
                  <div>21/02/2025</div>
                  <div><span class="custody-tag">‚úì Verificada</span></div>
                  <div class="evidence-actions"><a href="#" class="bo-link">Ver</a> ¬∑ <a href="#" class="bo-link">Descargar</a></div>
                </div>
              </div>
              <div class="bo-upload-zone" onclick="triggerUpload()">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none"><path d="M14 18V10m0 0l-4 4m4-4l4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/><rect x="3" y="19" width="22" height="6" rx="2" stroke="currentColor" stroke-width="1.8"/></svg>
                <p>Arrastr√° archivos o <span style="color:var(--primary);font-weight:600">hac√© clic para subir</span></p>
                <span>PDF, im√°genes, audio, video, documentos ¬∑ M√°x. 50 MB por archivo</span>
              </div>
            </div>
          </div><!-- /tab-evidencia -->

          <!-- TAB: ENTREVISTAS -->
          <div class="tab-panel" id="tab-entrevistas">
            <div class="bo-card">
              <div class="bo-card-header"><h3>Registro de entrevistas</h3><button class="bo-btn bo-btn-primary" style="font-size:12px" onclick="openNuevaEntrevistaModal()">+ Nueva entrevista</button></div>
              <div class="interviews-list">
                <div class="interview-item">
                  <div class="interview-header">
                    <div>
                      <strong>Entrevista #1 ‚Äî Testigo A</strong>
                      <span class="int-tag">Testigo</span>
                    </div>
                    <span style="font-size:12px;color:var(--gray-400)">20/02/2025 ¬∑ Realizada por M. √Ålvarez</span>
                  </div>
                  <p class="interview-summary">El testigo confirm√≥ haber visto facturas inusuales en el sistema durante noviembre y diciembre. Mencion√≥ que L. Pereyra insisti√≥ en procesar los pagos "con urgencia" sin la revisi√≥n habitual del CFO.</p>
                  <div style="display:flex;gap:8px;margin-top:10px">
                    <span class="bo-tag">Corrobora denuncia</span>
                    <a href="#" class="bo-link" style="font-size:12px;margin-left:auto">Ver acta completa ‚Üí</a>
                  </div>
                </div>
                <div class="interview-item interview-pending">
                  <div class="interview-header">
                    <div>
                      <strong>Entrevista #2 ‚Äî Luis Pereyra</strong>
                      <span class="int-tag int-tag-pending">Pendiente</span>
                    </div>
                    <span style="font-size:12px;color:var(--gray-400)">Programada: 27/02/2025</span>
                  </div>
                  <p class="interview-summary" style="color:var(--gray-400)">Entrevista formal al denunciado. Pendiente coordinaci√≥n con RRHH y asesor legal externo para garantizar el debido proceso.</p>
                </div>
              </div>
            </div>
          </div><!-- /tab-entrevistas -->

          <!-- TAB: COMUNICACI√ìN -->
          <div class="tab-panel" id="tab-comunicacion">
            <div class="bo-card">
              <div class="bo-card-header">
                <h3>Canal seguro con el denunciante</h3>
                <span style="font-size:12px;color:var(--gray-400)">üîí Cifrado end-to-end ¬∑ An√≥nimo</span>
              </div>
              <div class="chat-area" id="chatArea">
                <div class="chat-msg system">
                  <div class="chat-bubble system-bubble">Denuncia recibida el 18/02/2025 a las 11:23 hs. C√≥digo: ARG-2025-0043</div>
                  <span class="chat-time">18 feb ¬∑ 11:23</span>
                </div>
                <div class="chat-msg investigator">
                  <div class="chat-bubble inv-bubble">Gracias por tu reporte. Lo recibimos correctamente y est√° siendo evaluado por nuestro equipo. Te mantendremos informado ante novedades.</div>
                  <span class="chat-time">M. √Ålvarez ¬∑ 19 feb ¬∑ 09:10</span>
                </div>
                <div class="chat-msg investigator">
                  <div class="chat-bubble inv-bubble">Tu denuncia fue admitida y se inici√≥ una investigaci√≥n formal. ¬øPod√©s brindarnos m√°s detalles sobre los contratos que mencion√°s? ¬øTen√©s acceso a los documentos originales?</div>
                  <span class="chat-time">M. √Ålvarez ¬∑ 20 feb ¬∑ 11:05</span>
                </div>
                <div class="chat-msg whistleblower">
                  <div class="chat-bubble wb-bubble">S√≠, puedo subir los archivos. ¬øC√≥mo hago? Quiero asegurarme que no quedan mis datos asociados.</div>
                  <span class="chat-time">An√≥nimo ¬∑ 20 feb ¬∑ 14:32</span>
                </div>
                <div class="chat-msg investigator">
                  <div class="chat-bubble inv-bubble">Pod√©s subir los archivos directamente en el portal usando tu c√≥digo ARG-2025-0043. El sistema no registra tu IP ni ning√∫n dato de identificaci√≥n. Tus archivos van directo a la investigaci√≥n.</div>
                  <span class="chat-time">M. √Ålvarez ¬∑ 20 feb ¬∑ 14:48</span>
                </div>
                <div class="chat-msg whistleblower">
                  <div class="chat-bubble wb-bubble">Ya los sub√≠. Son dos capturas de pantalla de las transferencias y un PDF de la factura.</div>
                  <span class="chat-time">An√≥nimo ¬∑ 20 feb ¬∑ 15:10</span>
                </div>
              </div>
              <div class="chat-input-area">
                <textarea class="chat-input" id="chatInput" placeholder="Escrib√≠ tu mensaje al denunciante..." rows="2"></textarea>
                <button type="button" class="bo-btn bo-btn-primary" style="align-self:flex-end" id="chatSendBtn" onclick="enviarMensaje()">
                  Enviar
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M12 2L2 6l4 3 3 4 3-11z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/></svg>
                </button>
              </div>
            </div>
          </div><!-- /tab-comunicacion -->

          <!-- TAB: LOG -->
          <div class="tab-panel" id="tab-log">
            <div class="bo-card">
              <div class="bo-card-header"><h3>Bit√°cora del caso</h3><button class="bo-btn bo-btn-outline" style="font-size:12px">Descargar historial PDF</button></div>
              <div class="case-timeline">
                <div class="tl-item">
                  <div class="tl-dot" style="background:var(--primary)"></div>
                  <div class="tl-content">
                    <div class="tl-time">22/02/2025 14:32 ¬∑ M. √Ålvarez</div>
                    <div class="tl-action">Revis√≥ hallazgos de J. Torres sobre an√°lisis de firmas</div>
                  </div>
                </div>
                <div class="tl-item">
                  <div class="tl-dot" style="background:#7C3AED"></div>
                  <div class="tl-content">
                    <div class="tl-time">21/02/2025 17:30 ¬∑ J. Torres</div>
                    <div class="tl-action">Agreg√≥ hallazgo: Firma no coincide con manual de poderes</div>
                  </div>
                </div>
                <div class="tl-item">
                  <div class="tl-dot" style="background:#D97706"></div>
                  <div class="tl-content">
                    <div class="tl-time">21/02/2025 11:05 ¬∑ R. Mendoza</div>
                    <div class="tl-action">Subi√≥ documento: <code class="bo-code">contrato_proveedor.pdf</code></div>
                  </div>
                </div>
                <div class="tl-item">
                  <div class="tl-dot" style="background:#D97706"></div>
                  <div class="tl-content">
                    <div class="tl-time">20/02/2025 14:10 ¬∑ R. Mendoza</div>
                    <div class="tl-action">Agreg√≥ hallazgo: Proveedor no verificable en AFIP (CUIT inactivo)</div>
                  </div>
                </div>
                <div class="tl-item">
                  <div class="tl-dot" style="background:#16A34A"></div>
                  <div class="tl-content">
                    <div class="tl-time">20/02/2025 11:30 ¬∑ M. √Ålvarez</div>
                    <div class="tl-action">Realiz√≥ entrevista a Testigo A ‚Äî Acta registrada</div>
                  </div>
                </div>
                <div class="tl-item">
                  <div class="tl-dot" style="background:var(--primary)"></div>
                  <div class="tl-content">
                    <div class="tl-time">19/02/2025 16:00 ¬∑ M. √Ålvarez</div>
                    <div class="tl-action">Cambi√≥ estado: <span class="status-tag status-new" style="font-size:10px;padding:2px 7px">Nuevo</span> ‚Üí <span class="status-tag status-investigating" style="font-size:10px;padding:2px 7px">Investigando</span></div>
                  </div>
                </div>
                <div class="tl-item">
                  <div class="tl-dot" style="background:var(--primary)"></div>
                  <div class="tl-content">
                    <div class="tl-time">19/02/2025 09:10 ¬∑ M. √Ålvarez</div>
                    <div class="tl-action">Asign√≥ investigador: R. Mendoza</div>
                  </div>
                </div>
                <div class="tl-item">
                  <div class="tl-dot" style="background:var(--primary)"></div>
                  <div class="tl-content">
                    <div class="tl-time">18/02/2025 11:23 ¬∑ Sistema</div>
                    <div class="tl-action">Caso recibido v√≠a Email ¬∑ Asignado autom√°ticamente como ARG-2025-0043</div>
                  </div>
                </div>
              </div>
            </div>
          </div><!-- /tab-log -->

        </div><!-- /case-left -->

        <!-- ‚ïê‚ïê RIGHT COLUMN ‚ïê‚ïê -->
        <div class="case-right">

          <!-- Asignaci√≥n -->
          <div class="bo-card">
            <div class="bo-card-header"><h3>Asignaci√≥n</h3></div>
            <div class="assign-section">
              <div class="assign-row" id="assignRow-inv">
                <span class="assign-label">Investigador principal</span>
                <div class="assign-value" id="assignVal-inv">
                  <div class="bo-log-avatar" style="width:28px;height:28px;background:#D97706;font-size:11px">RM</div>
                  <span id="assignName-inv">R. Mendoza</span>
                  <button class="bo-btn bo-btn-ghost" style="font-size:11px;margin-left:auto;padding:3px 8px" onclick="openAssignModal('inv','Investigador principal')">Cambiar</button>
                </div>
              </div>
              <div class="assign-row" id="assignRow-legal">
                <span class="assign-label">Revisi√≥n legal</span>
                <div class="assign-value" id="assignVal-legal">
                  <div class="bo-log-avatar" style="width:28px;height:28px;background:#059669;font-size:11px">JT</div>
                  <span id="assignName-legal">J. Torres</span>
                  <button class="bo-btn bo-btn-ghost" style="font-size:11px;margin-left:auto;padding:3px 8px" onclick="openAssignModal('legal','Revisi√≥n legal')">Cambiar</button>
                </div>
              </div>
              <div class="assign-row">
                <span class="assign-label">Supervisor</span>
                <div class="assign-value">
                  <div class="bo-user-avatar" style="width:28px;height:28px;font-size:11px">MA</div>
                  M. √Ålvarez
                </div>
              </div>
              <div class="assign-row" id="assignRow-rrhh">
                <span class="assign-label">Equipo RRHH</span>
                <div class="assign-value" id="assignVal-rrhh">
                  <span id="assignName-rrhh" style="color:var(--gray-400)">Sin asignar</span>
                  <button class="bo-btn bo-btn-ghost" style="font-size:11px;margin-left:auto;padding:3px 8px" onclick="openAssignModal('rrhh','Equipo RRHH')">+ Asignar</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Informaci√≥n del caso -->
          <div class="bo-card">
            <div class="bo-card-header"><h3>Informaci√≥n del caso</h3></div>
            <div class="case-info-list">
              <div class="case-info-row"><span>ID</span><code class="bo-code">ARG-2025-0043</code></div>
              <div class="case-info-row"><span>Canal</span><span>Email</span></div>
              <div class="case-info-row"><span>Tipo</span><span>Fraude financiero</span></div>
              <div class="case-info-row"><span>√Årea</span><span>Finanzas / Contabilidad</span></div>
              <div class="case-info-row"><span>Jurisdicci√≥n</span><span>Argentina</span></div>
              <div class="case-info-row"><span>Confidencialidad</span><span>üîí Confidencial</span></div>
              <div class="case-info-row"><span>An√≥nima</span><span>S√≠</span></div>
              <div class="case-info-row"><span>Riesgo</span><span class="risk-tag risk-critical">CR√çTICO</span></div>
              <div class="case-info-row"><span>Estado</span><span class="status-tag status-investigating" id="caseInfoStatus">Investigando</span></div>
              <div class="case-info-row"><span>Fecha ingreso</span><span>18/02/2025</span></div>
              <div class="case-info-row"><span>SLA objetivo</span><span>60 d√≠as h√°biles</span></div>
              <div class="case-info-row"><span>Vencimiento</span><span style="color:#EA580C;font-weight:600">02/03/2025</span></div>
            </div>
          </div>

          <!-- Tags -->
          <div class="bo-card">
            <div class="bo-card-header"><h3>Etiquetas</h3><button class="bo-btn bo-btn-ghost" style="font-size:11px" onclick="toggleTagInput()">+ Agregar</button></div>
            <div id="tagsList" style="padding:14px 16px;display:flex;flex-wrap:wrap;gap:6px">
              <span class="bo-tag" onclick="removeTag(this)" title="Click para quitar">Fraude √ó</span>
              <span class="bo-tag" onclick="removeTag(this)" title="Click para quitar">AML √ó</span>
              <span class="bo-tag" onclick="removeTag(this)" title="Click para quitar">Proveedor ficticio √ó</span>
              <span class="bo-tag" onclick="removeTag(this)" title="Click para quitar">Firmas ap√≥crifas √ó</span>
              <span class="bo-tag" onclick="removeTag(this)" title="Click para quitar">Alta prioridad √ó</span>
              <span class="bo-tag" onclick="removeTag(this)" title="Click para quitar">Investigaci√≥n activa √ó</span>
            </div>
            <div id="tagInputWrap" style="display:none;padding:0 16px 14px;display:none;gap:8px;align-items:center">
              <input type="text" id="tagInput" class="bo-select-full" placeholder="Nueva etiqueta..." style="flex:1;max-width:200px" onkeydown="if(event.key==='Enter')addTag()" />
              <button class="bo-btn bo-btn-primary" style="font-size:12px" onclick="addTag()">Agregar</button>
              <button class="bo-btn bo-btn-ghost" style="font-size:12px" onclick="toggleTagInput()">Cancelar</button>
            </div>
          </div>

          <!-- Documentos r√°pidos -->
          <div class="bo-card">
            <div class="bo-card-header"><h3>Documentos recientes</h3></div>
            <div class="docs-quick">
              <div class="doc-q-item"><span class="file-icon pdf">PDF</span><span>factura_vendedora_01.pdf</span></div>
              <div class="doc-q-item"><span class="file-icon img">IMG</span><span>captura_transferencia_1.png</span></div>
              <div class="doc-q-item"><span class="file-icon xls">XLS</span><span>ordenes_compra_6m.xlsx</span></div>
            </div>
          </div>

          <!-- Notas internas -->
          <div class="bo-card">
            <div class="bo-card-header"><h3>Notas internas</h3></div>
            <div id="notasList" style="padding:0 16px">
              <div class="nota-item">
                <div class="nota-meta">M. √Ålvarez ¬∑ 18/02/2025</div>
                <p class="nota-body">Coordinar con el CFO antes de la entrevista al denunciado. Verificar si existe denuncia penal previa sobre este proveedor.</p>
              </div>
            </div>
            <div style="padding:14px 16px;border-top:1px solid var(--gray-100)">
              <textarea class="bo-textarea" id="notaInput" rows="3" placeholder="Nueva nota interna (solo visible para el equipo)..."></textarea>
              <button class="bo-btn bo-btn-outline" style="font-size:12px;margin-top:10px" onclick="guardarNota()">Guardar nota</button>
            </div>
          </div>

        </div><!-- /case-right -->

      </div><!-- /case-grid -->

    </div><!-- /bo-case-page -->

  </main>

</div><!-- /bo-shell -->

<!-- MODAL: Asignar -->
<div class="bo-modal-overlay" id="assignModal" style="display:none" onclick="if(event.target.id==='assignModal')event.target.style.display='none'">
  <div class="bo-modal" style="max-width:420px">
    <div class="bo-modal-header">
      <h3 id="assignModalTitle">Asignar</h3>
      <button onclick="document.getElementById('assignModal').style.display='none'" class="bo-modal-close">‚úï</button>
    </div>
    <div class="bo-modal-body">
      <div class="bo-form-group">
        <label>Seleccion√° el integrante</label>
        <select class="bo-select-full" id="assignSelect">
          <option value="">‚Äî Sin asignar ‚Äî</option>
          <option value="M. √Ålvarez">M. √Ålvarez (Compliance Officer)</option>
          <option value="R. Mendoza">R. Mendoza (Investigador)</option>
          <option value="J. Torres">J. Torres (Legal)</option>
          <option value="L. Garc√≠a">L. Garc√≠a (Auditor)</option>
          <option value="C. P√©rez">C. P√©rez (RRHH)</option>
        </select>
      </div>
    </div>
    <div class="bo-modal-footer">
      <button onclick="document.getElementById('assignModal').style.display='none'" class="bo-btn bo-btn-ghost">Cancelar</button>
      <button onclick="confirmAssign()" class="bo-btn bo-btn-primary">Confirmar asignaci√≥n</button>
    </div>
  </div>
</div>

<!-- MODAL: Resolver caso -->
<div class="bo-modal-overlay" id="closeModal" style="display:none" onclick="if(event.target.id==='closeModal')event.target.style.display='none'">
  <div class="bo-modal">
    <div class="bo-modal-header">
      <h3>Resolver caso ARG-2025-0043</h3>
      <button onclick="document.getElementById('closeModal').style.display='none'" class="bo-modal-close">‚úï</button>
    </div>
    <div class="bo-modal-body">
      <div class="bo-form-grid">
        <div class="bo-form-group">
          <label>Decisi√≥n final *</label>
          <select class="bo-select-full" id="resolucionDecision">
            <option>‚Äî Seleccion√° ‚Äî</option>
            <option>Confirmado ‚Äî Con medidas</option>
            <option>Confirmado ‚Äî Sin medidas</option>
            <option>Desestimado ‚Äî Sin m√©rito</option>
            <option>Derivado a autoridad externa</option>
            <option>Archivado ‚Äî Informaci√≥n insuficiente</option>
          </select>
        </div>
        <div class="bo-form-group">
          <label>Tipo de sanci√≥n / acci√≥n correctiva</label>
          <select class="bo-select-full">
            <option>‚Äî Seleccion√° ‚Äî</option>
            <option>Desvinculaci√≥n con causa</option>
            <option>Suspensi√≥n disciplinaria</option>
            <option>Apercibimiento formal</option>
            <option>Capacitaci√≥n obligatoria</option>
            <option>Denuncia penal</option>
            <option>Reporte regulatorio (UIF)</option>
            <option>Sin sanci√≥n</option>
          </select>
        </div>
        <div class="bo-form-group bo-span2">
          <label>Resumen de la resoluci√≥n *</label>
          <textarea class="bo-textarea" id="resolucionResumen" rows="5" placeholder="Describ√≠ los hallazgos finales, decisi√≥n adoptada, personas sancionadas y medidas correctivas implementadas..."></textarea>
        </div>
        <div class="bo-form-group bo-span2">
          <label>Seguimiento post-cierre</label>
          <textarea class="bo-textarea" rows="2" placeholder="Indic√° qu√© acciones se verificar√°n a los 90 d√≠as del cierre..."></textarea>
        </div>
        <div class="bo-form-group">
          <label>Fecha de cierre efectivo</label>
          <input type="date" class="bo-select-full" value="2025-02-22" />
        </div>
        <div class="bo-form-group">
          <label>Pr√≥xima revisi√≥n (seguimiento)</label>
          <input type="date" class="bo-select-full" />
        </div>
      </div>
    </div>
    <div class="bo-modal-footer">
      <button onclick="document.getElementById('closeModal').style.display='none'" class="bo-btn bo-btn-ghost">Cancelar</button>
      <button type="button" onclick="registrarResolucion()" class="bo-btn bo-btn-primary">Cerrar y registrar resoluci√≥n</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="boToast" style="display:none;position:fixed;bottom:28px;right:28px;z-index:9999;background:#002B2E;color:#fff;padding:14px 20px;border-radius:10px;font-size:13px;font-weight:600;box-shadow:0 8px 24px rgba(0,0,0,.25);display:none;align-items:center;gap:10px;max-width:360px">
  <span id="boToastIcon">‚úÖ</span>
  <span id="boToastMsg">Acci√≥n realizada</span>
</div>

<!-- MODAL: Nueva entrevista -->
<div class="bo-modal-overlay" id="nuevaEntrevistaModal" style="display:none" onclick="if(event.target.id==='nuevaEntrevistaModal')closeNuevaEntrevistaModal()">
  <div class="bo-modal" onclick="event.stopPropagation()">
    <div class="bo-modal-header">
      <h3>Nueva entrevista</h3>
      <button type="button" onclick="closeNuevaEntrevistaModal()" class="bo-modal-close">‚úï</button>
    </div>
    <div class="bo-modal-body">
      <div class="bo-form-grid">
        <div class="bo-form-group">
          <label>Nombre del entrevistado *</label>
          <input type="text" id="entrevistaNombre" class="bo-select-full" placeholder="Ej: Luis Pereyra, Testigo A" />
        </div>
        <div class="bo-form-group">
          <label>Rol en el caso</label>
          <select id="entrevistaRol" class="bo-select-full">
            <option>Testigo</option>
            <option>Denunciado</option>
            <option>Informante clave</option>
            <option>Otro</option>
          </select>
        </div>
        <div class="bo-form-group">
          <label>Fecha / programaci√≥n</label>
          <input type="date" id="entrevistaFecha" class="bo-select-full" />
        </div>
        <div class="bo-form-group bo-span2">
          <label>Notas o resumen</label>
          <textarea id="entrevistaNotas" class="bo-textarea" rows="4" placeholder="Resumen de la entrevista o puntos a tratar..."></textarea>
        </div>
      </div>
    </div>
    <div class="bo-modal-footer">
      <button type="button" onclick="closeNuevaEntrevistaModal()" class="bo-btn bo-btn-ghost">Cancelar</button>
      <button type="button" onclick="guardarNuevaEntrevista()" class="bo-btn bo-btn-primary">Guardar entrevista</button>
    </div>
  </div>
</div>

<style>
/* ‚ïê‚ïê Reuse variables from dashboard ‚ïê‚ïê */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --primary:#0097A7; --primary-100:#E0F7FA; --primary-200:#B2EBF2; --primary-700:#00838F;
  --black:#002B2E; --gray-900: #003D44; --gray-800:#00474F; --gray-700:#005F6B;
  --gray-600:#007A87; --gray-500:#5F9EA5; --gray-400:#8CBDC3; --gray-300:#BAD8DB;
  --gray-200:#D5ECEE; --gray-100:#EAF6F7; --gray-50:#F3FCFD; --white:#FFFFFF;
  --sidebar-w:240px; --sidebar-collapsed:64px; --topbar-h:60px;
  --font:'Inter',sans-serif; --radius:10px; --radius-lg:14px;
}
html { scroll-behavior:smooth; }
body { font-family:var(--font); background:var(--gray-50); color:var(--gray-800); font-size:14px; line-height:1.6; -webkit-font-smoothing:antialiased; }
a { text-decoration:none; color:inherit; }

/* ‚îÄ‚îÄ Shell / Sidebar (same as dashboard) ‚îÄ‚îÄ */
.bo-shell { display:flex; min-height:100vh; }
.bo-sidebar { width:var(--sidebar-w); min-height:100vh; background:var(--gray-900); display:flex; flex-direction:column; position:fixed; top:0; left:0; bottom:0; z-index:200; overflow:hidden; transition:width .25s; }
.bo-sidebar.collapsed { width:var(--sidebar-collapsed); }
.bo-sidebar.collapsed .sidebar-icon-collapse { display: none !important; }
.bo-sidebar.collapsed .sidebar-icon-expand { display: block !important; }
.bo-sidebar:not(.collapsed) .sidebar-icon-expand { display: none !important; }
.bo-sidebar-header { display:flex; align-items:center; justify-content:space-between; padding:20px 16px; border-bottom:1px solid rgba(255,255,255,.06); }
.bo-logo { display:flex; align-items:center; gap:10px; flex-shrink:0; white-space:nowrap; }
.bo-logo-name { font-size:16px; font-weight:800; color:var(--white); letter-spacing:-.03em; }
.bo-logo-sub { font-size:10px; font-weight:500; color:rgba(255,255,255,.35); text-transform:uppercase; letter-spacing:.08em; }
.bo-sidebar-toggle { background:rgba(255,255,255,.06); border:none; border-radius:6px; color:rgba(255,255,255,.4); width:28px; height:28px; display:flex; align-items:center; justify-content:center; cursor:pointer; flex-shrink:0; }
.bo-nav { flex:1; padding:16px 0; overflow-y:auto; overflow-x:hidden; }
.bo-nav-section { margin-bottom:8px; }
.bo-nav-label { font-size:10px; font-weight:700; color:rgba(255,255,255,.25); text-transform:uppercase; letter-spacing:.1em; padding:8px 16px 4px; display:block; white-space:nowrap; }
.bo-nav-item { display:flex; align-items:center; gap:10px; padding:9px 16px; border-radius:8px; margin:2px 8px; font-size:13.5px; font-weight:500; color:rgba(255,255,255,.55); cursor:pointer; transition:background .15s,color .15s; white-space:nowrap; }
.bo-nav-item:hover { background:rgba(255,255,255,.07); color:var(--white); }
.bo-nav-item.active { background:var(--primary); color:var(--white); }
.bo-badge-count { margin-left:auto; background:rgba(255,255,255,.12); color:rgba(255,255,255,.7); font-size:11px; font-weight:700; padding:2px 7px; border-radius:100px; }
.bo-badge-warn { background:rgba(234,88,12,.25); color:#FB923C; }
.bo-badge-danger { background:rgba(220,38,38,.25); color:#F87171; }
.bo-sidebar-user { padding:16px; border-top:1px solid rgba(255,255,255,.06); display:flex; align-items:center; gap:10px; white-space:nowrap; }
.bo-user-avatar { width:32px; height:32px; background:var(--primary); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; color:var(--white); flex-shrink:0; }
.bo-user-info strong { display:block; font-size:13px; font-weight:600; color:var(--white); }
.bo-user-info span { font-size:11px; color:rgba(255,255,255,.4); }
.bo-main { margin-left:var(--sidebar-w); flex:1; min-height:100vh; transition:margin-left .25s; }
.bo-main.expanded { margin-left:var(--sidebar-collapsed); }
.bo-topbar { height:var(--topbar-h); background:var(--white); border-bottom:1.5px solid var(--gray-200); display:flex; align-items:center; justify-content:space-between; padding:0 24px; position:sticky; top:0; z-index:100; }
.bo-topbar-left { display:flex; align-items:center; gap:12px; }
.bo-breadcrumb { display:flex; align-items:center; gap:6px; font-size:13px; color:var(--gray-400); }
.bo-breadcrumb span:last-child { color:var(--black); font-weight:600; }
.bo-topbar-right { display:flex; align-items:center; gap:10px; }
.bo-notif-btn { width:36px; height:36px; background:var(--gray-100); border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer; position:relative; color:var(--gray-600); }
.bo-notif-dot { position:absolute; top:7px; right:7px; width:7px; height:7px; background:#DC2626; border-radius:50%; border:1.5px solid var(--white); }
.bo-topbar-avatar { width:32px; height:32px; background:var(--primary); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; color:var(--white); cursor:pointer; }
.bo-mobile-menu { display:none; background:none; border:none; color:var(--gray-600); cursor:pointer; padding:4px; }

/* ‚îÄ‚îÄ Case page ‚îÄ‚îÄ */
.bo-case-page { padding:24px; display:flex; flex-direction:column; gap:16px; }
.case-header-bar { display:flex; align-items:flex-start; justify-content:space-between; gap:20px; flex-wrap:wrap; background:var(--white); border:1.5px solid var(--gray-200); border-radius:var(--radius-lg); padding:24px; }
.case-header-left { flex:1; min-width:300px; }
.case-title { font-size:20px; font-weight:800; color:var(--black); letter-spacing:-.03em; margin:12px 0 8px; line-height:1.2; }
.case-meta { display:flex; flex-wrap:wrap; gap:8px; font-size:12px; color:var(--gray-500); }
.case-header-actions { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.bo-code-lg { font-family:'Courier New',monospace; font-size:15px; font-weight:800; background:var(--primary-100); color:var(--primary); padding:5px 12px; border-radius:7px; }
.conf-tag { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; background:#F5F3FF; border:1px solid #DDD6FE; border-radius:5px; font-size:11px; font-weight:600; color:#7C3AED; }

/* SLA bar */
.sla-bar { background:var(--white); border:1.5px solid var(--gray-200); border-radius:var(--radius-lg); padding:16px 24px; display:flex; flex-direction:column; gap:10px; }
.sla-bar-info { display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px; }
.sla-bar-label { font-size:12px; color:var(--gray-600); }
.sla-bar-track { height:6px; background:var(--gray-100); border-radius:100px; overflow:hidden; }
.sla-bar-fill { height:100%; border-radius:100px; transition:width .8s ease; }

/* Case grid */
.case-grid { display:grid; grid-template-columns:1fr 320px; gap:16px; align-items:start; }
@media (max-width:1100px) { .case-grid { grid-template-columns:1fr; } }
.case-left { display:flex; flex-direction:column; gap:16px; }
.case-right { display:flex; flex-direction:column; gap:16px; position:sticky; top:76px; }

/* Tabs */
.case-tabs { display:flex; gap:0; border-bottom:1.5px solid var(--gray-200); background:var(--white); border-radius:var(--radius-lg) var(--radius-lg) 0 0; overflow:hidden; border:1.5px solid var(--gray-200); border-bottom:none; }
.case-tab { padding:12px 18px; border:none; background:none; font-size:13px; font-weight:600; color:var(--gray-500); cursor:pointer; font-family:var(--font); border-bottom:2.5px solid transparent; transition:all .2s; white-space:nowrap; }
.case-tab:hover { color:var(--black); }
.case-tab.active { color:var(--primary); border-bottom-color:var(--primary); background:var(--white); }
.tab-panel { display:none; flex-direction:column; gap:16px; }
.tab-panel.active { display:flex; }

/* Cards */
.bo-card { background:var(--white); border:1.5px solid var(--gray-200); border-radius:var(--radius-lg); overflow:hidden; }
.bo-card-header { display:flex; align-items:center; justify-content:space-between; padding:14px 20px; border-bottom:1.5px solid var(--gray-100); }
.bo-card-header h3 { font-size:14px; font-weight:700; color:var(--black); letter-spacing:-.01em; }
.bo-link { font-size:13px; color:var(--primary); font-weight:600; }

/* Description */
.case-description { padding:20px; }
.case-description p { font-size:14px; color:var(--gray-700); line-height:1.75; }
.case-tags { display:flex; flex-wrap:wrap; gap:6px; }
.bo-tag { background:var(--gray-100); border:1px solid var(--gray-200); border-radius:100px; padding:4px 12px; font-size:12px; color:var(--gray-600); }
.bo-tag-danger { background:#FEF2F2; border-color:#FECACA; color:#DC2626; }
.bo-tag-warn { background:#FFFBEB; border-color:#FDE68A; color:#D97706; }

/* Involved */
.involved-list { padding:8px 16px; display:flex; flex-direction:column; gap:8px; }
.involved-item { display:flex; align-items:center; gap:12px; padding:12px 4px; border-bottom:1px solid var(--gray-100); }
.involved-item:last-child { border-bottom:none; }
.involved-avatar { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; flex-shrink:0; }
.involved-item strong { display:block; font-size:13px; font-weight:700; color:var(--black); }
.involved-item span { font-size:12px; color:var(--gray-500); }

/* Risk eval */
.risk-eval-grid { padding:16px 20px; display:flex; flex-direction:column; gap:14px; }
.risk-eval-item { display:flex; align-items:center; gap:12px; }
.risk-eval-label { font-size:12px; color:var(--gray-600); min-width:180px; }
.risk-eval-bar { flex:1; height:6px; background:var(--gray-100); border-radius:100px; overflow:hidden; }
.risk-eval-bar div { height:100%; border-radius:100px; transition:width .8s; }
.risk-eval-val { font-size:11px; font-weight:700; color:var(--gray-700); min-width:55px; text-align:right; }
.nota-item { padding:10px 0; border-bottom:1px solid var(--gray-100); }
.nota-item:last-child { border-bottom:none; }
.nota-meta { font-size:11px; font-weight:600; color:var(--gray-500); margin-bottom:4px; }
.nota-body { font-size:13px; color:var(--gray-700); line-height:1.6; margin:0; }
.risk-eval-notes { padding:16px 20px; border-top:1px solid var(--gray-100); }
.risk-eval-notes strong { font-size:12px; font-weight:700; color:var(--black); display:block; margin-bottom:6px; }
.risk-eval-notes p { font-size:13px; color:var(--gray-600); line-height:1.7; }

/* Tasks */
.inv-tasks { padding:12px 20px; display:flex; flex-direction:column; gap:0; }
.inv-task { display:flex; gap:14px; padding:16px 0; border-bottom:1px solid var(--gray-100); align-items:flex-start; }
.inv-task:last-child { border-bottom:none; }
.task-check {
  width:22px; height:22px; border-radius:50%; flex-shrink:0; margin-top:2px;
  display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:800;
}
.task-check.done { background:#16A34A; color:var(--white); }
.task-check.in-progress { background:var(--primary-100); border:2px solid var(--primary); }
.task-check.pending { background:var(--gray-100); border:2px solid var(--gray-300); }
.task-body strong { font-size:13px; font-weight:700; color:var(--black); display:block; margin-bottom:4px; }
.task-body p { font-size:12px; color:var(--gray-500); line-height:1.6; margin-bottom:8px; }
.task-meta { display:flex; gap:16px; flex-wrap:wrap; font-size:11px; color:var(--gray-400); }
.task-due { font-size:11px; font-weight:600; color:var(--gray-400); }
.task-due.warn { color:#EA580C; }
.inv-task.done .task-body strong { color:var(--gray-400); text-decoration:line-through; }
.inv-task.done .task-body p { color:var(--gray-300); }

/* Findings */
.findings-list { padding:12px 20px; display:flex; flex-direction:column; gap:12px; }
.finding-item { background:var(--gray-50); border:1px solid var(--gray-200); border-radius:10px; padding:16px; }
.finding-meta { font-size:12px; color:var(--gray-400); margin-bottom:8px; }
.finding-meta strong { color:var(--black); }
.finding-item p { font-size:13px; color:var(--gray-700); line-height:1.7; }

/* Rec box */
.rec-box { background:var(--gray-50); border:1px solid var(--gray-200); border-radius:10px; padding:16px; }
.rec-box strong { font-size:13px; font-weight:700; color:var(--black); display:block; margin-bottom:8px; }
.rec-box ul { padding-left:18px; }
.rec-box li { font-size:13px; color:var(--gray-700); line-height:1.7; }

/* Evidence table */
.evidence-table { padding:0; }
.evidence-header { display:grid; grid-template-columns:2fr 1fr 1fr 1fr 1fr 1fr; gap:8px; padding:10px 20px; background:var(--gray-50); border-bottom:1px solid var(--gray-100); font-size:11px; font-weight:700; color:var(--gray-400); text-transform:uppercase; letter-spacing:.04em; }
.evidence-row { display:grid; grid-template-columns:2fr 1fr 1fr 1fr 1fr 1fr; gap:8px; align-items:center; padding:12px 20px; border-bottom:1px solid var(--gray-100); font-size:13px; color:var(--gray-700); transition:background .15s; }
.evidence-row:last-child { border-bottom:none; }
.evidence-row:hover { background:var(--gray-50); }
.evidence-name { display:flex; align-items:center; gap:8px; font-weight:500; color:var(--black); }
.file-icon { padding:2px 6px; border-radius:4px; font-size:10px; font-weight:800; letter-spacing:.04em; }
.file-icon.pdf { background:#FEF2F2; color:#DC2626; }
.file-icon.img { background:#EFF6FF; color:#2563EB; }
.file-icon.doc { background:#E0F7FA; color:#0097A7; }
.file-icon.xls { background:#F0FDF4; color:#16A34A; }
.custody-tag { background:#F0FDF4; color:#16A34A; font-size:11px; font-weight:600; padding:2px 8px; border-radius:100px; }
.custody-tag.pending-c { background:#FFFBEB; color:#D97706; }
.evidence-actions { display:flex; gap:6px; font-size:12px; font-weight:600; color:var(--primary); }
.bo-upload-zone { margin:16px 20px 20px; border:2px dashed var(--gray-300); border-radius:10px; padding:24px; text-align:center; cursor:pointer; transition:border-color .2s; }
.bo-upload-zone:hover { border-color:var(--primary); }
.bo-upload-zone p { font-size:13px; color:var(--gray-500); margin:8px 0 4px; }
.bo-upload-zone span { font-size:11px; color:var(--gray-400); }

/* Interviews */
.interviews-list { padding:12px 20px; display:flex; flex-direction:column; gap:12px; }
.interview-item { background:var(--gray-50); border:1px solid var(--gray-200); border-radius:10px; padding:16px; }
.interview-item.interview-pending { opacity:.7; }
.interview-header { display:flex; justify-content:space-between; align-items:flex-start; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
.interview-header strong { font-size:13px; font-weight:700; color:var(--black); }
.int-tag { display:inline-block; margin-left:8px; padding:2px 8px; background:#F0FDF4; color:#16A34A; border-radius:100px; font-size:10px; font-weight:700; }
.int-tag-pending { background:#FFFBEB; color:#D97706; }
.interview-summary { font-size:13px; color:var(--gray-700); line-height:1.7; }

/* Chat */
.chat-area { padding:16px 20px; display:flex; flex-direction:column; gap:12px; max-height:400px; overflow-y:auto; background:var(--gray-50); }
.chat-msg { display:flex; flex-direction:column; }
.chat-msg.whistleblower { align-items:flex-end; }
.chat-msg.investigator { align-items:flex-start; }
.chat-msg.system { align-items:center; }
.chat-bubble { padding:10px 14px; border-radius:12px; font-size:13px; line-height:1.6; max-width:80%; }
.system-bubble { background:var(--gray-200); color:var(--gray-500); font-size:12px; text-align:center; border-radius:8px; }
.inv-bubble { background:var(--white); border:1.5px solid var(--gray-200); color:var(--gray-800); border-radius:12px 12px 12px 2px; }
.wb-bubble { background:var(--primary); color:var(--white); border-radius:12px 12px 2px 12px; }
.chat-time { font-size:11px; color:var(--gray-400); margin-top:4px; padding:0 4px; }
.chat-input-area { display:flex; gap:10px; padding:12px 16px; border-top:1px solid var(--gray-100); }
.chat-input { flex:1; border:1.5px solid var(--gray-200); border-radius:8px; padding:8px 12px; font-size:13px; font-family:var(--font); resize:none; outline:none; }
.chat-input:focus { border-color:var(--primary); }

/* Timeline */
.case-timeline { padding:12px 20px; display:flex; flex-direction:column; gap:0; }
.tl-item { display:flex; gap:14px; padding:14px 0; border-bottom:1px solid var(--gray-100); position:relative; }
.tl-item:last-child { border-bottom:none; }
.tl-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; margin-top:5px; }
.tl-content { flex:1; }
.tl-time { font-size:11px; color:var(--gray-400); margin-bottom:4px; }
.tl-action { font-size:13px; color:var(--gray-700); display:flex; align-items:center; gap:8px; flex-wrap:wrap; }

/* Right column */
.assign-section { padding:8px 16px; }
.assign-row { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 0; border-bottom:1px solid var(--gray-100); }
.assign-row:last-child { border-bottom:none; }
.assign-label { font-size:11px; font-weight:700; color:var(--gray-400); text-transform:uppercase; letter-spacing:.04em; min-width:120px; }
.assign-value { display:flex; align-items:center; gap:8px; font-size:13px; font-weight:600; color:var(--black); flex:1; }
.bo-log-avatar { width:32px; height:32px; background:var(--primary); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; color:var(--white); flex-shrink:0; }
.case-info-list { padding:8px 16px; }
.case-info-row { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--gray-100); gap:12px; font-size:12px; }
.case-info-row:last-child { border-bottom:none; }
.case-info-row span:first-child { color:var(--gray-400); font-weight:600; }
.case-info-row span:last-child, .case-info-row code { color:var(--black); text-align:right; }
.docs-quick { padding:8px 16px; display:flex; flex-direction:column; gap:8px; }
.doc-q-item { display:flex; align-items:center; gap:8px; font-size:12px; color:var(--gray-700); padding:6px 0; border-bottom:1px solid var(--gray-100); }
.doc-q-item:last-child { border-bottom:none; }

/* Tags */
.risk-tag { display:inline-flex; align-items:center; padding:3px 9px; border-radius:5px; font-size:10px; font-weight:800; letter-spacing:.06em; white-space:nowrap; }
.risk-critical { background:#FEF2F2; color:#DC2626; border:1px solid #FECACA; }
.risk-high { background:#FFF7ED; color:#EA580C; border:1px solid #FED7AA; }
.risk-medium { background:#FFFBEB; color:#D97706; border:1px solid #FDE68A; }
.risk-low { background:#F0FDF4; color:#16A34A; border:1px solid #BBF7D0; }
.status-tag { display:inline-flex; align-items:center; padding:4px 10px; border-radius:100px; font-size:11px; font-weight:600; white-space:nowrap; }
.status-new { background:#E0F7FA; color:#0097A7; }
.status-review { background:#FFF7ED; color:#EA580C; }
.status-investigating { background:#FEF3C7; color:#B45309; }
.status-closed-ok { background:#F0FDF4; color:#16A34A; }
.status-closed-no { background:#EAF6F7; color:#5F9EA5; }
.bo-code { font-family:'Courier New',monospace; font-size:12px; background:var(--primary-100); color:var(--primary); padding:3px 8px; border-radius:5px; }
.bo-select { border:1.5px solid var(--gray-200); border-radius:8px; padding:6px 12px; font-size:13px; font-family:var(--font); color:var(--gray-700); background:var(--white); outline:none; cursor:pointer; }
.bo-select-sm { border:1.5px solid var(--gray-200); border-radius:8px; padding:5px 10px; font-size:12px; font-family:var(--font); color:var(--gray-700); background:var(--white); outline:none; }
.bo-select-full { width:100%; border:1.5px solid var(--gray-200); border-radius:8px; padding:8px 12px; font-size:13px; font-family:var(--font); color:var(--gray-700); background:var(--white); outline:none; }
.bo-btn { display:inline-flex; align-items:center; gap:6px; padding:7px 14px; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; font-family:var(--font); border:none; transition:all .2s; }
.bo-btn-primary { background:var(--primary); color:var(--white); }
.bo-btn-primary:hover { background:var(--primary-700); }
.bo-btn-outline { background:var(--white); color:var(--gray-700); border:1.5px solid var(--gray-200); }
.bo-btn-ghost { background:transparent; color:var(--gray-600); border:1.5px solid transparent; }
.bo-btn-ghost:hover { background:var(--gray-100); }
.bo-textarea { width:100%; border:1.5px solid var(--gray-200); border-radius:8px; padding:10px 12px; font-size:13px; font-family:var(--font); color:var(--black); outline:none; resize:vertical; }
.bo-textarea:focus { border-color:var(--primary); }
.bo-form-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.bo-span2 { grid-column:span 2; }
.bo-form-group { display:flex; flex-direction:column; gap:6px; }
.bo-form-group label { font-size:12px; font-weight:700; color:var(--gray-600); text-transform:uppercase; letter-spacing:.04em; }
.bo-modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.5); backdrop-filter:blur(4px); z-index:1000; display:flex; align-items:center; justify-content:center; padding:20px; }
.bo-modal { background:var(--white); border-radius:var(--radius-lg); width:100%; max-width:640px; max-height:90vh; overflow-y:auto; box-shadow:0 24px 80px rgba(0,0,0,.2); }
.bo-modal-header { display:flex; align-items:center; justify-content:space-between; padding:20px 24px; border-bottom:1.5px solid var(--gray-100); }
.bo-modal-header h3 { font-size:17px; font-weight:800; color:var(--black); letter-spacing:-.02em; }
.bo-modal-close { background:var(--gray-100); border:none; border-radius:6px; width:28px; height:28px; cursor:pointer; font-size:14px; color:var(--gray-600); display:flex; align-items:center; justify-content:center; }
.bo-modal-body { padding:24px; }
.bo-modal-footer { padding:16px 24px; border-top:1.5px solid var(--gray-100); display:flex; justify-content:flex-end; gap:10px; }
@media (max-width:768px) { .bo-sidebar { transform:translateX(-100%); } .bo-sidebar.mobile-open { transform:translateX(0); } .bo-main { margin-left:0; } .bo-mobile-menu { display:block; } .evidence-header,.evidence-row { grid-template-columns:1fr; } }

/* ‚îÄ‚îÄ Print zone ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
#argus-print-zone { display:none; }
@media print {
  body > *:not(#argus-print-zone) { display:none !important; }
  #argus-print-zone {
    display:block !important;
    font-family:system-ui,sans-serif;
    font-size:12px;
    color:#111;
    padding:20px 24px;
  }
  #argus-print-zone .ph { display:flex; justify-content:space-between; align-items:flex-start; border-bottom:2.5px solid #0097A7; padding-bottom:10px; margin-bottom:16px; }
  #argus-print-zone .logo { font-size:20px; font-weight:900; color:#0097A7; }
  #argus-print-zone .pmeta { font-size:10px; color:#666; text-align:right; line-height:1.7; }
  #argus-print-zone .sec { font-size:10px; font-weight:700; color:#002B2E; text-transform:uppercase; letter-spacing:.06em; margin:14px 0 6px; border-left:3px solid #0097A7; padding-left:6px; }
  #argus-print-zone .pcard { border:1px solid #dde8ea; border-radius:6px; padding:10px 12px; margin-bottom:8px; background:#fafefe; }
  #argus-print-zone .pcard h3 { font-size:9px; text-transform:uppercase; letter-spacing:.06em; color:#5F9EA5; margin:0 0 6px; }
  #argus-print-zone .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
  #argus-print-zone .case-h-print { background:#f0f7f8; border-radius:6px; padding:10px 14px; margin-bottom:10px; }
  #argus-print-zone .case-h-print h2 { margin:0 0 4px; font-size:15px; color:#002B2E; }
  #argus-print-zone .case-h-meta { font-size:10px; color:#5F9EA5; }
  #argus-print-zone .irow { display:flex; justify-content:space-between; padding:3px 0; border-bottom:1px solid #f0f7f8; font-size:10.5px; }
  #argus-print-zone .irow span:first-child { color:#5F9EA5; }
  #argus-print-zone .tl-row { padding:4px 0; border-bottom:1px solid #f0f7f8; font-size:10.5px; }
  #argus-print-zone .nota-p { padding:5px 0; border-bottom:1px solid #f0f7f8; }
  #argus-print-zone .nota-p .nm { font-size:9px; color:#9ca3af; }
  #argus-print-zone .risk-tag, #argus-print-zone .status-tag, #argus-print-zone .bo-tag { display:inline-block; padding:1px 7px; border-radius:100px; font-size:9px; font-weight:700; }
  #argus-print-zone .risk-critical { background:#fef2f2; color:#dc2626; }
  #argus-print-zone .risk-high { background:#fff7ed; color:#ea580c; }
  #argus-print-zone .risk-medium { background:#fefce8; color:#ca8a04; }
  #argus-print-zone .bo-tag { background:#e0f7fa; color:#006064; }
  #argus-print-zone .status-investigating { background:#fff7ed; color:#ea580c; }
  #argus-print-zone .sla-info { font-size:10px; background:#fff7ed; color:#92400e; border-radius:4px; padding:5px 8px; margin:6px 0; }
  #argus-print-zone .print-footer { margin-top:16px; font-size:9px; color:#9ca3af; text-align:center; border-top:1px solid #eee; padding-top:6px; }
  @page { size:A4 portrait; margin:14mm; }
}
</style>

<script>
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  const main = document.getElementById('boMain');
  if (!sb || !main) return;
  if (window.innerWidth <= 768) {
    sb.classList.toggle('mobile-open');
    document.body.style.overflow = sb.classList.contains('mobile-open') ? 'hidden' : '';
  } else {
    sb.classList.toggle('collapsed');
    main.classList.toggle('expanded');
  }
}

function openNuevaEntrevistaModal() {
  document.getElementById('nuevaEntrevistaModal').style.display = 'flex';
}
function closeNuevaEntrevistaModal() {
  document.getElementById('nuevaEntrevistaModal').style.display = 'none';
}
function guardarNuevaEntrevista() {
  var nombre = document.getElementById('entrevistaNombre') && document.getElementById('entrevistaNombre').value;
  var rol = document.getElementById('entrevistaRol') && document.getElementById('entrevistaRol').value;
  var fecha = document.getElementById('entrevistaFecha') && document.getElementById('entrevistaFecha').value;
  var notas = document.getElementById('entrevistaNotas') && document.getElementById('entrevistaNotas').value;
  var list = document.querySelector('.interviews-list');
  if (list) {
    var div = document.createElement('div');
    div.className = 'interview-item';
    div.innerHTML = '<div class="interview-header"><div><strong>Entrevista ‚Äî ' + (nombre || 'Sin nombre') + '</strong><span class="int-tag">' + (rol || 'Programada') + '</span></div><span style="font-size:12px;color:var(--gray-400)">' + (fecha || 'Por definir') + ' ¬∑ M. √Ålvarez</span></div><p class="interview-summary">' + (notas || 'Sin notas.') + '</p>';
    list.appendChild(div);
  }
  closeNuevaEntrevistaModal();
  if (document.getElementById('entrevistaNombre')) document.getElementById('entrevistaNombre').value = '';
  if (document.getElementById('entrevistaRol')) document.getElementById('entrevistaRol').value = 'Testigo';
  if (document.getElementById('entrevistaFecha')) document.getElementById('entrevistaFecha').value = '';
  if (document.getElementById('entrevistaNotas')) document.getElementById('entrevistaNotas').value = '';
}

function enviarMensaje() {
  var input = document.getElementById('chatInput');
  var area = document.getElementById('chatArea');
  if (!input || !area) return;
  var text = (input.value || '').trim();
  if (!text) return;
  var now = new Date();
  var timeStr = now.getDate() + ' ' + ['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic'][now.getMonth()] + ' ¬∑ ' + now.getHours() + ':' + String(now.getMinutes()).padStart(2,'0');
  var msg = document.createElement('div');
  msg.className = 'chat-msg investigator';
  msg.innerHTML = '<div class="chat-bubble inv-bubble">' + text.replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</div><span class="chat-time">M. √Ålvarez ¬∑ ' + timeStr + '</span>';
  area.appendChild(msg);
  area.scrollTop = area.scrollHeight;
  input.value = '';
}

function switchTab(name, el) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.case-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  el.classList.add('active');
}

// ‚îÄ‚îÄ Etiquetas ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleTagInput() {
  var wrap = document.getElementById('tagInputWrap');
  if (!wrap) return;
  var show = wrap.style.display === 'none' || wrap.style.display === '';
  wrap.style.display = show ? 'flex' : 'none';
  if (show) setTimeout(function(){ var i=document.getElementById('tagInput'); if(i) i.focus(); }, 50);
}
function addTag() {
  var input = document.getElementById('tagInput');
  var list  = document.getElementById('tagsList');
  if (!input || !input.value.trim()) return;
  var span = document.createElement('span');
  span.className = 'bo-tag';
  span.title = 'Click para quitar';
  span.textContent = input.value.trim() + ' √ó';
  span.onclick = function(){ removeTag(this); };
  list.appendChild(span);
  input.value = '';
  input.focus();
  showToast('Etiqueta agregada', 'üè∑Ô∏è');
}
function removeTag(el) {
  if (confirm('¬øQuitar la etiqueta "' + el.textContent.replace(' √ó','') + '"?')) el.remove();
}

// ‚îÄ‚îÄ Asignaci√≥n ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var _assignTarget = '';
function openAssignModal(target, label) {
  _assignTarget = target;
  document.getElementById('assignModalTitle').textContent = label;
  var cur = document.getElementById('assignName-' + target);
  var sel = document.getElementById('assignSelect');
  if (cur && sel) {
    var curText = cur.textContent.trim();
    for (var i = 0; i < sel.options.length; i++) {
      if (sel.options[i].value && curText.includes(sel.options[i].value.split(' ')[0])) {
        sel.selectedIndex = i; break;
      }
    }
  }
  document.getElementById('assignModal').style.display = 'flex';
}
function confirmAssign() {
  var sel   = document.getElementById('assignSelect');
  var value = sel.value;
  var label = value || 'Sin asignar';
  var nameEl = document.getElementById('assignName-' + _assignTarget);
  if (nameEl) {
    nameEl.textContent = label;
    nameEl.style.color = value ? '' : 'var(--gray-400)';
  }
  var btnEl = document.querySelector('#assignRow-' + _assignTarget + ' button');
  if (btnEl) btnEl.textContent = value ? 'Cambiar' : '+ Asignar';
  document.getElementById('assignModal').style.display = 'none';
  showToast(value ? 'Asignado: ' + value : 'Asignaci√≥n removida', value ? 'üë§' : '‚ûñ');
}

function guardarNota() {
  var input = document.getElementById('notaInput');
  var lista = document.getElementById('notasList');
  if (!input || !input.value.trim()) { alert('Escrib√≠ una nota antes de guardar.'); return; }
  var now = new Date();
  var fecha = String(now.getDate()).padStart(2,'0') + '/' + String(now.getMonth()+1).padStart(2,'0') + '/' + now.getFullYear();
  var item = document.createElement('div');
  item.className = 'nota-item';
  item.innerHTML = '<div class="nota-meta">M. √Ålvarez ¬∑ ' + fecha + '</div><p class="nota-body">' + input.value.trim().replace(/</g,'&lt;') + '</p>';
  lista.prepend(item);
  input.value = '';
  showToast('Nota guardada correctamente', 'üìù');
}

function showToast(msg, icon) {
  var t = document.getElementById('boToast');
  if (!t) return;
  document.getElementById('boToastMsg').textContent = msg;
  document.getElementById('boToastIcon').textContent = icon || '‚úÖ';
  t.style.display = 'flex';
  clearTimeout(window._toastTimer);
  window._toastTimer = setTimeout(function() { t.style.display = 'none'; }, 4000);
}

function changeStatus(val) {
  var badge = document.getElementById('caseStatusBadge');
  var infoBadge = document.getElementById('caseInfoStatus');
  var labels = { new:'Nuevo', eval:'En evaluaci√≥n', investigating:'Investigando', review:'En revisi√≥n', closed:'Cerrar caso' };
  var statusClass = { new:'status-new', eval:'status-new', investigating:'status-investigating', review:'status-review', closed:'status-closed-ok' };
  if (val === 'closed') {
    openCloseModal();
    return;
  }
  if (badge) { badge.className = 'status-tag ' + (statusClass[val] || ''); badge.textContent = labels[val] || val; }
  if (infoBadge) { infoBadge.className = 'status-tag ' + (statusClass[val] || ''); infoBadge.textContent = labels[val] || val; }
  showToast('Estado actualizado a ¬´' + (labels[val] || val) + '¬ª', 'üîÑ');
}

function openCloseModal() {
  document.getElementById('closeModal').style.display = 'flex';
}

function registrarResolucion() {
  var decision = document.getElementById('resolucionDecision');
  var resumen = document.getElementById('resolucionResumen');
  if (!decision || decision.value === '‚Äî Seleccion√° ‚Äî') {
    alert('Seleccion√° una decisi√≥n final antes de cerrar el caso.');
    return;
  }
  if (!resumen || !resumen.value.trim()) {
    alert('Escrib√≠ un resumen de la resoluci√≥n antes de continuar.');
    return;
  }
  var decidido = decision.value;
  document.getElementById('closeModal').style.display = 'none';

  var badge = document.getElementById('caseStatusBadge');
  var infoBadge = document.getElementById('caseInfoStatus');
  var label = decidido.startsWith('Desestimado') ? 'Desestimado' : 'Cerrado';
  var cssClass = decidido.startsWith('Desestimado') ? 'status-closed-no' : 'status-closed-ok';
  if (badge) { badge.className = 'status-tag ' + cssClass; badge.textContent = label; }
  if (infoBadge) { infoBadge.className = 'status-tag ' + cssClass; infoBadge.textContent = label; }

  var select = document.querySelector('.bo-select[onchange]');
  if (select) { for (var i = 0; i < select.options.length; i++) { if (select.options[i].value === 'closed') select.selectedIndex = i; } }

  var tl = document.querySelector('.case-timeline');
  if (tl) {
    var now = new Date();
    var dateStr = now.getDate() + '/' + String(now.getMonth()+1).padStart(2,'0') + '/' + now.getFullYear() + ' ' + now.getHours() + ':' + String(now.getMinutes()).padStart(2,'0') + ' ¬∑ M. √Ålvarez';
    var item = document.createElement('div');
    item.className = 'tl-item';
    item.innerHTML = '<div class="tl-dot" style="background:#16A34A"></div><div class="tl-content"><div class="tl-time">' + dateStr + '</div><div class="tl-action">Caso cerrado ‚Äî Decisi√≥n: <strong>' + decidido + '</strong></div></div>';
    tl.prepend(item);
  }
  showToast('Caso cerrado correctamente ‚Äî ' + decidido, '‚úÖ');
  document.querySelector('.bo-btn.bo-btn-primary[onclick="openCloseModal()"]') && (document.querySelector('.bo-btn.bo-btn-primary[onclick="openCloseModal()"]').disabled = true);
}

// Read case ID and tenant from URL
var _urlParams = new URLSearchParams(window.location.search);
const caseId = _urlParams.get('id') || 'ARG-2025-0043';
var TENANT_CASO = (_urlParams.get('t') || '').replace(/[^a-zA-Z0-9_-]/g, '') || 'default';

document.getElementById('caseIdBreadcrumb').textContent = caseId;
document.title = 'Caso ' + caseId + ' ¬∑ Argus Back Office';

// Actualizar links con tenant y label de empresa
(function() {
  var tParam = TENANT_CASO !== 'default' ? '?t=' + TENANT_CASO : '';
  // Links al backoffice principal
  document.querySelectorAll('a[href="backoffice.html"]').forEach(function(a) {
    a.href = 'backoffice.html' + tParam;
  });
  // Link de reportes
  var repLink = document.getElementById('nav-reportes-link');
  if (repLink) repLink.href = 'backoffice-reportes.html' + tParam;
  // Link al portal p√∫blico
  var portalLink = document.getElementById('nav-portal-link');
  if (portalLink) portalLink.href = 'index.html' + tParam;
  // Label del tenant en sidebar
  var cfg = window.ArgusConfig ? ArgusConfig.get() : null;
  var label = document.getElementById('sidebar-tenant-label');
  if (label && cfg && cfg.empresa && cfg.empresa.nombre) {
    label.textContent = cfg.empresa.nombre;
  }
  // Aplicar config del tenant (colores, etc.)
  if (window.ArgusConfig) ArgusConfig.apply();
})();

function triggerUpload() { /* placeholder */ }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EXPORTACI√ìN ‚Äî CASO INDIVIDUAL
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

var CASO_PRINT_CSS = [
  'body{font-family:system-ui,sans-serif;color:#111;margin:0;padding:24px 28px;font-size:12px}',
  '.ph{display:flex;justify-content:space-between;align-items:flex-start;border-bottom:2.5px solid #0097A7;padding-bottom:12px;margin-bottom:18px}',
  '.logo{font-size:20px;font-weight:900;color:#0097A7;letter-spacing:-.03em}',
  '.meta{font-size:11px;color:#666;text-align:right;line-height:1.7}',
  '.sec{font-size:11px;font-weight:700;color:#002B2E;text-transform:uppercase;letter-spacing:.06em;margin:18px 0 8px;border-left:3px solid #0097A7;padding-left:7px}',
  /* Header del caso */
  '.case-h{background:#f0f7f8;border-radius:8px;padding:14px 16px;margin-bottom:4px}',
  '.case-h h2{margin:0 0 4px;font-size:16px;color:#002B2E}',
  '.case-h-meta{font-size:10.5px;color:#5F9EA5;margin-top:4px}',
  /* Tags */
  '.risk-tag,.status-tag,.bo-tag{display:inline-block;padding:2px 8px;border-radius:100px;font-size:9px;font-weight:700;margin:0 2px}',
  '.risk-critical{background:#fef2f2;color:#dc2626}.risk-high{background:#fff7ed;color:#ea580c}',
  '.risk-medium{background:#fefce8;color:#ca8a04}.risk-low{background:#f0fdf4;color:#16a34a}',
  '.status-investigating{background:#fff7ed;color:#ea580c}.status-new{background:#e0f7fa;color:#0097a7}',
  '.status-review{background:#f5f3ff;color:#7c3aed}.status-closed-ok{background:#f0fdf4;color:#16a34a}',
  '.status-closed-no{background:#eaf6f7;color:#5f9ea5}',
  '.bo-tag{background:#e0f7fa;color:#006064}',
  /* Grilla de 2 columnas */
  '.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:4px}',
  '.col{}',
  '.card{border:1px solid #dde8ea;border-radius:8px;padding:12px 14px;margin-bottom:10px;background:#fafefe}',
  '.card h3{font-size:10px;text-transform:uppercase;letter-spacing:.06em;color:#5F9EA5;margin:0 0 8px}',
  /* Info rows */
  '.info-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid #f0f7f8;font-size:11px}',
  '.info-row span:first-child{color:#5F9EA5;font-weight:500}',
  'code{font-family:monospace;font-size:9px;background:#e0f7fa;padding:1px 5px;border-radius:3px;color:#006064}',
  /* Asignaci√≥n */
  '.assign-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid #f0f7f8;font-size:11px}',
  '.assign-label{color:#5F9EA5;font-weight:500}',
  /* Timeline */
  '.tl-item{display:flex;gap:10px;padding:6px 0;border-bottom:1px solid #f0f7f8}',
  '.tl-dot{width:8px;height:8px;border-radius:50%;background:#0097A7;flex-shrink:0;margin-top:3px}',
  '.tl-body{font-size:11px}',
  '.tl-time{font-size:9px;color:#9ca3af;margin-left:6px}',
  /* Notas */
  '.nota{padding:8px 0;border-bottom:1px solid #f0f7f8}',
  '.nota-meta{font-size:9px;color:#9ca3af;margin-bottom:3px}',
  '.nota-body{font-size:11px;color:#374151;margin:0}',
  /* Descripci√≥n */
  '.desc{font-size:11.5px;color:#374151;line-height:1.6;margin:0}',
  /* Personas involucradas */
  '.inv-item{display:flex;gap:10px;padding:5px 0;border-bottom:1px solid #f0f7f8;align-items:center}',
  '.inv-av{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;flex-shrink:0}',
  '.inv-info{flex:1;font-size:11px}',
  '.inv-info strong{display:block}',
  '.inv-info span{color:#6B7280;font-size:10px}',
  /* Riesgo */
  '.risk-bar-row{display:flex;align-items:center;gap:8px;margin-bottom:6px}',
  '.risk-bar-label{font-size:10px;width:150px;color:#374151}',
  '.risk-bar-track{flex:1;height:6px;background:#e5e7eb;border-radius:3px;overflow:hidden}',
  '.risk-bar-fill{height:100%;border-radius:3px}',
  '.risk-bar-val{font-size:9px;width:40px;text-align:right;color:#374151}',
  /* Pie */
  '.print-footer{margin-top:18px;font-size:9px;color:#9ca3af;text-align:center;border-top:1px solid #eee;padding-top:8px}',
  'button{display:none}input{display:none}',
  '@media print{body{padding:10px}@page{size:A4 portrait;margin:14mm}}',
].join('');

function _casoPrintViaIframe(html) {
  var old = document.getElementById('__print_frame_caso');
  if (old) old.remove();
  var iframe = document.createElement('iframe');
  iframe.id = '__print_frame_caso';
  // Debe tener dimensiones reales para que print() funcione en todos los navegadores
  iframe.style.cssText = 'position:fixed;top:0;left:0;width:0;height:0;border:none;opacity:0;pointer-events:none';
  document.body.appendChild(iframe);
  var doc = iframe.contentDocument || iframe.contentWindow.document;
  doc.open();
  doc.write(html);
  doc.close();
  // setTimeout es m√°s confiable que onload cuando se usa doc.write
  setTimeout(function() {
    try {
      iframe.contentWindow.focus();
      iframe.contentWindow.print();
    } catch(e) {
      showToast('No se pudo abrir el di√°logo de impresi√≥n', '‚ö†Ô∏è');
    }
  }, 600);
}

function exportCasoPdf() {
  var empresa = (window.ArgusConfig ? ArgusConfig.get().empresa.nombre : '') || 'Argus';
  var fecha   = new Date().toLocaleDateString('es-AR', {year:'numeric', month:'long', day:'numeric'});
  var pz      = document.getElementById('argus-print-zone');
  if (!pz) return;

  var html = '';

  // Encabezado
  html += '<div class="ph">' +
    '<div><span class="logo">Argus<span style="color:#0097A7">.</span></span>' +
      '<div style="font-size:10px;color:#666;margin-top:2px">' + empresa + ' ¬∑ Back Office</div></div>' +
    '<div class="pmeta">Reporte de Caso<br><strong>' + caseId + '</strong><br>' + fecha + ' ¬∑ Confidencial</div>' +
  '</div>';

  // Header del caso
  var riskTag   = document.querySelector('.risk-tag')        ? document.querySelector('.risk-tag').outerHTML        : '';
  var statusTag = document.getElementById('caseStatusBadge') ? document.getElementById('caseStatusBadge').outerHTML : '';
  var titulo    = document.querySelector('.case-title')       ? document.querySelector('.case-title').textContent    : '';
  var metaTxt   = document.querySelector('.case-meta')        ? document.querySelector('.case-meta').innerText       : '';
  html += '<div class="case-h-print">' +
    '<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:5px"><code style="font-family:monospace;background:#e0f7fa;padding:1px 6px;border-radius:3px;font-size:9px;color:#006064">' + caseId + '</code>' + riskTag + statusTag + '</div>' +
    '<h2>' + titulo + '</h2>' +
    '<div class="case-h-meta">' + metaTxt + '</div>' +
  '</div>';

  // SLA
  var slaText = document.querySelector('.sla-bar-info') ? document.querySelector('.sla-bar-info').innerText : '';
  html += '<div class="sla-info">' + slaText + '</div>';

  // Grilla 2 columnas
  html += '<div class="grid2">';

  // ‚îÄ‚îÄ Columna izquierda ‚îÄ‚îÄ
  html += '<div>';

  // Descripci√≥n
  var descEl = document.querySelector('#tab-resumen .case-description');
  if (descEl) {
    var descTxt  = descEl.querySelector('p') ? descEl.querySelector('p').textContent : '';
    var tagItems = Array.from(descEl.querySelectorAll('.bo-tag')).map(function(t){
      return '<span class="bo-tag">' + t.textContent.replace(/\s*√ó\s*$/, '') + '</span>';
    }).join(' ');
    html += '<div class="sec">Descripci√≥n del hecho</div><div class="pcard">' +
      '<p style="margin:0 0 6px;line-height:1.5;font-size:11px">' + descTxt + '</p>' +
      (tagItems ? '<div>' + tagItems + '</div>' : '') +
    '</div>';
  }

  // Personas involucradas
  var invEl = document.querySelector('.involved-list');
  if (invEl) {
    html += '<div class="sec">Personas involucradas</div><div class="pcard">';
    Array.from(invEl.querySelectorAll('.involved-item')).forEach(function(item) {
      var n   = item.querySelector('strong') ? item.querySelector('strong').textContent : '';
      var rol = item.querySelectorAll('span')[0] ? item.querySelectorAll('span')[0].textContent : '';
      var tag = item.querySelector('.risk-tag') ? item.querySelector('.risk-tag').outerHTML : '';
      html += '<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f0f7f8;font-size:10.5px">' +
        '<span><strong>' + n + '</strong> ¬∑ ' + rol + '</span>' + tag + '</div>';
    });
    html += '</div>';
  }

  // Evaluaci√≥n de riesgo
  var riskEl = document.querySelector('.risk-eval-grid');
  if (riskEl) {
    html += '<div class="sec">Evaluaci√≥n de riesgo</div><div class="pcard">';
    Array.from(riskEl.querySelectorAll('.risk-eval-item')).forEach(function(row) {
      var lbl  = row.querySelector('.risk-eval-label') ? row.querySelector('.risk-eval-label').textContent : '';
      var val  = row.querySelector('.risk-eval-val')   ? row.querySelector('.risk-eval-val').textContent   : '';
      var fill = row.querySelector('.risk-eval-bar div');
      var w    = fill ? ((fill.style.width || '50%')) : '50%';
      var bg   = fill ? ((fill.style.background || '#0097A7')) : '#0097A7';
      html += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:5px;font-size:10.5px">' +
        '<span style="width:140px;color:#374151">' + lbl + '</span>' +
        '<div style="flex:1;height:5px;background:#e5e7eb;border-radius:3px"><div style="width:' + w + ';height:5px;background:' + bg + ';border-radius:3px"></div></div>' +
        '<span style="width:36px;text-align:right">' + val + '</span></div>';
    });
    html += '</div>';
  }

  html += '</div>'; // /col izq

  // ‚îÄ‚îÄ Columna derecha ‚îÄ‚îÄ
  html += '<div>';

  // Asignaci√≥n
  html += '<div class="sec">Asignaci√≥n</div><div class="pcard">';
  [
    ['Investigador principal', 'assignName-inv'],
    ['Revisi√≥n legal',         'assignName-legal'],
    ['Supervisor',             null, 'M. √Ålvarez'],
    ['Equipo RRHH',            'assignName-rrhh']
  ].forEach(function(r) {
    var v = r[2] || (document.getElementById(r[1]) ? document.getElementById(r[1]).textContent.trim() : '‚Äî');
    html += '<div class="irow"><span>' + r[0] + '</span><span>' + v + '</span></div>';
  });
  html += '</div>';

  // Info del caso
  html += '<div class="sec">Informaci√≥n del caso</div><div class="pcard">';
  document.querySelectorAll('.case-info-row').forEach(function(row) {
    var spans = row.querySelectorAll('span, code');
    if (spans.length >= 2) {
      html += '<div class="irow"><span>' + spans[0].textContent + '</span><span>' + spans[spans.length-1].textContent + '</span></div>';
    }
  });
  html += '</div>';

  // Notas internas
  var notasEl = document.getElementById('notasList');
  if (notasEl && notasEl.querySelectorAll('.nota-item').length > 0) {
    html += '<div class="sec">Notas internas</div><div class="pcard">';
    notasEl.querySelectorAll('.nota-item').forEach(function(nota) {
      var meta  = nota.querySelector('.nota-meta') ? nota.querySelector('.nota-meta').textContent : '';
      var texto = nota.querySelector('.nota-body, p') ? nota.querySelector('.nota-body, p').textContent : '';
      html += '<div class="nota-p"><div class="nm">' + meta + '</div><div>' + texto + '</div></div>';
    });
    html += '</div>';
  }

  html += '</div>'; // /col der
  html += '</div>'; // /grid2

  // Timeline
  var tlEl = document.querySelector('.case-timeline');
  if (tlEl) {
    var tlItems = Array.from(tlEl.children).slice(0, 10);
    if (tlItems.length > 0) {
      html += '<div class="sec">Log de actividad</div><div class="pcard">';
      tlItems.forEach(function(item) {
        html += '<div class="tl-row">' + item.innerText.replace(/\n/g, ' ¬∑ ') + '</div>';
      });
      html += '</div>';
    }
  }

  html += '<div class="print-footer">Generado por Argus Compliance ¬∑ ' + fecha + ' ¬∑ Confidencial ‚Äî uso interno exclusivo</div>';

  // Inyectar en el print zone y llamar window.print()
  pz.innerHTML = html;
  document.title = 'Caso ' + caseId + ' ‚Äî ' + empresa;
  showToast('Abriendo di√°logo de impresi√≥n‚Ä¶', 'üñ®Ô∏è');
  setTimeout(function() {
    window.print();
    // Restaurar t√≠tulo despu√©s de imprimir
    setTimeout(function() {
      document.title = 'Caso ' + caseId + ' ¬∑ Argus Back Office';
    }, 2000);
  }, 100);
}

function exportCasoCsv() {
  // Recopilar datos del caso
  var empresa = (window.ArgusConfig ? ArgusConfig.get().empresa.nombre : '') || 'Argus';
  var fecha   = new Date().toISOString().slice(0,10);

  var status  = document.getElementById('caseStatusBadge') ? document.getElementById('caseStatusBadge').textContent.trim() : '';
  var titulo  = document.querySelector('.case-title') ? document.querySelector('.case-title').textContent.trim() : '';
  var caseMeta = document.querySelector('.case-meta') ? document.querySelector('.case-meta').innerText : '';

  // Info del caso desde el panel lateral
  var infoMap = {};
  document.querySelectorAll('.case-info-row').forEach(function(row) {
    var spans = row.querySelectorAll('span, code');
    if (spans.length >= 2) {
      infoMap[spans[0].textContent.trim()] = spans[spans.length-1].textContent.trim();
    }
  });

  // Asignaciones
  var invNombre   = document.getElementById('assignName-inv')   ? document.getElementById('assignName-inv').textContent.trim()   : '';
  var legalNombre = document.getElementById('assignName-legal') ? document.getElementById('assignName-legal').textContent.trim() : '';
  var rrhhNombre  = document.getElementById('assignName-rrhh')  ? document.getElementById('assignName-rrhh').textContent.trim()  : '';

  // Tags
  var tags = Array.from(document.querySelectorAll('#tagsList .bo-tag'))
    .map(function(t){ return t.textContent.replace(/\s*√ó\s*$/, '').trim(); }).join('; ');

  // Notas
  var notas = Array.from(document.querySelectorAll('#notasList .nota-item'))
    .map(function(n){
      var meta  = n.querySelector('.nota-meta') ? n.querySelector('.nota-meta').textContent.trim() : '';
      var texto = n.querySelector('.nota-body, p') ? n.querySelector('.nota-body, p').textContent.trim() : '';
      return meta + ': ' + texto;
    }).join(' | ');

  // Personas involucradas
  var personas = Array.from(document.querySelectorAll('.involved-item'))
    .map(function(p){
      var nombre = p.querySelector('strong') ? p.querySelector('strong').textContent.trim() : '';
      var rol    = p.querySelector('span')   ? p.querySelector('span').textContent.trim()   : '';
      return nombre + ' (' + rol + ')';
    }).join('; ');

  function esc(v){ return '"' + String(v||'').replace(/"/g,'""') + '"'; }

  var headers = [
    'ID Caso','T√≠tulo','Canal','Tipo','√Årea','Jurisdicci√≥n',
    'Riesgo','Estado','An√≥nima','Confidencialidad',
    'Investigador principal','Revisi√≥n legal','Equipo RRHH',
    'SLA objetivo','Vencimiento SLA',
    'Etiquetas','Personas involucradas','Notas internas',
    'Fecha ingreso','Exportado'
  ];

  var row = [
    caseId, titulo,
    infoMap['Canal'] || '', infoMap['Tipo'] || '', infoMap['√Årea'] || '', infoMap['Jurisdicci√≥n'] || '',
    infoMap['Riesgo'] || '', status,
    infoMap['An√≥nima'] || '', infoMap['Confidencialidad'] || '',
    invNombre, legalNombre, rrhhNombre,
    infoMap['SLA objetivo'] || '', infoMap['Vencimiento'] || '',
    tags, personas, notas,
    infoMap['Fecha ingreso'] || '', new Date().toLocaleDateString('es-AR')
  ];

  var csv = headers.map(esc).join(',') + '\r\n' + row.map(esc).join(',');
  var filename = 'caso_' + caseId + '_' + fecha + '.csv';

  var blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
  var url  = URL.createObjectURL(blob);
  var a    = document.createElement('a');
  a.href     = url;
  a.download = filename;
  a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  setTimeout(function(){ URL.revokeObjectURL(url); a.remove(); }, 1000);
  showToast('CSV descargado: ' + filename, 'üìÑ');
}

function gateLogout() {
  var sesionKey = 'argus_session_' + TENANT_CASO;
  sessionStorage.removeItem(sesionKey);
  window.location.href = 'backoffice.html';
}
</script>

<!-- Print zone: oculto en pantalla, visible solo al imprimir -->
<div id="argus-print-zone"></div>

</body>
</html>
