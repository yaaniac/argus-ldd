<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Back Office ¬∑ Argus Compliance</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <script src="client-config.js"></script>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê TENANT GATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tenant-gate" style="display:none;position:fixed;inset:0;z-index:9999;background:#001E22;align-items:center;justify-content:center">
  <div style="background:#002B2E;border:1px solid #004D55;border-radius:20px;padding:48px 40px;width:100%;max-width:420px;box-shadow:0 24px 80px rgba(0,0,0,.6)">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:32px">
      <svg width="36" height="36" viewBox="0 0 32 32" fill="none"><rect width="32" height="32" rx="8" fill="#0097A7"/><path d="M8 10h16M8 16h10M8 22h13" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/><circle cx="24" cy="22" r="4" fill="#fff"/><path d="M22.5 22l1 1 2-2" stroke="#0097A7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <div>
        <div style="font-size:20px;font-weight:800;color:#fff;letter-spacing:-.03em">Argus<span style="color:#0097A7">.</span></div>
        <div style="font-size:12px;color:#5F9EA5">Back Office</div>
      </div>
    </div>
    <h2 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 6px;letter-spacing:-.03em">Acceder al back office</h2>
    <p style="font-size:13px;color:#5F9EA5;margin:0 0 28px;line-height:1.6">Ingres√° el c√≥digo de tu empresa para acceder a tu panel.</p>
    <div style="display:flex;flex-direction:column;gap:14px">
      <div>
        <label style="font-size:12px;font-weight:600;color:#8CBDC3;text-transform:uppercase;letter-spacing:.06em;display:block;margin-bottom:6px">C√≥digo de empresa</label>
        <input id="gate-code" type="text" placeholder="ej: acme, banco-xyz, empresa-s-a"
          style="width:100%;box-sizing:border-box;background:#003340;border:1.5px solid #004D55;border-radius:10px;padding:11px 14px;font-size:14px;color:#fff;outline:none"
          onkeydown="if(event.key==='Enter') gateLogin()" />
      </div>
      <div id="gate-pin-wrap">
        <label style="font-size:12px;font-weight:600;color:#8CBDC3;text-transform:uppercase;letter-spacing:.06em;display:block;margin-bottom:6px">PIN (si tu empresa lo configur√≥)</label>
        <input id="gate-pin" type="password" placeholder="Dejar vac√≠o si no tiene PIN"
          style="width:100%;box-sizing:border-box;background:#003340;border:1.5px solid #004D55;border-radius:10px;padding:11px 14px;font-size:14px;color:#fff;outline:none"
          onkeydown="if(event.key==='Enter') gateLogin()" />
      </div>
      <div id="gate-error" style="display:none;font-size:12px;color:#F87171;background:rgba(248,113,113,.1);padding:10px 14px;border-radius:8px"></div>
      <button onclick="gateLogin()"
        style="background:#0097A7;color:#fff;border:none;border-radius:10px;padding:13px;font-size:14px;font-weight:700;cursor:pointer;margin-top:4px">
        Ingresar
      </button>
    </div>
    <p style="font-size:11px;color:#5F9EA5;text-align:center;margin:20px 0 0">
      ¬øPrimera vez? Ingres√° el c√≥digo que te dio tu administrador.<br/>
      Si no ten√©s PIN configurado, pod√©s dejar ese campo vac√≠o.
    </p>
  </div>
</div>

<div class="bo-shell">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SIDEBAR
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <aside class="bo-sidebar" id="sidebar">
    <div class="bo-sidebar-header">
      <div class="bo-logo">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="#0097A7"/>
          <path d="M8 10h16M8 16h10M8 22h13" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/>
          <circle cx="24" cy="22" r="4" fill="#fff"/>
          <path d="M22.5 22l1 1 2-2" stroke="#0097A7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <div class="bo-logo-name">Argus<span style="color:#0097A7">.</span></div>
          <div class="bo-logo-sub" id="sidebar-tenant-label">Back Office</div>
        </div>
      </div>
      <button class="bo-sidebar-toggle" id="sidebarToggleBtn" onclick="toggleSidebar()" aria-label="Colapsar o expandir men√∫">
        <svg class="sidebar-icon-collapse" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M10 3L5 8l5 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <svg class="sidebar-icon-expand" width="16" height="16" viewBox="0 0 16 16" fill="none" style="display:none"><path d="M6 3l5 5-5 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>

    <nav class="bo-nav">
      <div class="bo-nav-section">
        <span class="bo-nav-label">Principal</span>
        <a href="backoffice.html" class="bo-nav-item active">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="2" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="10" y="2" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="2" y="10" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="10" y="10" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="1.5"/></svg>
          <span>Dashboard</span>
        </a>
        <a href="#" class="bo-nav-item" onclick="event.preventDefault(); showView('casos')">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M14 3H4a1 1 0 00-1 1v10a1 1 0 001 1h10a1 1 0 001-1V4a1 1 0 00-1-1z" stroke="currentColor" stroke-width="1.5"/><path d="M6 7h6M6 10h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          <span>Casos</span>
          <span class="bo-badge-count">24</span>
        </a>
        <a href="#" class="bo-nav-item" onclick="event.preventDefault(); showView('tareas')">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M6 9l2 2 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><rect x="2" y="2" width="14" height="14" rx="3" stroke="currentColor" stroke-width="1.5"/></svg>
          <span>Mis tareas</span>
          <span class="bo-badge-count bo-badge-danger">3</span>
        </a>
      </div>

      <div class="bo-nav-section">
        <span class="bo-nav-label">Gesti√≥n</span>
        <a href="#" class="bo-nav-item" onclick="event.preventDefault(); showView('comunicaciones')">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M15 3H3a1 1 0 00-1 1v8a1 1 0 001 1h3l3 3 3-3h3a1 1 0 001-1V4a1 1 0 00-1-1z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
          <span>Comunicaciones</span>
        </a>
        <a href="backoffice-reportes.html" class="bo-nav-item">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M3 14V8M7 14V5M11 14V9M15 14V3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
          <span>Reportes</span>
        </a>
      </div>

      <div class="bo-nav-section">
        <span class="bo-nav-label">Sistema</span>
        <a href="#" class="bo-nav-item" onclick="event.preventDefault(); showView('auditoria')">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2L3 5v5c0 4 2.8 7.3 6 8 3.2-.7 6-4 6-8V5L9 2z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
          <span>Auditor√≠a / Log</span>
        </a>
        <a href="#" class="bo-nav-item" onclick="event.preventDefault(); showView('usuarios')">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="7" cy="6" r="3" stroke="currentColor" stroke-width="1.5"/><path d="M1 16c0-3.3 2.7-6 6-6h0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><circle cx="13" cy="11" r="3" stroke="currentColor" stroke-width="1.5"/><path d="M10 16h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M13 13.5v5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          <span>Usuarios y roles</span>
        </a>
        <a href="#" class="bo-nav-item" onclick="event.preventDefault(); showView('configuracion')">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2a1 1 0 011 1v.6a5.5 5.5 0 011.3.75l.52-.3a1 1 0 011.37.37l1 1.73a1 1 0 01-.37 1.37l-.52.3c.04.27.07.54.07.83s-.03.56-.07.83l.52.3a1 1 0 01.37 1.37l-1 1.73a1 1 0 01-1.37.37l-.52-.3A5.5 5.5 0 0110 14.4V15a1 1 0 01-2 0v-.6a5.5 5.5 0 01-1.3-.75l-.52.3a1 1 0 01-1.37-.37l-1-1.73a1 1 0 01.37-1.37l.52-.3A5.6 5.6 0 014.6 9c0-.29.03-.56.07-.83l-.52-.3a1 1 0 01-.37-1.37l1-1.73a1 1 0 011.37-.37l.52.3A5.5 5.5 0 018 3.6V3a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><circle cx="9" cy="9" r="2.2" stroke="currentColor" stroke-width="1.4"/></svg>
          <span>Configuraci√≥n</span>
        </a>
        <a id="nav-portal-link" href="index.html" class="bo-nav-item" target="_blank">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M7 3H3a1 1 0 00-1 1v11a1 1 0 001 1h11a1 1 0 001-1v-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M11 2h5v5M16 2l-7 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Ir al portal</span>
        </a>
        <a href="#" class="bo-nav-item" onclick="event.preventDefault(); gateLogout()" style="color:#F87171">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M7 3H3a1 1 0 00-1 1v10a1 1 0 001 1h4M12 12l3-3-3-3M7 9h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Cambiar empresa</span>
        </a>
      </div>
    </nav>

    <div class="bo-sidebar-user">
      <div class="bo-user-avatar">MA</div>
      <div class="bo-user-info">
        <strong>Mar√≠a √Ålvarez</strong>
        <span>Compliance Officer</span>
      </div>
    </div>
  </aside>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MAIN CONTENT
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <main class="bo-main" id="boMain">

    <!-- TOP BAR -->
    <header class="bo-topbar">
      <div class="bo-topbar-left">
        <button class="bo-mobile-menu" onclick="toggleSidebar()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        </button>
        <div class="bo-breadcrumb">
          <span>Argus Back Office</span>
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M5 3l4 4-4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span id="currentView">Dashboard</span>
        </div>
      </div>
      <div class="bo-topbar-right">
        <button class="bo-topbar-btn" onclick="showNewCase()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.4"/><path d="M8 5v6M5 8h6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
          Nuevo caso
        </button>
        <div class="bo-notif-btn" onclick="toggleNotifs()">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2a5 5 0 015 5v3l2 2H2l2-2V7a5 5 0 015-5z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/><path d="M7 15a2 2 0 004 0" stroke="currentColor" stroke-width="1.5"/></svg>
          <span class="bo-notif-dot"></span>
        </div>
        <div class="bo-topbar-avatar">MA</div>
      </div>
    </header>

    <!-- ‚ïê‚ïê‚ïê VIEW: DASHBOARD ‚ïê‚ïê‚ïê -->
    <div class="bo-view active" id="view-dashboard">

      <!-- DASHBOARD HERO HEADER -->
      <div class="dash-hero">
        <div class="dash-hero-left">
          <div class="dash-hero-greeting" id="dashGreeting">Buen d√≠a</div>
          <h1 class="dash-hero-title">Mar√≠a √Ålvarez <span class="dash-hero-role">‚Äî Compliance Officer</span></h1>
          <p class="dash-hero-sub"><span id="dashDate"></span> ¬∑ Resumen ejecutivo del sistema</p>
        </div>
        <div style="display:flex;gap:10px;align-items:center;flex-shrink:0">
          <select class="bo-select" onchange="updateDashboard(this.value)">
            <option value="30">√öltimos 30 d√≠as</option>
            <option value="90">√öltimos 90 d√≠as</option>
            <option value="365">Este a√±o</option>
          </select>
          <button class="bo-btn bo-btn-outline" onclick="exportDashPdf()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M2 2h7l3 3v7H2V2z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/><path d="M9 2v3h3M4 7h6M4 9.5h4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg>
            Exportar PDF
          </button>
        </div>
      </div>

      <!-- KPI CARDS -->
      <div class="bo-kpi-grid">
        <div class="bo-kpi-card">
          <div class="bo-kpi-header">
            <span class="bo-kpi-label">Casos abiertos</span>
            <div class="bo-kpi-icon" style="background:#E0F7FA;color:#0097A7">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M14 3H4a1 1 0 00-1 1v10a1 1 0 001 1h10a1 1 0 001-1V4a1 1 0 00-1-1z" stroke="currentColor" stroke-width="1.5"/><path d="M6 9h6M6 6h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </div>
          </div>
          <div class="bo-kpi-value">24</div>
          <div class="bo-kpi-delta up">+3 vs mes anterior</div>
        </div>
        <div class="bo-kpi-card">
          <div class="bo-kpi-header">
            <span class="bo-kpi-label">En investigaci√≥n</span>
            <div class="bo-kpi-icon" style="background:#FFF7ED;color:#EA580C">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="8" cy="8" r="5" stroke="currentColor" stroke-width="1.5"/><path d="M14 14l-2.5-2.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
            </div>
          </div>
          <div class="bo-kpi-value">7</div>
          <div class="bo-kpi-delta">Sin variaci√≥n</div>
        </div>
        <div class="bo-kpi-card">
          <div class="bo-kpi-header">
            <span class="bo-kpi-label">Vencidos / SLA roto</span>
            <div class="bo-kpi-icon" style="background:#FEF2F2;color:#DC2626">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/><path d="M9 5v4l2.5 2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
          </div>
          <div class="bo-kpi-value danger">3</div>
          <div class="bo-kpi-delta down">Requieren atenci√≥n inmediata</div>
        </div>
        <div class="bo-kpi-card">
          <div class="bo-kpi-header">
            <span class="bo-kpi-label">Cerrados este mes</span>
            <div class="bo-kpi-icon" style="background:#F0FDF4;color:#16A34A">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M4 9l4 4 6-7" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
          </div>
          <div class="bo-kpi-value">11</div>
          <div class="bo-kpi-delta up">+4 vs mes anterior</div>
        </div>
        <div class="bo-kpi-card">
          <div class="bo-kpi-header">
            <span class="bo-kpi-label">SLA promedio</span>
            <div class="bo-kpi-icon" style="background:#F5F3FF;color:#7C3AED">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/><path d="M9 5v4h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
          </div>
          <div class="bo-kpi-value">18<span style="font-size:18px;font-weight:500;color:#888"> d√≠as</span></div>
          <div class="bo-kpi-delta up">-2 d√≠as vs anterior</div>
        </div>
        <div class="bo-kpi-card">
          <div class="bo-kpi-header">
            <span class="bo-kpi-label">Tasa de confirmaci√≥n</span>
            <div class="bo-kpi-icon" style="background:#ECFDF5;color:#059669">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2l1.6 3.3L14 6.1l-2.5 2.5.6 3.7L9 10.6l-3.1 1.7.6-3.7L4 6.1l3.4-.8L9 2z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/></svg>
            </div>
          </div>
          <div class="bo-kpi-value">62<span style="font-size:18px;font-weight:500;color:#888">%</span></div>
          <div class="bo-kpi-delta up">Denuncias confirmadas</div>
        </div>
      </div>

      <!-- CHARTS + TABLE ROW -->
      <div class="bo-dash-grid">

        <!-- Monthly chart -->
        <div class="bo-card bo-card-chart">
          <div class="bo-card-header">
            <h3>Evoluci√≥n de casos</h3>
            <div style="display:flex;gap:16px;align-items:center">
              <span class="bo-legend"><span style="background:#0097A7"></span>Recibidos</span>
              <span class="bo-legend"><span style="background:#16A34A"></span>Cerrados</span>
            </div>
          </div>
          <div class="bo-chart-area">
            <canvas id="casesChart" height="200"></canvas>
          </div>
        </div>

        <!-- Risk distribution -->
        <div class="bo-card">
          <div class="bo-card-header"><h3>Distribuci√≥n por riesgo</h3></div>
          <div class="bo-risk-bars">
            <div class="bo-risk-row">
              <span class="risk-tag risk-critical">CR√çTICO</span>
              <div class="bo-risk-bar-wrap"><div class="bo-risk-bar" style="width:15%;background:#DC2626"></div></div>
              <span class="bo-risk-n">4</span>
            </div>
            <div class="bo-risk-row">
              <span class="risk-tag risk-high">ALTO</span>
              <div class="bo-risk-bar-wrap"><div class="bo-risk-bar" style="width:30%;background:#EA580C"></div></div>
              <span class="bo-risk-n">8</span>
            </div>
            <div class="bo-risk-row">
              <span class="risk-tag risk-medium">MEDIO</span>
              <div class="bo-risk-bar-wrap"><div class="bo-risk-bar" style="width:42%;background:#D97706"></div></div>
              <span class="bo-risk-n">11</span>
            </div>
            <div class="bo-risk-row">
              <span class="risk-tag risk-low">BAJO</span>
              <div class="bo-risk-bar-wrap"><div class="bo-risk-bar" style="width:13%;background:#16A34A"></div></div>
              <span class="bo-risk-n">1</span>
            </div>
          </div>

          <div class="bo-card-divider"></div>
          <div class="bo-card-header"><h3>Por tipo de denuncia</h3></div>
          <div class="bo-type-pills">
            <span class="bo-type-pill">Fraude ¬∑ <strong>7</strong></span>
            <span class="bo-type-pill">Acoso laboral ¬∑ <strong>5</strong></span>
            <span class="bo-type-pill">Corrupci√≥n ¬∑ <strong>4</strong></span>
            <span class="bo-type-pill">Conflicto inter√©s ¬∑ <strong>3</strong></span>
            <span class="bo-type-pill">AML ¬∑ <strong>3</strong></span>
            <span class="bo-type-pill">Acoso sexual ¬∑ <strong>2</strong></span>
          </div>
        </div>

      </div>

      <!-- ALERTS + CASES TABLE -->
      <div class="bo-dash-grid bo-dash-grid-32">

        <!-- Alerts -->
        <div class="bo-card">
          <div class="bo-card-header"><h3>‚ö†Ô∏è Alertas activas</h3></div>
          <div class="bo-alerts-list">
            <div class="bo-alert bo-alert-danger">
              <div class="bo-alert-icon">üî¥</div>
              <div>
                <strong>ARG-2025-0041</strong>
                <p>Vencido hace 5 d√≠as ¬∑ Fraude financiero ¬∑ Sin investigador asignado</p>
              </div>
              <a href="backoffice-caso.html?id=ARG-2025-0041" class="bo-alert-link">Ver ‚Üí</a>
            </div>
            <div class="bo-alert bo-alert-danger">
              <div class="bo-alert-icon">üî¥</div>
              <div>
                <strong>ARG-2025-0038</strong>
                <p>Vencido hace 2 d√≠as ¬∑ Acoso laboral ¬∑ Pendiente de evaluaci√≥n</p>
              </div>
              <a href="backoffice-caso.html?id=ARG-2025-0038" class="bo-alert-link">Ver ‚Üí</a>
            </div>
            <div class="bo-alert bo-alert-warn">
              <div class="bo-alert-icon">üü°</div>
              <div>
                <strong>ARG-2025-0039</strong>
                <p>Vence en 2 d√≠as ¬∑ Corrupci√≥n ¬∑ Investigaci√≥n en curso</p>
              </div>
              <a href="backoffice-caso.html?id=ARG-2025-0039" class="bo-alert-link">Ver ‚Üí</a>
            </div>
            <div class="bo-alert bo-alert-warn">
              <div class="bo-alert-icon">üü°</div>
              <div>
                <strong>ARG-2025-0042</strong>
                <p>Sin movimiento hace 8 d√≠as ¬∑ AML ¬∑ Asignado a R. Mendoza</p>
              </div>
              <a href="backoffice-caso.html?id=ARG-2025-0042" class="bo-alert-link">Ver ‚Üí</a>
            </div>
            <div class="bo-alert bo-alert-info">
              <div class="bo-alert-icon">üîµ</div>
              <div>
                <strong>ARG-2025-0044</strong>
                <p>Nuevo mensaje del denunciante ¬∑ Pendiente de respuesta</p>
              </div>
              <a href="backoffice-caso.html?id=ARG-2025-0044" class="bo-alert-link">Ver ‚Üí</a>
            </div>
          </div>
        </div>

        <!-- Area breakdown -->
        <div class="bo-card">
          <div class="bo-card-header"><h3>Casos por √°rea</h3></div>
          <div class="bo-area-list">
            <div class="bo-area-row">
              <div class="bo-area-label">
                <span class="bo-area-dot" style="background:#0097A7"></span>
                Finanzas / Contabilidad
              </div>
              <div class="bo-area-bar-wrap">
                <div class="bo-area-bar" style="width:35%;background:#0097A7"></div>
              </div>
              <span class="bo-area-n">8</span>
            </div>
            <div class="bo-area-row">
              <div class="bo-area-label">
                <span class="bo-area-dot" style="background:#EA580C"></span>
                Recursos Humanos
              </div>
              <div class="bo-area-bar-wrap">
                <div class="bo-area-bar" style="width:25%;background:#EA580C"></div>
              </div>
              <span class="bo-area-n">6</span>
            </div>
            <div class="bo-area-row">
              <div class="bo-area-label">
                <span class="bo-area-dot" style="background:#D97706"></span>
                Compras / Proveedores
              </div>
              <div class="bo-area-bar-wrap">
                <div class="bo-area-bar" style="width:20%;background:#D97706"></div>
              </div>
              <span class="bo-area-n">5</span>
            </div>
            <div class="bo-area-row">
              <div class="bo-area-label">
                <span class="bo-area-dot" style="background:#7C3AED"></span>
                Direcci√≥n General
              </div>
              <div class="bo-area-bar-wrap">
                <div class="bo-area-bar" style="width:15%;background:#7C3AED"></div>
              </div>
              <span class="bo-area-n">3</span>
            </div>
            <div class="bo-area-row">
              <div class="bo-area-label">
                <span class="bo-area-dot" style="background:#0284C7"></span>
                Operaciones
              </div>
              <div class="bo-area-bar-wrap">
                <div class="bo-area-bar" style="width:8%;background:#0284C7"></div>
              </div>
              <span class="bo-area-n">2</span>
            </div>
          </div>
        </div>

      </div>

      <!-- CASES TABLE -->
      <div class="bo-card" style="margin-top:0">
        <div class="bo-card-header">
          <h3>Casos recientes</h3>
          <a href="#" onclick="showView('casos')" class="bo-link">Ver todos ‚Üí</a>
        </div>

        <div class="bo-table-wrap">
          <table class="bo-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Tipo</th>
                <th>√Årea</th>
                <th>Riesgo</th>
                <th>Estado</th>
                <th>Investigador</th>
                <th>SLA</th>
                <th>Recibido</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr onclick="goToCase('ARG-2025-0044')" class="bo-table-row">
                <td><code class="bo-code">ARG-2025-0044</code></td>
                <td>Acoso laboral</td>
                <td>RRHH</td>
                <td><span class="risk-tag risk-high">ALTO</span></td>
                <td><span class="status-tag status-new">Nuevo</span></td>
                <td><span class="bo-unassigned">Sin asignar</span></td>
                <td><span class="sla-tag sla-ok">23 d√≠as</span></td>
                <td>22/02/2025</td>
                <td><a href="backoffice-caso.html?id=ARG-2025-0044" class="bo-table-link">Abrir</a></td>
              </tr>
              <tr onclick="goToCase('ARG-2025-0043')" class="bo-table-row">
                <td><code class="bo-code">ARG-2025-0043</code></td>
                <td>Fraude financiero</td>
                <td>Finanzas</td>
                <td><span class="risk-tag risk-critical">CR√çTICO</span></td>
                <td><span class="status-tag status-investigating">Investigando</span></td>
                <td>R. Mendoza</td>
                <td><span class="sla-tag sla-warn">8 d√≠as</span></td>
                <td>18/02/2025</td>
                <td><a href="backoffice-caso.html?id=ARG-2025-0043" class="bo-table-link">Abrir</a></td>
              </tr>
              <tr onclick="goToCase('ARG-2025-0042')" class="bo-table-row">
                <td><code class="bo-code">ARG-2025-0042</code></td>
                <td>AML / Lavado</td>
                <td>Compras</td>
                <td><span class="risk-tag risk-critical">CR√çTICO</span></td>
                <td><span class="status-tag status-investigating">Investigando</span></td>
                <td>R. Mendoza</td>
                <td><span class="sla-tag sla-warn">5 d√≠as</span></td>
                <td>14/02/2025</td>
                <td><a href="backoffice-caso.html?id=ARG-2025-0042" class="bo-table-link">Abrir</a></td>
              </tr>
              <tr onclick="goToCase('ARG-2025-0041')" class="bo-table-row">
                <td><code class="bo-code">ARG-2025-0041</code></td>
                <td>Fraude financiero</td>
                <td>Finanzas</td>
                <td><span class="risk-tag risk-high">ALTO</span></td>
                <td><span class="status-tag status-new">Nuevo</span></td>
                <td><span class="bo-unassigned">Sin asignar</span></td>
                <td><span class="sla-tag sla-over">Vencido</span></td>
                <td>10/02/2025</td>
                <td><a href="backoffice-caso.html?id=ARG-2025-0041" class="bo-table-link">Abrir</a></td>
              </tr>
              <tr onclick="goToCase('ARG-2025-0040')" class="bo-table-row">
                <td><code class="bo-code">ARG-2025-0040</code></td>
                <td>Conflicto inter√©s</td>
                <td>Direcci√≥n</td>
                <td><span class="risk-tag risk-medium">MEDIO</span></td>
                <td><span class="status-tag status-review">En revisi√≥n</span></td>
                <td>M. √Ålvarez</td>
                <td><span class="sla-tag sla-ok">16 d√≠as</span></td>
                <td>08/02/2025</td>
                <td><a href="backoffice-caso.html?id=ARG-2025-0040" class="bo-table-link">Abrir</a></td>
              </tr>
              <tr onclick="goToCase('ARG-2025-0039')" class="bo-table-row">
                <td><code class="bo-code">ARG-2025-0039</code></td>
                <td>Corrupci√≥n</td>
                <td>Compras</td>
                <td><span class="risk-tag risk-critical">CR√çTICO</span></td>
                <td><span class="status-tag status-investigating">Investigando</span></td>
                <td>J. Torres</td>
                <td><span class="sla-tag sla-warn">2 d√≠as</span></td>
                <td>05/02/2025</td>
                <td><a href="backoffice-caso.html?id=ARG-2025-0039" class="bo-table-link">Abrir</a></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div><!-- /view-dashboard -->

    <!-- ‚ïê‚ïê‚ïê VIEW: CASOS (lista completa) ‚ïê‚ïê‚ïê -->
    <div class="bo-view" id="view-casos">
      <div class="bo-page-header">
        <div>
          <h1 class="bo-page-title">Repositorio de casos</h1>
          <p class="bo-page-sub">24 casos activos ¬∑ 87 totales</p>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="bo-btn bo-btn-ghost" onclick="exportCasosCsv()" title="Exportar casos visibles a CSV">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><rect x="1" y="2" width="12" height="10" rx="1.5" stroke="currentColor" stroke-width="1.3"/><path d="M1 5h12M4 5v7M8 5v7" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg>
            CSV
          </button>
          <button class="bo-btn bo-btn-ghost" onclick="exportCasosPdf()" title="Exportar casos visibles a PDF">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M2 2h7l3 3v7H2V2z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/><path d="M9 2v3h3M4 7h6M4 9.5h4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg>
            PDF
          </button>
          <button class="bo-btn bo-btn-primary" onclick="showNewCase()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><circle cx="7" cy="7" r="6" stroke="currentColor" stroke-width="1.4"/><path d="M7 4v6M4 7h6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
            Ingresar caso manual
          </button>
        </div>
      </div>

      <!-- Filters -->
      <div class="bo-filters">
        <div class="bo-search-wrap">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="7" cy="7" r="4.5" stroke="#9CA3AF" stroke-width="1.5"/><path d="M11 11l2.5 2.5" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round"/></svg>
          <input type="text" class="bo-search" id="casoBusqueda" placeholder="Buscar por ID, tipo, √°rea, persona..." oninput="filterCasos()" />
        </div>
        <div class="bo-filter-row">
          <select class="bo-select-sm" id="filterEstado" onchange="filterCasos()"><option value="">Todos los estados</option><option value="new">Nuevo</option><option value="eval">En evaluaci√≥n</option><option value="investigating">Investigando</option><option value="review">En revisi√≥n</option><option value="closed-ok">Cerrado</option></select>
          <select class="bo-select-sm" id="filterRiesgo" onchange="filterCasos()"><option value="">Todos los riesgos</option><option value="critical">Cr√≠tico</option><option value="high">Alto</option><option value="medium">Medio</option><option value="low">Bajo</option></select>
          <select class="bo-select-sm" id="filterArea" onchange="filterCasos()"><option value="">Todas las √°reas</option><option value="Finanzas">Finanzas</option><option value="RRHH">RRHH</option><option value="Compras">Compras</option><option value="Direcci√≥n">Direcci√≥n</option><option value="Operaciones">Operaciones</option></select>
          <select class="bo-select-sm" id="filterTipo" onchange="filterCasos()"><option value="">Todos los tipos</option><option value="Fraude">Fraude</option><option value="Acoso">Acoso</option><option value="Corrupci√≥n">Corrupci√≥n</option><option value="AML">AML</option><option value="Conflicto inter√©s">Conflicto inter√©s</option></select>
          <button class="bo-btn bo-btn-ghost" id="btnFiltrosAvanzados" onclick="toggleFiltrosAvanzados()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M2 4h10M4 7h6M6 10h2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
            Filtros avanzados
          </button>
        </div>
        <div class="bo-filtros-avanzados-panel" id="filtrosAvanzadosPanel" style="display:none">
          <div class="bo-form-grid" style="grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;margin-top:12px;padding:16px;background:var(--gray-50);border-radius:8px;border:1px solid var(--gray-200)">
            <div><label style="font-size:11px;color:var(--gray-500);display:block;margin-bottom:4px">Fecha desde</label><input type="date" class="bo-select-sm" style="width:100%"/></div>
            <div><label style="font-size:11px;color:var(--gray-500);display:block;margin-bottom:4px">Fecha hasta</label><input type="date" class="bo-select-sm" style="width:100%"/></div>
            <div><label style="font-size:11px;color:var(--gray-500);display:block;margin-bottom:4px">Investigador</label><select class="bo-select-sm" style="width:100%"><option>Todos</option><option>M. √Ålvarez</option><option>R. Mendoza</option><option>J. Torres</option></select></div>
            <div><label style="font-size:11px;color:var(--gray-500);display:block;margin-bottom:4px">Canal</label><select class="bo-select-sm" style="width:100%"><option>Todos</option><option>Web</option><option>Email</option><option>WhatsApp</option><option>Tel√©fono</option></select></div>
            <div style="align-self:end"><button type="button" class="bo-btn bo-btn-primary" onclick="aplicarFiltrosAvanzados()">Aplicar</button></div>
          </div>
        </div>
      </div>

      <div class="bo-card">
        <div class="bo-table-wrap">
          <table class="bo-table">
            <thead>
              <tr>
                <th><input type="checkbox" class="bo-checkbox" /></th>
                <th>ID <svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M3 4l2-2 2 2M3 6l2 2 2-2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg></th>
                <th>Tipo</th>
                <th>√Årea</th>
                <th>Canal</th>
                <th>Riesgo</th>
                <th>Estado</th>
                <th>An√≥nimo</th>
                <th>Investigador</th>
                <th>SLA</th>
                <th>Ingreso</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="casosTableBody">
              <!-- Generado por JS -->
            </tbody>
          </table>
        </div>
        <div class="bo-table-footer">
          <span class="bo-table-info">Mostrando 1‚Äì10 de 24 casos activos</span>
          <div class="bo-pagination">
            <button class="bo-page-btn" disabled>‚Üê</button>
            <button class="bo-page-btn active">1</button>
            <button class="bo-page-btn">2</button>
            <button class="bo-page-btn">3</button>
            <button class="bo-page-btn">‚Üí</button>
          </div>
        </div>
      </div>
    </div><!-- /view-casos -->

    <!-- ‚ïê‚ïê‚ïê VIEW: AUDITOR√çA ‚ïê‚ïê‚ïê -->
    <div class="bo-view" id="view-auditoria">
      <div class="bo-page-header">
        <h1 class="bo-page-title">Log de auditor√≠a</h1>
        <button class="bo-btn bo-btn-outline">Exportar log completo</button>
      </div>
      <div class="bo-card">
        <div class="bo-card-header">
          <span style="font-size:13px;color:#666">Registro inmutable de todas las acciones del sistema</span>
        </div>
        <div class="bo-log-list">
          <div class="bo-log-item">
            <div class="bo-log-time">22/02/2025 14:32</div>
            <div class="bo-log-user"><span class="bo-log-avatar">MA</span> M. √Ålvarez</div>
            <div class="bo-log-action">Abri√≥ caso <code class="bo-code">ARG-2025-0044</code></div>
            <div class="bo-log-ip">IP: 192.168.1.45</div>
          </div>
          <div class="bo-log-item">
            <div class="bo-log-time">22/02/2025 13:18</div>
            <div class="bo-log-user"><span class="bo-log-avatar" style="background:#059669">JT</span> J. Torres</div>
            <div class="bo-log-action">Cambi√≥ estado <code class="bo-code">ARG-2025-0039</code> ‚Üí Investigando</div>
            <div class="bo-log-ip">IP: 192.168.1.71</div>
          </div>
          <div class="bo-log-item">
            <div class="bo-log-time">22/02/2025 11:05</div>
            <div class="bo-log-user"><span class="bo-log-avatar" style="background:#D97706">RM</span> R. Mendoza</div>
            <div class="bo-log-action">Subi√≥ documento a <code class="bo-code">ARG-2025-0043</code> (contrato_proveedor.pdf)</div>
            <div class="bo-log-ip">IP: 10.0.0.12</div>
          </div>
          <div class="bo-log-item">
            <div class="bo-log-time">21/02/2025 17:44</div>
            <div class="bo-log-user"><span class="bo-log-avatar">MA</span> M. √Ålvarez</div>
            <div class="bo-log-action">Asign√≥ investigador en <code class="bo-code">ARG-2025-0042</code> ‚Üí R. Mendoza</div>
            <div class="bo-log-ip">IP: 192.168.1.45</div>
          </div>
          <div class="bo-log-item">
            <div class="bo-log-time">21/02/2025 16:20</div>
            <div class="bo-log-user"><span class="bo-log-avatar" style="background:#7C3AED">LG</span> L. Garc√≠a</div>
            <div class="bo-log-action">Descarg√≥ reporte ejecutivo mensual (febrero 2025)</div>
            <div class="bo-log-ip">IP: 10.0.0.8</div>
          </div>
          <div class="bo-log-item">
            <div class="bo-log-time">20/02/2025 09:11</div>
            <div class="bo-log-user"><span class="bo-log-avatar">MA</span> M. √Ålvarez</div>
            <div class="bo-log-action">Cerr√≥ caso <code class="bo-code">ARG-2025-0037</code> ‚Äî Decisi√≥n: Confirmado ¬∑ Sanci√≥n: Suspensi√≥n</div>
            <div class="bo-log-ip">IP: 192.168.1.45</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê VIEW: USUARIOS ‚ïê‚ïê‚ïê -->
    <div class="bo-view" id="view-usuarios">
      <div class="bo-page-header">
        <h1 class="bo-page-title">Usuarios y roles</h1>
        <div style="display:flex;gap:10px" id="usr-header-actions">
          <button class="bo-btn bo-btn-primary" onclick="showInviteModal()">+ Invitar usuario</button>
        </div>
      </div>

      <!-- Sub-tabs -->
      <div class="usr-tabs">
        <button class="usr-tab active" id="usrtab-users" onclick="showUsrTab('users',this)">
          <svg width="15" height="15" viewBox="0 0 15 15" fill="none"><circle cx="6" cy="5" r="2.5" stroke="currentColor" stroke-width="1.3"/><path d="M1 13c0-2.8 2.2-5 5-5h0" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/><circle cx="11" cy="9" r="2.5" stroke="currentColor" stroke-width="1.3"/><path d="M8.5 13h5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/><path d="M11 11v4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg>
          Usuarios
        </button>
        <button class="usr-tab" id="usrtab-roles" onclick="showUsrTab('roles',this)">
          <svg width="15" height="15" viewBox="0 0 15 15" fill="none"><path d="M7.5 1L2 3.5v4c0 3.3 2.3 6.1 5.5 6.7C10.7 13.6 13 10.8 13 7.5v-4L7.5 1z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/><path d="M5 7.5l2 2 3-3" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Roles y permisos
        </button>
      </div>

      <!-- ‚îÄ‚îÄ Panel: Usuarios ‚îÄ‚îÄ -->
      <div id="usrpanel-users" class="usr-panel">
        <div class="bo-card">
          <div class="bo-table-wrap">
            <table class="bo-table">
              <thead>
                <tr><th>Usuario</th><th>Rol</th><th>Jurisdicci√≥n</th><th>Casos accesibles</th><th>√öltimo acceso</th><th>Estado</th><th></th></tr>
              </thead>
              <tbody id="users-table-body">
                <!-- Renderizado por renderUsersTable() -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ Panel: Roles y permisos ‚îÄ‚îÄ -->
      <div id="usrpanel-roles" class="usr-panel" style="display:none">

        <!-- Roles existentes -->
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
          <p style="font-size:13px;color:var(--gray-500);margin:0">Defin√≠ qu√© puede hacer cada rol dentro del back office. Los roles del sistema no se pueden eliminar.</p>
          <button class="bo-btn bo-btn-primary" style="white-space:nowrap" onclick="openRoleModal()">+ Nuevo rol</button>
        </div>

        <div id="roles-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px"></div>

        <!-- Tabla de permisos completa (toggle) -->
        <div style="margin-top:28px">
          <button class="bo-btn bo-btn-ghost" style="font-size:12px;margin-bottom:14px" onclick="togglePermsMatrix()">
            Ver matriz completa de permisos ‚Üï
          </button>
          <div id="perms-matrix-wrap" style="display:none">
            <div class="bo-card" style="overflow-x:auto">
              <table class="bo-table" id="perms-matrix-table">
                <thead><tr id="perms-matrix-head"></tr></thead>
                <tbody id="perms-matrix-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ MODAL: Editar / Crear Rol ‚îÄ‚îÄ -->
    <div id="roleModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1000;align-items:center;justify-content:center">
      <div style="background:var(--white);border-radius:16px;padding:32px;width:100%;max-width:560px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.25)">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px">
          <h2 style="font-size:18px;font-weight:800;color:var(--black);margin:0" id="roleModalTitle">Nuevo rol</h2>
          <button onclick="closeRoleModal()" style="background:none;border:none;font-size:20px;cursor:pointer;color:var(--gray-400)">‚úï</button>
        </div>

        <input type="hidden" id="roleModalId" />

        <div style="display:flex;flex-direction:column;gap:16px">
          <div class="bo-form-group">
            <label>Nombre del rol *</label>
            <input type="text" class="bo-select-full" id="roleModalNombre" placeholder="Ej: Compliance Manager" />
          </div>
          <div class="bo-form-group">
            <label>Descripci√≥n</label>
            <input type="text" class="bo-select-full" id="roleModalDesc" placeholder="Ej: Gestiona todos los casos de compliance" />
          </div>
          <div style="display:flex;align-items:center;gap:12px">
            <div class="bo-form-group" style="flex:1;margin:0">
              <label>Color del badge</label>
              <div style="display:flex;align-items:center;gap:10px;margin-top:6px">
                <input type="color" id="roleModalColor" value="#0097A7" style="width:40px;height:32px;border-radius:6px;border:1px solid var(--gray-200);cursor:pointer" />
                <input type="text" id="roleModalColorHex" class="bo-select-full" value="#0097A7" placeholder="#0097A7" style="flex:1" oninput="this.previousElementSibling.value=this.value" />
              </div>
            </div>
            <div class="bo-form-group" style="margin:0">
              <label>Vista previa</label>
              <div style="margin-top:6px"><span id="roleModalPreview" style="display:inline-flex;padding:4px 12px;border-radius:100px;font-size:12px;font-weight:700;background:#E0F7FA;color:#0097A7">Rol</span></div>
            </div>
          </div>

          <!-- Permisos -->
          <div>
            <label style="font-size:13px;font-weight:600;color:var(--black);display:block;margin-bottom:12px">Permisos</label>
            <div id="roleModalPerms" style="display:flex;flex-direction:column;gap:0;border:1px solid var(--gray-200);border-radius:10px;overflow:hidden"></div>
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:24px;justify-content:flex-end">
          <button class="bo-btn bo-btn-ghost" onclick="closeRoleModal()">Cancelar</button>
          <button class="bo-btn bo-btn-primary" onclick="saveRole()">Guardar rol</button>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê VIEW: CONFIGURACI√ìN ‚ïê‚ïê‚ïê -->
    <div class="bo-view" id="view-configuracion">
      <div class="bo-page-header">
        <div>
          <h1 class="bo-page-title">Configuraci√≥n del portal</h1>
          <p class="bo-page-sub">Personaliz√° el portal de denuncias para tu organizaci√≥n. Los cambios se aplican de inmediato en el sitio p√∫blico.</p>
        </div>
        <div style="display:flex;gap:10px">
          <button class="bo-btn bo-btn-ghost" onclick="cfgReset()">Restaurar defaults</button>
          <button class="bo-btn bo-btn-primary" onclick="cfgSaveAll()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M2 7l4 4 6-6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Guardar cambios
          </button>
        </div>
      </div>

      <!-- TABS de configuraci√≥n -->
      <div class="cfg-tabs">
        <button class="cfg-tab active" onclick="showCfgTab('empresa', this)">üè¢ Empresa</button>
        <button class="cfg-tab" onclick="showCfgTab('landing', this)">üåê Landing</button>
        <button class="cfg-tab" onclick="showCfgTab('categorias', this)">üè∑Ô∏è Categor√≠as</button>
        <button class="cfg-tab" onclick="showCfgTab('canales', this)">üì° Canales</button>
        <button class="cfg-tab" onclick="showCfgTab('faq', this)">‚ùì FAQ</button>
        <button class="cfg-tab" onclick="showCfgTab('formulario', this)">üìã Formulario</button>
        <button class="cfg-tab" onclick="showCfgTab('apariencia', this)">üé® Apariencia</button>
      </div>

      <!-- TAB: Empresa -->
      <div class="cfg-panel active" id="cfgpanel-empresa">
        <div class="bo-card" style="padding:28px">
          <h3 class="cfg-section-title">Datos de la empresa</h3>
          <div class="bo-form-grid">
            <div class="bo-form-group">
              <label>Nombre de la empresa *</label>
              <input type="text" class="bo-select-full" id="cfg-empresa-nombre" placeholder="Ej: Acme S.A." />
            </div>
            <div class="bo-form-group">
              <label>Slogan del portal</label>
              <input type="text" class="bo-select-full" id="cfg-empresa-slogan" placeholder="Ej: Canal confidencial de denuncias" />
            </div>
            <div class="bo-form-group">
              <label>Email de contacto / denuncias</label>
              <input type="email" class="bo-select-full" id="cfg-empresa-email" placeholder="denuncias@empresa.com" />
            </div>
            <div class="bo-form-group">
              <label>Tel√©fono / 0800</label>
              <input type="text" class="bo-select-full" id="cfg-empresa-telefono" placeholder="0800-XXX-XXXX" />
            </div>
            <div class="bo-form-group bo-span2">
              <label>URL del logo (imagen)</label>
              <input type="url" class="bo-select-full" id="cfg-empresa-logoUrl" placeholder="https://..." />
              <span style="font-size:11px;color:var(--gray-500);margin-top:4px;display:block">Sub√≠ la imagen a un servidor y peg√° la URL. Formatos: PNG, SVG, JPG.</span>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB: Landing -->
      <div class="cfg-panel" id="cfgpanel-landing" style="display:none">
        <div class="bo-card" style="padding:28px">
          <h3 class="cfg-section-title">Texto del hero (portada)</h3>
          <div class="bo-form-grid">
            <div class="bo-form-group bo-span2">
              <label>T√≠tulo principal</label>
              <input type="text" class="bo-select-full" id="cfg-landing-heroTitle" placeholder="Ej: Tu denuncia importa. Tu identidad, protegida." />
              <span style="font-size:11px;color:var(--gray-500);margin-top:4px;display:block">Pod√©s usar &lt;br/&gt; para saltos de l√≠nea.</span>
            </div>
            <div class="bo-form-group bo-span2">
              <label>Subt√≠tulo / descripci√≥n</label>
              <textarea class="bo-textarea" id="cfg-landing-heroSubtitle" rows="3" placeholder="Describ√≠ el prop√≥sito del canal..."></textarea>
            </div>
            <div class="bo-form-group">
              <label>Texto del bot√≥n principal</label>
              <input type="text" class="bo-select-full" id="cfg-landing-ctaLabel" placeholder="Hacer una denuncia" />
            </div>
            <div class="bo-form-group">
              <label>Texto del bot√≥n secundario</label>
              <input type="text" class="bo-select-full" id="cfg-landing-ctaSecLabel" placeholder="Seguir mi caso" />
            </div>
          </div>
        </div>
      </div>

      <!-- TAB: Categor√≠as -->
      <div class="cfg-panel" id="cfgpanel-categorias" style="display:none">
        <div class="bo-card" style="padding:28px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
            <h3 class="cfg-section-title" style="margin:0">Categor√≠as de denuncia</h3>
            <button class="bo-btn bo-btn-primary" style="font-size:12px" onclick="cfgAddCategoria()">+ Agregar categor√≠a</button>
          </div>
          <p style="font-size:13px;color:var(--gray-500);margin-bottom:16px">Estas categor√≠as aparecen en el formulario de denuncia para que el denunciante clasifique su caso.</p>
          <div id="cfg-categorias-list" style="display:flex;flex-direction:column;gap:8px"></div>
        </div>
      </div>

      <!-- TAB: Canales -->
      <div class="cfg-panel" id="cfgpanel-canales" style="display:none">
        <div class="bo-card" style="padding:28px">
          <h3 class="cfg-section-title">Canales habilitados</h3>
          <p style="font-size:13px;color:var(--gray-500);margin-bottom:20px">Activ√° los canales de denuncia disponibles para tu organizaci√≥n. Solo los activos aparecer√°n en el portal.</p>
          <div style="display:flex;flex-direction:column;gap:16px">
            <label class="cfg-toggle-row">
              <div>
                <strong>Canal web</strong>
                <p style="font-size:12px;color:var(--gray-500);margin:2px 0 0">Formulario en l√≠nea en el portal</p>
              </div>
              <input type="checkbox" class="cfg-toggle" id="cfg-canal-web" checked />
            </label>
            <label class="cfg-toggle-row">
              <div>
                <strong>Email confidencial</strong>
                <p style="font-size:12px;color:var(--gray-500);margin:2px 0 0">Bandeja de entrada dedicada</p>
              </div>
              <input type="checkbox" class="cfg-toggle" id="cfg-canal-email" checked />
            </label>
            <label class="cfg-toggle-row">
              <div>
                <strong>Tel√©fono / 0800</strong>
                <p style="font-size:12px;color:var(--gray-500);margin:2px 0 0">L√≠nea de atenci√≥n humana</p>
              </div>
              <input type="checkbox" class="cfg-toggle" id="cfg-canal-telefono" checked />
            </label>
            <label class="cfg-toggle-row">
              <div>
                <strong>WhatsApp</strong>
                <p style="font-size:12px;color:var(--gray-500);margin:2px 0 0">Canal de mensajer√≠a</p>
              </div>
              <input type="checkbox" class="cfg-toggle" id="cfg-canal-whatsapp" checked />
            </label>
          </div>
        </div>
      </div>

      <!-- TAB: FAQ -->
      <div class="cfg-panel" id="cfgpanel-faq" style="display:none">
        <div class="bo-card" style="padding:28px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
            <h3 class="cfg-section-title" style="margin:0">Preguntas frecuentes</h3>
            <button class="bo-btn bo-btn-primary" style="font-size:12px" onclick="cfgAddFaq()">+ Agregar pregunta</button>
          </div>
          <p style="font-size:13px;color:var(--gray-500);margin-bottom:16px">Estas preguntas aparecen en la secci√≥n de contacto del portal.</p>
          <div id="cfg-faq-list" style="display:flex;flex-direction:column;gap:12px"></div>
        </div>
      </div>

      <!-- TAB: Formulario -->
      <div class="cfg-panel" id="cfgpanel-formulario" style="display:none">
        <div class="bo-card" style="padding:28px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
            <div>
              <h3 class="cfg-section-title" style="margin:0">Preguntas del formulario</h3>
              <p style="font-size:13px;color:var(--gray-500);margin:6px 0 0">Agreg√° campos extra que aparecer√°n en el formulario de denuncia (despu√©s del paso de categor√≠as).</p>
            </div>
            <button class="bo-btn bo-btn-primary" style="font-size:12px;white-space:nowrap" onclick="cfgAddCampo()">+ Agregar pregunta</button>
          </div>

          <!-- Campos fijos no editables -->
          <div style="margin-bottom:20px;padding:16px;background:var(--gray-100);border-radius:10px">
            <p style="font-size:12px;font-weight:600;color:var(--gray-500);text-transform:uppercase;letter-spacing:.05em;margin:0 0 10px">Preguntas fijas (siempre presentes)</p>
            <div style="display:flex;flex-direction:column;gap:6px">
              <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--gray-600)">
                <span style="background:var(--gray-200);border-radius:6px;padding:3px 8px;font-size:11px;font-weight:600">TEXTO</span>
                ¬øEn qu√© consiste el hecho? <span style="color:var(--gray-400)">(descripci√≥n)</span>
              </div>
              <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--gray-600)">
                <span style="background:var(--gray-200);border-radius:6px;padding:3px 8px;font-size:11px;font-weight:600">FECHA</span>
                ¬øCu√°ndo ocurri√≥ el hecho?
              </div>
              <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--gray-600)">
                <span style="background:var(--gray-200);border-radius:6px;padding:3px 8px;font-size:11px;font-weight:600">ARCHIVO</span>
                Adjuntar evidencia (opcional)
              </div>
            </div>
          </div>

          <!-- Campos personalizados -->
          <div id="cfg-campos-list" style="display:flex;flex-direction:column;gap:14px"></div>
          <p id="cfg-campos-empty" style="font-size:13px;color:var(--gray-400);text-align:center;padding:24px;display:none">
            No hay preguntas extra. Hac√© clic en "+ Agregar pregunta" para comenzar.
          </p>
        </div>
      </div>

      <!-- TAB: Apariencia -->
      <div class="cfg-panel" id="cfgpanel-apariencia" style="display:none">
        <div class="bo-card" style="padding:28px">
          <h3 class="cfg-section-title">Colores del portal</h3>
          <div class="bo-form-grid">
            <div class="bo-form-group">
              <label>Color primario (botones, links, √≠conos)</label>
              <div style="display:flex;align-items:center;gap:12px">
                <input type="color" id="cfg-color-primario" value="#0097A7" style="width:48px;height:36px;border-radius:8px;border:1px solid var(--gray-200);cursor:pointer" oninput="cfgPreviewColor(this.value)" />
                <input type="text" id="cfg-color-primario-hex" class="bo-select-full" value="#0097A7" placeholder="#0097A7" oninput="cfgSyncColor(this.value)" style="flex:1" />
              </div>
            </div>
            <div class="bo-form-group">
              <label>Color del sidebar (back office)</label>
              <div style="display:flex;align-items:center;gap:12px">
                <input type="color" id="cfg-color-sidebar" value="#003D44" style="width:48px;height:36px;border-radius:8px;border:1px solid var(--gray-200);cursor:pointer" oninput="cfgPreviewSidebar(this.value)" />
                <input type="text" id="cfg-color-sidebar-hex" class="bo-select-full" value="#003D44" placeholder="#003D44" oninput="cfgSyncSidebar(this.value)" style="flex:1" />
              </div>
            </div>
          </div>
          <div id="cfg-color-preview" style="margin-top:20px;padding:16px;border-radius:10px;border:1px solid var(--gray-200)">
            <p style="font-size:12px;color:var(--gray-500);margin-bottom:12px">Vista previa del color primario:</p>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="bo-btn bo-btn-primary" id="cfgPreviewBtn">Bot√≥n primario</button>
              <span id="cfgPreviewBadge" style="display:inline-flex;align-items:center;padding:4px 14px;border-radius:100px;font-size:12px;font-weight:600;background:#E0F7FA;color:#0097A7">Badge</span>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /view-configuracion -->

    <!-- ‚ïê‚ïê‚ïê OTRAS VISTAS (placeholder) ‚ïê‚ïê‚ïê -->
    <div class="bo-view" id="view-tareas">
      <div class="bo-page-header"><h1 class="bo-page-title">Mis tareas</h1></div>
      <div class="bo-card"><p style="padding:40px;text-align:center;color:var(--gray-500)">Vista de tareas asignadas.</p></div>
    </div>
    <div class="bo-view" id="view-comunicaciones">
      <div class="bo-page-header"><h1 class="bo-page-title">Comunicaciones seguras</h1></div>
      <div class="bo-card"><p style="padding:40px;text-align:center;color:var(--gray-500)">Canal bidireccional cifrado con denunciantes.</p></div>
    </div>

  </main><!-- /bo-main -->

</div><!-- /bo-shell -->

<!-- MODAL: Nuevo caso -->
<div class="bo-modal-overlay" id="newCaseModal" style="display:none" onclick="closeModal(event)">
  <div class="bo-modal">
    <div class="bo-modal-header">
      <h3>Ingresar caso manual</h3>
      <button onclick="document.getElementById('newCaseModal').style.display='none'" class="bo-modal-close">‚úï</button>
    </div>
    <div class="bo-modal-body">
      <div class="bo-form-grid">
        <div class="bo-form-group bo-span2">
          <label>Canal de ingreso</label>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <label class="bo-radio-pill"><input type="radio" name="canal" value="web" checked /> Web</label>
            <label class="bo-radio-pill"><input type="radio" name="canal" value="email" /> Email</label>
            <label class="bo-radio-pill"><input type="radio" name="canal" value="whatsapp" /> WhatsApp</label>
            <label class="bo-radio-pill"><input type="radio" name="canal" value="tel" /> Tel√©fono</label>
            <label class="bo-radio-pill"><input type="radio" name="canal" value="presencial" /> Presencial</label>
          </div>
        </div>
        <div class="bo-form-group">
          <label>Tipo de denuncia *</label>
          <select class="bo-select-full" id="newCaseTipo">
            <option>‚Äî Seleccion√° ‚Äî</option>
            <option>Fraude / Malversaci√≥n</option>
            <option>Corrupci√≥n / Soborno</option>
            <option>Acoso laboral</option>
            <option>Acoso / violencia sexual</option>
            <option>Conflicto de intereses</option>
            <option>AML / Lavado de activos</option>
            <option>Seguridad laboral</option>
            <option>Privacidad / datos</option>
            <option>Otro</option>
          </select>
        </div>
        <div class="bo-form-group">
          <label>Nivel de riesgo inicial *</label>
          <select class="bo-select-full" id="newCaseRiesgo">
            <option>‚Äî Evaluar ‚Äî</option>
            <option>Bajo</option>
            <option>Medio</option>
            <option>Alto</option>
            <option>Cr√≠tico</option>
          </select>
        </div>
        <div class="bo-form-group">
          <label>√Årea involucrada</label>
          <select class="bo-select-full" id="newCaseArea">
            <option>‚Äî Seleccion√° ‚Äî</option>
            <option>Direcci√≥n General</option>
            <option>Recursos Humanos</option>
            <option>Finanzas / Contabilidad</option>
            <option>Compras / Proveedores</option>
            <option>Operaciones</option>
            <option>Legal / Compliance</option>
            <option>Otro</option>
          </select>
        </div>
        <div class="bo-form-group">
          <label>Jurisdicci√≥n</label>
          <select class="bo-select-full">
            <option>Argentina</option>
            <option>Uruguay</option>
            <option>Chile</option>
            <option>Brasil</option>
            <option>Espa√±a</option>
            <option>Multi-jurisdicci√≥n</option>
          </select>
        </div>
        <div class="bo-form-group">
          <label>¬øEs an√≥nima?</label>
          <select class="bo-select-full">
            <option>S√≠ ‚Äî an√≥nima</option>
            <option>No ‚Äî con datos</option>
          </select>
        </div>
        <div class="bo-form-group">
          <label>Nivel de confidencialidad</label>
          <select class="bo-select-full">
            <option>Est√°ndar</option>
            <option>Restringido</option>
            <option>Confidencial</option>
            <option>Alta direcci√≥n</option>
          </select>
        </div>
        <div class="bo-form-group bo-span2">
          <label>Descripci√≥n del hecho *</label>
          <textarea class="bo-textarea" rows="5" placeholder="Describ√≠ los hechos, personas involucradas, per√≠odo, evidencias disponibles..."></textarea>
        </div>
        <div class="bo-form-group">
          <label>Asignar investigador</label>
          <select class="bo-select-full" id="newCaseInv">
            <option>Sin asignar</option>
            <option>M. √Ålvarez (Compliance)</option>
            <option>R. Mendoza (Investigador)</option>
            <option>J. Torres (Legal)</option>
          </select>
        </div>
        <div class="bo-form-group">
          <label>Adjuntar evidencia</label>
          <div class="bo-upload-mini">Clic para subir archivos ¬∑ PDF, im√°genes, audio</div>
        </div>
      </div>
    </div>
    <div class="bo-modal-footer">
      <button onclick="document.getElementById('newCaseModal').style.display='none'" class="bo-btn bo-btn-ghost">Cancelar</button>
      <button onclick="createCase()" class="bo-btn bo-btn-primary">Crear caso</button>
    </div>
  </div>
</div>

<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ARGUS BACK OFFICE ‚Äî Design System
   Shell: sidebar + main ¬∑ Palette: teal #0097A7
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --primary:     #0097A7;
  --primary-100: #E0F7FA;
  --primary-200: #B2EBF2;
  --primary-700: #00838F;
  --black:     #002B2E;
  --gray-900:  #003D44;
  --gray-800:  #00474F;
  --gray-700:  #005F6B;
  --gray-600:  #007A87;
  --gray-500:  #5F9EA5;
  --gray-400:  #8CBDC3;
  --gray-300:  #BAD8DB;
  --gray-200:  #D5ECEE;
  --gray-100:  #EAF6F7;
  --gray-50:   #F3FCFD;
  --white:     #FFFFFF;
  --sidebar-w: 240px;
  --sidebar-collapsed: 64px;
  --topbar-h: 60px;
  --font: 'Inter', sans-serif;
  --radius: 10px;
  --radius-lg: 14px;
}

html { scroll-behavior: smooth; }
body {
  font-family: var(--font);
  background: var(--gray-50);
  color: var(--gray-800);
  font-size: 14px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}
a { text-decoration: none; color: inherit; }

/* ‚îÄ‚îÄ Shell ‚îÄ‚îÄ */
.bo-shell {
  display: flex;
  min-height: 100vh;
}

/* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
.bo-sidebar {
  width: var(--sidebar-w);
  min-height: 100vh;
  background: var(--gray-900);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 200;
  transition: width .25s ease;
  overflow: hidden;
}
.bo-sidebar.collapsed { width: var(--sidebar-collapsed); }
.bo-sidebar.collapsed .sidebar-icon-collapse { display: none !important; }
.bo-sidebar.collapsed .sidebar-icon-expand { display: block !important; }
.bo-sidebar:not(.collapsed) .sidebar-icon-expand { display: none !important; }

.bo-sidebar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 16px;
  border-bottom: 1px solid rgba(255,255,255,.06);
  gap: 10px;
}
.bo-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
  white-space: nowrap;
}
.bo-logo-name {
  font-size: 16px;
  font-weight: 800;
  color: var(--white);
  letter-spacing: -.03em;
}
.bo-logo-sub {
  font-size: 10px;
  font-weight: 500;
  color: rgba(255,255,255,.35);
  text-transform: uppercase;
  letter-spacing: .08em;
}
.bo-sidebar-toggle {
  background: rgba(255,255,255,.06);
  border: none;
  border-radius: 6px;
  color: rgba(255,255,255,.4);
  width: 28px; height: 28px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: background .2s;
}
.bo-sidebar-toggle:hover { background: rgba(255,255,255,.12); color: var(--white); }

/* Nav */
.bo-nav { flex: 1; padding: 16px 0; overflow-y: auto; overflow-x: hidden; }
.bo-nav-section { margin-bottom: 8px; }
.bo-nav-label {
  font-size: 10px;
  font-weight: 700;
  color: rgba(255,255,255,.25);
  text-transform: uppercase;
  letter-spacing: .1em;
  padding: 8px 16px 4px;
  display: block;
  white-space: nowrap;
}
.bo-nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 16px;
  border-radius: 8px;
  margin: 2px 8px;
  font-size: 13.5px;
  font-weight: 500;
  color: rgba(255,255,255,.55);
  cursor: pointer;
  transition: background .15s, color .15s;
  white-space: nowrap;
}
.bo-nav-item:hover { background: rgba(255,255,255,.07); color: var(--white); }
.bo-nav-item.active { background: var(--primary); color: var(--white); }
.bo-nav-item svg { flex-shrink: 0; }
.bo-badge-count {
  margin-left: auto;
  background: rgba(255,255,255,.12);
  color: rgba(255,255,255,.7);
  font-size: 11px;
  font-weight: 700;
  padding: 2px 7px;
  border-radius: 100px;
}
.bo-badge-warn { background: rgba(234,88,12,.25); color: #FB923C; }
.bo-badge-danger { background: rgba(220,38,38,.25); color: #F87171; }

.bo-sidebar-user {
  padding: 16px;
  border-top: 1px solid rgba(255,255,255,.06);
  display: flex;
  align-items: center;
  gap: 10px;
  white-space: nowrap;
}
.bo-user-avatar {
  width: 32px; height: 32px;
  background: var(--primary);
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 700; color: var(--white);
  flex-shrink: 0;
}
.bo-user-info { overflow: hidden; }
.bo-user-info strong {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--white);
}
.bo-user-info span { font-size: 11px; color: rgba(255,255,255,.4); }

/* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
.bo-main {
  margin-left: var(--sidebar-w);
  flex: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  transition: margin-left .25s ease;
}
.bo-main.expanded { margin-left: var(--sidebar-collapsed); }

/* Topbar */
.bo-topbar {
  height: var(--topbar-h);
  background: var(--white);
  border-bottom: 1.5px solid var(--gray-200);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.bo-topbar-left { display: flex; align-items: center; gap: 12px; }
.bo-breadcrumb {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: var(--gray-400);
}
.bo-breadcrumb span:last-child { color: var(--black); font-weight: 600; }
.bo-topbar-right { display: flex; align-items: center; gap: 10px; }
.bo-topbar-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 14px;
  background: var(--primary);
  color: var(--white);
  border: none;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  font-family: var(--font);
  transition: background .2s;
}
.bo-topbar-btn:hover { background: var(--primary-700); }
.bo-notif-btn {
  width: 36px; height: 36px;
  background: var(--gray-100);
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  position: relative;
  color: var(--gray-600);
  transition: background .2s;
}
.bo-notif-btn:hover { background: var(--gray-200); }
.bo-notif-dot {
  position: absolute;
  top: 7px; right: 7px;
  width: 7px; height: 7px;
  background: #DC2626;
  border-radius: 50%;
  border: 1.5px solid var(--white);
}
.bo-topbar-avatar {
  width: 32px; height: 32px;
  background: var(--primary);
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 700; color: var(--white);
  cursor: pointer;
}
.bo-mobile-menu {
  display: none;
  background: none;
  border: none;
  color: var(--gray-600);
  cursor: pointer;
  padding: 4px;
}

/* ‚îÄ‚îÄ Views ‚îÄ‚îÄ */
.bo-view { display: none; padding: 24px; flex-direction: column; gap: 20px; flex: 1; }
.bo-view.active { display: flex; }

.bo-page-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 16px;
  flex-wrap: wrap;
  margin-bottom: 4px;
}
.bo-page-title {
  font-size: 22px;
  font-weight: 800;
  color: var(--black);
  letter-spacing: -.03em;
}
.bo-page-sub {
  font-size: 13px;
  color: var(--gray-400);
  margin-top: 2px;
}

/* ‚îÄ‚îÄ Config panel ‚îÄ‚îÄ */
.cfg-tabs {
  display: flex; gap: 4px; flex-wrap: wrap;
  margin-bottom: 20px;
}
.cfg-tab {
  padding: 8px 16px; border-radius: 8px; border: 1.5px solid var(--gray-200);
  background: var(--white); font-size: 13px; font-weight: 600;
  color: var(--gray-600); cursor: pointer; font-family: var(--font);
  transition: all .18s;
}
.cfg-tab:hover { border-color: var(--primary); color: var(--primary); }
.cfg-tab.active { background: var(--primary); color: #fff; border-color: var(--primary); }
.cfg-section-title {
  font-size: 15px; font-weight: 700; color: var(--black);
  margin-bottom: 20px; letter-spacing: -.01em;
}
.cfg-toggle-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 16px; border: 1.5px solid var(--gray-200);
  border-radius: 10px; cursor: pointer; transition: border-color .18s;
}
.cfg-toggle-row:hover { border-color: var(--primary); }
.cfg-toggle {
  width: 40px; height: 22px; appearance: none; background: var(--gray-200);
  border-radius: 100px; cursor: pointer; position: relative; transition: background .2s;
  flex-shrink: 0;
}
.cfg-toggle:checked { background: var(--primary); }
.cfg-toggle::after {
  content: ''; position: absolute; top: 3px; left: 3px;
  width: 16px; height: 16px; background: #fff;
  border-radius: 50%; transition: left .2s; box-shadow: 0 1px 3px rgba(0,0,0,.2);
}
.cfg-toggle:checked::after { left: 21px; }
.cfg-cat-row, .cfg-faq-row {
  display: flex; align-items: flex-start; gap: 10px;
  padding: 10px 14px; border: 1.5px solid var(--gray-200);
  border-radius: 10px; background: var(--gray-50);
}
.cfg-cat-row input { flex: 1; }
.cfg-faq-row { flex-direction: column; }
.cfg-faq-row .cfg-faq-fields { display: flex; flex-direction: column; gap: 8px; width: 100%; }
.cfg-row-actions { display: flex; gap: 6px; align-self: flex-start; }

/* ‚îÄ‚îÄ Dashboard Hero Header ‚îÄ‚îÄ */
.dash-hero {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 20px;
  flex-wrap: wrap;
  background: linear-gradient(120deg, var(--gray-900) 0%, #005F6B 100%);
  border-radius: 16px;
  padding: 28px 32px;
  margin-bottom: 24px;
  color: #fff;
  position: relative;
  overflow: hidden;
}
.dash-hero::after {
  content: '';
  position: absolute;
  right: -40px; top: -40px;
  width: 220px; height: 220px;
  background: rgba(255,255,255,.04);
  border-radius: 50%;
  pointer-events: none;
}
.dash-hero-greeting {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: rgba(255,255,255,.55);
  margin-bottom: 6px;
}
.dash-hero-title {
  font-size: 28px;
  font-weight: 800;
  letter-spacing: -.03em;
  color: #fff;
  line-height: 1.15;
  margin: 0;
}
.dash-hero-role {
  font-weight: 400;
  font-size: 18px;
  color: rgba(255,255,255,.65);
}
.dash-hero-sub {
  font-size: 13px;
  color: rgba(255,255,255,.5);
  margin-top: 8px;
}
.dash-hero .bo-select {
  background: rgba(255,255,255,.12);
  border-color: rgba(255,255,255,.2);
  color: #fff;
}
.dash-hero .bo-btn-outline {
  background: rgba(255,255,255,.12);
  border-color: rgba(255,255,255,.3);
  color: #fff;
}
.dash-hero .bo-btn-outline:hover {
  background: rgba(255,255,255,.22);
}

/* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
.bo-card {
  background: var(--white);
  border: 1.5px solid var(--gray-200);
  border-radius: var(--radius-lg);
  overflow: hidden;
}
.bo-card-chart { overflow: visible; }
.bo-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1.5px solid var(--gray-100);
}
.bo-card-header h3 {
  font-size: 14px;
  font-weight: 700;
  color: var(--black);
  letter-spacing: -.01em;
}
.bo-card-divider { height: 1px; background: var(--gray-100); margin: 0; }
.bo-link { font-size: 13px; color: var(--primary); font-weight: 600; }

/* ‚îÄ‚îÄ KPI Grid ‚îÄ‚îÄ */
.bo-kpi-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 12px;
}
@media (max-width: 1200px) { .bo-kpi-grid { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 700px) { .bo-kpi-grid { grid-template-columns: repeat(2, 1fr); } }
.bo-kpi-card {
  background: var(--white);
  border: 1.5px solid var(--gray-200);
  border-radius: var(--radius-lg);
  padding: 18px 20px;
}
.bo-kpi-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
.bo-kpi-label { font-size: 12px; font-weight: 600; color: var(--gray-500); }
.bo-kpi-icon {
  width: 32px; height: 32px;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
}
.bo-kpi-value {
  font-size: 28px;
  font-weight: 900;
  color: var(--black);
  letter-spacing: -.04em;
  line-height: 1;
  margin-bottom: 6px;
}
.bo-kpi-value.danger { color: #DC2626; }
.bo-kpi-delta { font-size: 11px; color: var(--gray-400); font-weight: 500; }
.bo-kpi-delta.up { color: #16A34A; }
.bo-kpi-delta.down { color: #DC2626; }

/* ‚îÄ‚îÄ Dash grid ‚îÄ‚îÄ */
.bo-dash-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}
.bo-dash-grid-32 { grid-template-columns: 1.2fr 1fr; }
@media (max-width: 900px) { .bo-dash-grid, .bo-dash-grid-32 { grid-template-columns: 1fr; } }

/* Chart area */
.bo-chart-area {
  padding: 20px;
  height: 220px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
.bo-legend {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--gray-500);
}
.bo-legend span {
  width: 10px; height: 10px;
  border-radius: 50%;
  display: inline-block;
}

/* Risk bars */
.bo-risk-bars { padding: 16px 20px; display: flex; flex-direction: column; gap: 12px; }
.bo-risk-row { display: flex; align-items: center; gap: 12px; }
.bo-risk-bar-wrap { flex: 1; background: var(--gray-100); border-radius: 100px; height: 6px; }
.bo-risk-bar { height: 6px; border-radius: 100px; transition: width .6s ease; }
.bo-risk-n { font-size: 13px; font-weight: 700; color: var(--black); min-width: 20px; text-align: right; }

/* Type pills */
.bo-type-pills { padding: 12px 20px; display: flex; flex-wrap: wrap; gap: 8px; }
.bo-type-pill {
  background: var(--gray-100);
  border: 1px solid var(--gray-200);
  border-radius: 100px;
  padding: 5px 12px;
  font-size: 12px;
  color: var(--gray-600);
}

/* Area bars */
.bo-area-list { padding: 16px 20px; display: flex; flex-direction: column; gap: 14px; }
.bo-area-row { display: flex; align-items: center; gap: 10px; }
.bo-area-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; display: inline-block; }
.bo-area-label { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--gray-600); min-width: 160px; }
.bo-area-bar-wrap { flex: 1; background: var(--gray-100); border-radius: 100px; height: 5px; }
.bo-area-bar { height: 5px; border-radius: 100px; }
.bo-area-n { font-size: 12px; font-weight: 700; color: var(--black); min-width: 18px; text-align: right; }

/* Alerts */
.bo-alerts-list { padding: 8px 16px; display: flex; flex-direction: column; gap: 6px; }
.bo-alert {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px 14px;
  border-radius: 10px;
}
.bo-alert-danger { background: #FEF2F2; border: 1px solid #FECACA; }
.bo-alert-warn { background: #FFFBEB; border: 1px solid #FDE68A; }
.bo-alert-info { background: #EFF6FF; border: 1px solid #BFDBFE; }
.bo-alert-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
.bo-alert strong { font-size: 13px; font-weight: 700; color: var(--black); display: block; }
.bo-alert p { font-size: 12px; color: var(--gray-500); margin: 0; line-height: 1.5; }
.bo-alert-link { margin-left: auto; font-size: 12px; font-weight: 600; color: var(--primary); white-space: nowrap; align-self: center; }

/* ‚îÄ‚îÄ Tables ‚îÄ‚îÄ */
.bo-table-wrap { overflow-x: auto; }
.bo-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}
.bo-table th {
  padding: 12px 16px;
  text-align: left;
  font-size: 11px;
  font-weight: 700;
  color: var(--gray-400);
  text-transform: uppercase;
  letter-spacing: .05em;
  border-bottom: 1.5px solid var(--gray-100);
  white-space: nowrap;
  background: var(--gray-50);
}
.bo-table td {
  padding: 13px 16px;
  border-bottom: 1px solid var(--gray-100);
  color: var(--gray-700);
  vertical-align: middle;
}
.bo-table-row { cursor: pointer; transition: background .15s; }
.bo-table-row:hover { background: var(--gray-50); }
.bo-table-row:last-child td { border-bottom: none; }
.bo-table-link { color: var(--primary); font-weight: 600; font-size: 13px; }
.bo-code {
  font-family: 'Courier New', monospace;
  font-size: 12px;
  background: var(--primary-100);
  color: var(--primary);
  padding: 3px 8px;
  border-radius: 5px;
  white-space: nowrap;
}
.bo-unassigned { color: var(--gray-400); font-size: 12px; font-style: italic; }
.bo-checkbox { cursor: pointer; }

.bo-table-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  border-top: 1.5px solid var(--gray-100);
}
.bo-table-info { font-size: 12px; color: var(--gray-400); }
.bo-pagination { display: flex; gap: 4px; }
.bo-page-btn {
  width: 30px; height: 30px;
  border: 1.5px solid var(--gray-200);
  border-radius: 6px;
  background: var(--white);
  font-size: 13px;
  cursor: pointer;
  font-family: var(--font);
  color: var(--gray-600);
  transition: all .15s;
}
.bo-page-btn:hover:not([disabled]) { border-color: var(--primary); color: var(--primary); }
.bo-page-btn.active { background: var(--primary); border-color: var(--primary); color: var(--white); }
.bo-page-btn:disabled { opacity: .35; cursor: default; }

/* ‚îÄ‚îÄ Risk / Status / Role tags ‚îÄ‚îÄ */
.risk-tag {
  display: inline-flex;
  align-items: center;
  padding: 3px 9px;
  border-radius: 5px;
  font-size: 10px;
  font-weight: 800;
  letter-spacing: .06em;
  white-space: nowrap;
}
.risk-critical { background: #FEF2F2; color: #DC2626; border: 1px solid #FECACA; }
.risk-high     { background: #FFF7ED; color: #EA580C; border: 1px solid #FED7AA; }
.risk-medium   { background: #FFFBEB; color: #D97706; border: 1px solid #FDE68A; }
.risk-low      { background: #F0FDF4; color: #16A34A; border: 1px solid #BBF7D0; }

.status-tag {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  border-radius: 100px;
  font-size: 11px;
  font-weight: 600;
  white-space: nowrap;
}
.status-new          { background: #E0F7FA; color: #0097A7; }
.status-review       { background: #FFF7ED; color: #EA580C; }
.status-investigating { background: #FEF3C7; color: #B45309; }
.status-closed-ok    { background: #F0FDF4; color: #16A34A; }
.status-closed-no    { background: #F5F5F5; color: #6B7280; }
.status-closed-no    { background: var(--gray-100); color: var(--gray-500); }

.sla-tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  font-weight: 700;
  padding: 3px 9px;
  border-radius: 100px;
}
.sla-ok   { background: #F0FDF4; color: #16A34A; }
.sla-warn { background: #FFF7ED; color: #EA580C; }
.sla-over { background: #FEF2F2; color: #DC2626; }

.role-tag {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 100px;
  font-size: 11px;
  font-weight: 600;
}
.role-compliance  { background: #E0F7FA; color: #0097A7; }
.role-investigator { background: #FFF7ED; color: #EA580C; }
.role-legal       { background: #F0FDF4; color: #16A34A; }
.role-auditor     { background: #F5F3FF; color: #7C3AED; }
.role-rrhh        { background: #FEF2F2; color: #DC2626; }

/* ‚îÄ‚îÄ Usuario / Roles sub-tabs ‚îÄ‚îÄ */
.usr-tabs { display:flex; gap:4px; margin-bottom:20px; background:var(--gray-100); border-radius:10px; padding:4px; width:fit-content; }
.usr-tab  { display:flex; align-items:center; gap:6px; padding:8px 16px; border-radius:8px; font-size:13px; font-weight:600; border:none; background:none; cursor:pointer; color:var(--gray-500); transition:all .15s; }
.usr-tab.active  { background:var(--white); color:var(--primary); box-shadow:0 1px 4px rgba(0,0,0,.10); }
.usr-tab:hover:not(.active) { color:var(--black); }

/* ‚îÄ‚îÄ Rol card ‚îÄ‚îÄ */
.role-card { background:var(--white); border:1.5px solid var(--gray-200); border-radius:14px; padding:20px; display:flex; flex-direction:column; gap:14px; transition:border-color .15s; }
.role-card:hover { border-color:var(--gray-300); }
.role-card-head { display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
.role-card-info  { display:flex; flex-direction:column; gap:4px; }
.role-card-name  { font-size:15px; font-weight:700; color:var(--black); }
.role-card-desc  { font-size:12px; color:var(--gray-500); line-height:1.5; }
.role-card-actions { display:flex; gap:6px; flex-shrink:0; }
.role-perm-list  { display:flex; flex-wrap:wrap; gap:6px; }
.role-perm-chip  { display:inline-flex; align-items:center; gap:4px; padding:3px 9px; background:var(--gray-100); border-radius:100px; font-size:11px; color:var(--gray-600); font-weight:500; }
.role-perm-chip.on  { background:var(--primary-100); color:var(--primary-700); }
.role-sys-badge { font-size:10px; font-weight:600; padding:2px 7px; background:var(--gray-100); color:var(--gray-500); border-radius:100px; text-transform:uppercase; letter-spacing:.05em; }

/* ‚îÄ‚îÄ Perms matrix ‚îÄ‚îÄ */
.perm-matrix-th { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.05em; color:var(--gray-500); padding:10px 16px; text-align:left; white-space:nowrap; }
.perm-matrix-td { padding:10px 16px; border-top:1px solid var(--gray-100); }
.perm-check     { width:16px; height:16px; accent-color:var(--primary); cursor:pointer; }
.perm-check:disabled { cursor:not-allowed; opacity:.5; }

/* ‚îÄ‚îÄ Perms modal rows ‚îÄ‚îÄ */
.perm-modal-row { display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-bottom:1px solid var(--gray-100); }
.perm-modal-row:last-child { border-bottom:none; }
.perm-modal-label { font-size:13px; color:var(--black); font-weight:500; }
.perm-modal-hint  { font-size:11px; color:var(--gray-400); margin-top:2px; }
.perm-toggle      { position:relative; display:inline-flex; width:36px; height:20px; flex-shrink:0; }
.perm-toggle input { opacity:0; width:0; height:0; }
.perm-toggle-slider { position:absolute; inset:0; background:var(--gray-300); border-radius:100px; cursor:pointer; transition:.2s; }
.perm-toggle-slider::before { content:''; position:absolute; width:14px; height:14px; background:#fff; border-radius:50%; left:3px; top:3px; transition:.2s; }
.perm-toggle input:checked + .perm-toggle-slider { background:var(--primary); }
.perm-toggle input:checked + .perm-toggle-slider::before { transform:translateX(16px); }

/* ‚îÄ‚îÄ Filters ‚îÄ‚îÄ */
.bo-filters { display: flex; flex-direction: column; gap: 10px; }
.bo-search-wrap {
  display: flex;
  align-items: center;
  gap: 10px;
  background: var(--white);
  border: 1.5px solid var(--gray-200);
  border-radius: var(--radius);
  padding: 0 16px;
  height: 40px;
}
.bo-search {
  flex: 1;
  border: none;
  outline: none;
  font-size: 13px;
  font-family: var(--font);
  color: var(--black);
  background: none;
}
.bo-filter-row { display: flex; gap: 8px; flex-wrap: wrap; }

/* ‚îÄ‚îÄ Selects / Buttons ‚îÄ‚îÄ */
.bo-select, .bo-select-sm, .bo-select-full {
  border: 1.5px solid var(--gray-200);
  border-radius: 8px;
  padding: 6px 12px;
  font-size: 13px;
  font-family: var(--font);
  color: var(--gray-700);
  background: var(--white);
  outline: none;
  cursor: pointer;
}
.bo-select-sm { padding: 5px 10px; font-size: 12px; }
.bo-select-full { width: 100%; }
.bo-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 14px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  font-family: var(--font);
  border: none;
  transition: all .2s;
}
.bo-btn-primary { background: var(--primary); color: var(--white); }
.bo-btn-primary:hover { background: var(--primary-700); }
.bo-btn-outline { background: var(--white); color: var(--gray-700); border: 1.5px solid var(--gray-200); }
.bo-btn-outline:hover { border-color: var(--gray-400); }
.bo-btn-ghost { background: transparent; color: var(--gray-600); border: 1.5px solid transparent; }
.bo-btn-ghost:hover { background: var(--gray-100); }
.bo-btn-active { background: var(--gray-200) !important; color: var(--primary); }

/* ‚îÄ‚îÄ Log ‚îÄ‚îÄ */
.bo-log-list { padding: 8px 0; }
.bo-log-item {
  display: grid;
  grid-template-columns: 130px 160px 1fr 120px;
  align-items: center;
  gap: 12px;
  padding: 12px 20px;
  border-bottom: 1px solid var(--gray-100);
  font-size: 13px;
  transition: background .15s;
}
.bo-log-item:hover { background: var(--gray-50); }
.bo-log-item:last-child { border-bottom: none; }
.bo-log-time { color: var(--gray-400); font-size: 12px; }
.bo-log-user { display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--black); }
.bo-log-avatar {
  width: 26px; height: 26px;
  background: var(--primary);
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; font-weight: 700; color: var(--white);
  flex-shrink: 0;
}
.bo-log-action { color: var(--gray-700); }
.bo-log-ip { color: var(--gray-400); font-size: 11px; font-family: monospace; }

/* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
.bo-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  backdrop-filter: blur(4px);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.bo-modal {
  background: var(--white);
  border-radius: var(--radius-lg);
  width: 100%;
  max-width: 680px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 24px 80px rgba(0,0,0,.2);
}
.bo-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  border-bottom: 1.5px solid var(--gray-100);
}
.bo-modal-header h3 { font-size: 17px; font-weight: 800; color: var(--black); letter-spacing: -.02em; }
.bo-modal-close {
  background: var(--gray-100);
  border: none;
  border-radius: 6px;
  width: 28px; height: 28px;
  cursor: pointer;
  font-size: 14px;
  color: var(--gray-600);
  display: flex; align-items: center; justify-content: center;
}
.bo-modal-body { padding: 24px; }
.bo-modal-footer {
  padding: 16px 24px;
  border-top: 1.5px solid var(--gray-100);
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

/* ‚îÄ‚îÄ Form (modal) ‚îÄ‚îÄ */
.bo-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.bo-span2 { grid-column: span 2; }
.bo-form-group { display: flex; flex-direction: column; gap: 6px; }
.bo-form-group label { font-size: 12px; font-weight: 700; color: var(--gray-600); text-transform: uppercase; letter-spacing: .04em; }
.bo-textarea {
  border: 1.5px solid var(--gray-200);
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 13px;
  font-family: var(--font);
  color: var(--black);
  outline: none;
  resize: vertical;
  transition: border-color .2s;
}
.bo-textarea:focus { border-color: var(--primary); }
.bo-radio-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 5px 12px;
  border: 1.5px solid var(--gray-200);
  border-radius: 100px;
  font-size: 12px;
  font-weight: 500;
  color: var(--gray-600);
  cursor: pointer;
  transition: all .15s;
}
.bo-radio-pill:has(input:checked) { background: var(--primary-100); border-color: var(--primary); color: var(--primary); }
.bo-radio-pill input { display: none; }
.bo-upload-mini {
  border: 1.5px dashed var(--gray-300);
  border-radius: 8px;
  padding: 14px;
  text-align: center;
  font-size: 12px;
  color: var(--gray-400);
  cursor: pointer;
  transition: border-color .2s;
}
.bo-upload-mini:hover { border-color: var(--primary); color: var(--primary); }

/* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
@media (max-width: 768px) {
  .bo-sidebar { transform: translateX(-100%); }
  .bo-sidebar.mobile-open { transform: translateX(0); }
  .bo-main { margin-left: 0; }
  .bo-mobile-menu { display: block; }
  .bo-log-item { grid-template-columns: 1fr; gap: 4px; }
  .bo-log-ip { display: none; }
}
</style>

<!-- MODAL: Editar usuario -->
<div class="bo-modal-overlay" id="editUserModal" style="display:none" onclick="if(event.target.id==='editUserModal')event.target.style.display='none'">
  <div class="bo-modal">
    <div class="bo-modal-header">
      <h3>Editar usuario</h3>
      <button onclick="document.getElementById('editUserModal').style.display='none'" class="bo-modal-close">‚úï</button>
    </div>
    <div class="bo-modal-body">
      <div class="bo-form-grid">
        <div class="bo-form-group">
          <label>Nombre completo</label>
          <input type="text" class="bo-select-full" id="euNombre" />
        </div>
        <div class="bo-form-group">
          <label>Email</label>
          <input type="email" class="bo-select-full" id="euEmail" />
        </div>
        <div class="bo-form-group">
          <label>Rol</label>
          <select class="bo-select-full" id="euRol">
            <!-- Rellenado din√°micamente por populateRoleSelects() -->
          </select>
        </div>
        <div class="bo-form-group">
          <label>Jurisdicci√≥n</label>
          <input type="text" class="bo-select-full" id="euJuris" />
        </div>
        <div class="bo-form-group">
          <label>Estado</label>
          <select class="bo-select-full" id="euEstado">
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
          </select>
        </div>
      </div>
    </div>
    <div class="bo-modal-footer">
      <button onclick="document.getElementById('editUserModal').style.display='none'" class="bo-btn bo-btn-ghost">Cancelar</button>
      <button onclick="saveEditUser()" class="bo-btn bo-btn-primary">Guardar cambios</button>
    </div>
  </div>
</div>

<!-- MODAL: Invitar usuario -->
<div class="bo-modal-overlay" id="inviteUserModal" style="display:none" onclick="if(event.target.id==='inviteUserModal')event.target.style.display='none'">
  <div class="bo-modal">
    <div class="bo-modal-header">
      <h3>Invitar nuevo usuario</h3>
      <button onclick="document.getElementById('inviteUserModal').style.display='none'" class="bo-modal-close">‚úï</button>
    </div>
    <div class="bo-modal-body">
      <div class="bo-form-grid">
        <div class="bo-form-group">
          <label>Nombre completo *</label>
          <input type="text" class="bo-select-full" id="invNombre" placeholder="Nombre y apellido" />
        </div>
        <div class="bo-form-group">
          <label>Email corporativo *</label>
          <input type="email" class="bo-select-full" id="invEmail" placeholder="usuario@empresa.com" />
        </div>
        <div class="bo-form-group">
          <label>Rol *</label>
          <select class="bo-select-full" id="invRol">
            <!-- Rellenado din√°micamente por populateRoleSelects() -->
          </select>
        </div>
        <div class="bo-form-group">
          <label>Jurisdicci√≥n</label>
          <input type="text" class="bo-select-full" id="invJuris" placeholder="Ej: Argentina, Multi-regi√≥n" />
        </div>
        <div class="bo-form-group bo-span2">
          <label style="font-size:12px;color:var(--gray-500)">Se enviar√° un email de invitaci√≥n con las instrucciones para crear la contrase√±a.</label>
        </div>
      </div>
    </div>
    <div class="bo-modal-footer">
      <button onclick="document.getElementById('inviteUserModal').style.display='none'" class="bo-btn bo-btn-ghost">Cancelar</button>
      <button onclick="sendInvite()" class="bo-btn bo-btn-primary">Enviar invitaci√≥n</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="boToast" style="display:none;position:fixed;bottom:28px;right:28px;z-index:9999;background:#002B2E;color:#fff;padding:14px 20px;border-radius:10px;font-size:13px;font-weight:600;box-shadow:0 8px 24px rgba(0,0,0,.25);align-items:center;gap:10px;max-width:360px">
  <span id="boToastIcon">‚úÖ</span>
  <span id="boToastMsg">Acci√≥n realizada</span>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TENANT ‚Äî aislamiento por empresa (?t=slug en URL)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var TENANT = (function() {
  try {
    var p = new URLSearchParams(window.location.search);
    return (p.get('t') || '').replace(/[^a-zA-Z0-9_-]/g, '') || '';
  } catch(e) { return ''; }
})();

var CASOS_KEY   = 'argus_casos_'  + (TENANT || 'default');
var USERS_KEY   = 'argus_users_'  + (TENANT || 'default');

// Datos de demo que se usan si un tenant no tiene casos propios a√∫n
var DEMO_CASOS = [
  { id:'ARG-2025-0044', tipo:'Acoso laboral',    area:'RRHH',       canal:'Web',      riesgo:'high',     estado:'new',           anon:'S√≠', inv:'‚Äî',         sla:'23', sla_s:'ok',   fecha:'22/02/2025' },
  { id:'ARG-2025-0043', tipo:'Fraude financiero',area:'Finanzas',   canal:'Email',    riesgo:'critical', estado:'investigating',  anon:'No', inv:'R. Mendoza',sla:'8',  sla_s:'warn', fecha:'18/02/2025' },
  { id:'ARG-2025-0042', tipo:'AML / Lavado',     area:'Compras',    canal:'Web',      riesgo:'critical', estado:'investigating',  anon:'S√≠', inv:'R. Mendoza',sla:'5',  sla_s:'warn', fecha:'14/02/2025' },
  { id:'ARG-2025-0041', tipo:'Fraude financiero',area:'Finanzas',   canal:'WhatsApp', riesgo:'high',     estado:'new',           anon:'S√≠', inv:'‚Äî',         sla:'VENCIDO', sla_s:'over', fecha:'10/02/2025' },
  { id:'ARG-2025-0040', tipo:'Conflicto inter√©s',area:'Direcci√≥n',  canal:'Web',      riesgo:'medium',   estado:'review',        anon:'No', inv:'M. √Ålvarez', sla:'16', sla_s:'ok', fecha:'08/02/2025' },
  { id:'ARG-2025-0039', tipo:'Corrupci√≥n',       area:'Compras',    canal:'Email',    riesgo:'critical', estado:'investigating',  anon:'S√≠', inv:'J. Torres', sla:'2',  sla_s:'warn', fecha:'05/02/2025' },
  { id:'ARG-2025-0038', tipo:'Acoso laboral',    area:'RRHH',       canal:'Tel√©fono', riesgo:'high',     estado:'new',           anon:'No', inv:'‚Äî',         sla:'VENCIDO', sla_s:'over', fecha:'01/02/2025' },
  { id:'ARG-2025-0037', tipo:'Discriminaci√≥n',   area:'RRHH',       canal:'Web',      riesgo:'medium',   estado:'review',        anon:'S√≠', inv:'M. √Ålvarez', sla:'12', sla_s:'ok', fecha:'28/01/2025' },
  { id:'ARG-2025-0036', tipo:'Acoso sexual',     area:'Operaciones',canal:'Web',      riesgo:'high',     estado:'investigating',  anon:'S√≠', inv:'J. Torres', sla:'9',  sla_s:'warn', fecha:'25/01/2025' },
  { id:'ARG-2025-0035', tipo:'Seguridad laboral',area:'Operaciones',canal:'WhatsApp', riesgo:'medium',   estado:'review',        anon:'No', inv:'R. Mendoza',sla:'20', sla_s:'ok', fecha:'20/01/2025' },
];

function loadCasos() {
  try {
    var s = localStorage.getItem(CASOS_KEY);
    if (s) return JSON.parse(s);
  } catch(e) {}
  // Primera vez: guardar demo data para este tenant
  localStorage.setItem(CASOS_KEY, JSON.stringify(DEMO_CASOS));
  return JSON.parse(JSON.stringify(DEMO_CASOS));
}
function saveCasos() {
  localStorage.setItem(CASOS_KEY, JSON.stringify(CASOS_DATA));
}

// Tenant gate: si no hay ?t= en la URL, mostrar pantalla de acceso
(function() {
  if (!TENANT) {
    document.getElementById('tenant-gate').style.display = 'flex';
    document.querySelector('.bo-shell').style.display = 'none';
    return;
  }
  // Verificar PIN si el tenant tiene uno configurado
  var sesionKey = 'argus_sesion_' + TENANT;
  var sesionOk  = sessionStorage.getItem(sesionKey) === '1';
  if (!sesionOk) {
    var cfg = (window.ArgusConfig && ArgusConfig.get()) || {};
    var pin = (cfg.acceso && cfg.acceso.pin) || '';
    if (pin) {
      // Pedir PIN
      document.getElementById('tenant-gate').style.display = 'flex';
      document.querySelector('.bo-shell').style.display = 'none';
      document.getElementById('gate-code').value = TENANT;
      document.getElementById('gate-code').readOnly = true;
      document.getElementById('gate-code').style.opacity = '.5';
      return;
    }
  }
  sessionStorage.setItem(sesionKey, '1');
  initTenantUI();
})();

function gateLogin() {
  var code = document.getElementById('gate-code').value.trim().toLowerCase().replace(/[^a-z0-9_-]/g, '');
  if (!code) {
    showGateError('Ingres√° el c√≥digo de tu empresa.');
    return;
  }
  var pin = document.getElementById('gate-pin').value;
  // Verificar PIN si el tenant ya existe y tiene uno configurado
  var saved = {};
  try { saved = JSON.parse(localStorage.getItem('argus_config_' + code) || '{}'); } catch(e) {}
  var cfgPin = (saved.acceso && saved.acceso.pin) || '';
  if (cfgPin && pin !== cfgPin) {
    showGateError('PIN incorrecto. Intent√° de nuevo.');
    return;
  }
  sessionStorage.setItem('argus_sesion_' + code, '1');
  window.location.href = 'backoffice.html?t=' + code;
}

function gateLogout() {
  if (TENANT) sessionStorage.removeItem('argus_sesion_' + TENANT);
  window.location.href = 'backoffice.html';
}

function showGateError(msg) {
  var el = document.getElementById('gate-error');
  el.textContent = msg;
  el.style.display = 'block';
}

function initTenantUI() {
  // Nombre empresa en sidebar
  var cfg = (window.ArgusConfig && ArgusConfig.get()) || {};
  var nombre = (cfg.empresa && cfg.empresa.nombre) || TENANT;
  var lbl = document.getElementById('sidebar-tenant-label');
  if (lbl) lbl.textContent = nombre;

  // Link "Ir al portal" con tenant
  var portalLink = document.getElementById('nav-portal-link');
  if (portalLink && TENANT) portalLink.href = 'index.html?t=' + TENANT;

  // Link "backoffice.html" del dashboard con tenant
  document.querySelectorAll('a[href="backoffice.html"]').forEach(function(a) {
    a.href = 'backoffice.html?t=' + TENANT;
  });

  // Links a backoffice-caso.html ya incluyen ?id=..., a√±adir &t=
  // (se maneja en buildRow)
}

// ‚îÄ‚îÄ Date ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('dashDate').textContent = new Date().toLocaleDateString('es-AR', {
  weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
});
setDashGreeting();

// ‚îÄ‚îÄ Sidebar toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  const main = document.getElementById('boMain');
  if (!sb || !main) return;
  const isMobile = window.innerWidth <= 768;
  if (isMobile) {
    sb.classList.toggle('mobile-open');
    document.body.style.overflow = sb.classList.contains('mobile-open') ? 'hidden' : '';
  } else {
    sb.classList.toggle('collapsed');
    main.classList.toggle('expanded');
  }
}

// ‚îÄ‚îÄ Filtros avanzados ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleFiltrosAvanzados() {
  const panel = document.getElementById('filtrosAvanzadosPanel');
  const btn = document.getElementById('btnFiltrosAvanzados');
  if (!panel || !btn) return;
  const isOpen = panel.style.display === 'block';
  panel.style.display = isOpen ? 'none' : 'block';
  btn.classList.toggle('bo-btn-active', !isOpen);
}
function aplicarFiltrosAvanzados() {
  if (document.getElementById('casosTableBody')) renderCasosTable();
  toggleFiltrosAvanzados();
}

// ‚îÄ‚îÄ View switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const viewTitles = {
  dashboard: 'Dashboard',
  casos: 'Casos',
  tareas: 'Mis tareas',
  comunicaciones: 'Comunicaciones',
  auditoria: 'Auditor√≠a / Log',
  usuarios: 'Usuarios y roles',
  configuracion: 'Configuraci√≥n del portal'
};

function showView(name) {
  document.querySelectorAll('.bo-view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.bo-nav-item').forEach(n => n.classList.remove('active'));
  const view = document.getElementById('view-' + name);
  if (view) view.classList.add('active');
  document.getElementById('currentView').textContent = viewTitles[name] || name;

  // Activate nav item (match by showView('name') or preventDefault + showView('name'))
  document.querySelectorAll('.bo-nav-item').forEach(n => {
    const onclick = n.getAttribute('onclick') || '';
    if (onclick.indexOf("showView('" + name + "')") !== -1 || onclick.indexOf('"' + name + '"') !== -1) n.classList.add('active');
  });

  if (name === 'casos') renderCasosTable();
}

// ‚îÄ‚îÄ Generate cases table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Casos: cargados y persistidos por tenant en localStorage
var CASOS_DATA = loadCasos();

const riskLabels = { critical:'CR√çTICO', high:'ALTO', medium:'MEDIO', low:'BAJO' };

function buildRow(c) {
  return `<tr class="bo-table-row" onclick="goToCase('${c.id}')">
    <td><input type="checkbox" class="bo-checkbox" onclick="event.stopPropagation()" /></td>
    <td><code class="bo-code">${c.id}</code></td>
    <td>${c.tipo}</td>
    <td>${c.area}</td>
    <td><span style="font-size:11px;color:var(--gray-500)">${c.canal}</span></td>
    <td><span class="risk-tag risk-${c.riesgo}">${riskLabels[c.riesgo]}</span></td>
    <td><span class="status-tag status-${c.estado}">${statusLabel(c.estado)}</span></td>
    <td><span style="font-size:12px;color:${c.anon==='S√≠'?'var(--gray-400)':'var(--black)'}">${c.anon}</span></td>
    <td>${c.inv === '‚Äî' ? '<span class="bo-unassigned">Sin asignar</span>' : c.inv}</td>
    <td><span class="sla-tag sla-${c.sla_s}">${c.sla_s==='over'?'Vencido':c.sla+' d√≠as'}</span></td>
    <td>${c.fecha}</td>
    <td><a href="backoffice-caso.html?id=${c.id}${TENANT ? '&t=' + TENANT : ''}" class="bo-table-link" onclick="event.stopPropagation()">Abrir</a></td>
  </tr>`;
}

function renderCasosTable(data) {
  const tbody = document.getElementById('casosTableBody');
  if (!tbody) return;
  var rows = (data || CASOS_DATA);
  if (rows.length === 0) {
    tbody.innerHTML = '<tr><td colspan="12" style="padding:40px;text-align:center;color:var(--gray-500)">No se encontraron casos con los filtros seleccionados.</td></tr>';
  } else {
    tbody.innerHTML = rows.map(buildRow).join('');
  }
  var info = document.querySelector('.bo-table-info');
  if (info) info.textContent = 'Mostrando ' + rows.length + ' de ' + CASOS_DATA.length + ' casos';
}

function filterCasos() {
  var q = (document.getElementById('casoBusqueda') || {}).value.toLowerCase().trim();
  var estado = (document.getElementById('filterEstado') || {}).value;
  var riesgo = (document.getElementById('filterRiesgo') || {}).value;
  var area   = (document.getElementById('filterArea') || {}).value;
  var tipo   = (document.getElementById('filterTipo') || {}).value;
  var result = CASOS_DATA.filter(function(c) {
    var matchQ = !q || [c.id, c.tipo, c.area, c.canal, c.inv].join(' ').toLowerCase().includes(q);
    var matchE = !estado || c.estado === estado;
    var matchR = !riesgo || c.riesgo === riesgo;
    var matchA = !area   || c.area.toLowerCase().includes(area.toLowerCase());
    var matchT = !tipo   || c.tipo.toLowerCase().includes(tipo.toLowerCase());
    return matchQ && matchE && matchR && matchA && matchT;
  });
  renderCasosTable(result);
}

function statusLabel(s) {
  return { new:'Nuevo', eval:'En evaluaci√≥n', review:'En revisi√≥n', investigating:'Investigando', 'closed-ok':'Cerrado', 'closed-no':'Desestimado' }[s] || s;
}

function goToCase(id) {
  window.location.href = 'backoffice-caso.html?id=' + id + (TENANT ? '&t=' + TENANT : '');
}

// ‚îÄ‚îÄ Usuarios ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function populateRoleSelects(selectedRolId) {
  var roles = loadRoles();
  var opts = roles.map(function(r) {
    return '<option value="' + escHtml(r.id) + '"' + (r.id === selectedRolId ? ' selected' : '') + '>' + escHtml(r.nombre) + '</option>';
  }).join('');
  ['euRol', 'invRol'].forEach(function(id) {
    var sel = document.getElementById(id);
    if (!sel) return;
    var prefix = id === 'invRol' ? '<option value="">‚Äî Seleccion√° ‚Äî</option>' : '';
    sel.innerHTML = prefix + opts;
  });
}

function editUser(nombre, email, rol, juris, acceso, estado) {
  populateRoleSelects(rol);
  document.getElementById('euNombre').value = nombre;
  document.getElementById('euEmail').value  = email;
  document.getElementById('euJuris').value  = juris;
  document.getElementById('euEstado').value = estado;
  document.getElementById('editUserModal').style.display = 'flex';
}
function saveEditUser() {
  var nombre = document.getElementById('euNombre').value.trim();
  if (!nombre) { showToast('El nombre es requerido', '‚ö†Ô∏è'); return; }
  var email  = document.getElementById('euEmail').value.trim();
  var rolId  = document.getElementById('euRol').value;
  var juris  = document.getElementById('euJuris').value.trim();
  var estado = document.getElementById('euEstado').value;
  var users  = loadUsers();
  var idx = users.findIndex(function(u){ return u.email === email; });
  if (idx !== -1) {
    users[idx].nombre      = nombre;
    users[idx].rol         = rolId;
    users[idx].jurisdiccion = juris;
    users[idx].estado      = estado;
    saveUsers(users);
    renderUsersTable();
  }
  document.getElementById('editUserModal').style.display = 'none';
  showToast('Usuario ¬´' + nombre + '¬ª actualizado', '‚úÖ');
}
function showInviteModal() {
  populateRoleSelects('');
  document.getElementById('invNombre').value = '';
  document.getElementById('invEmail').value  = '';
  document.getElementById('invJuris').value  = '';
  document.getElementById('inviteUserModal').style.display = 'flex';
}
function sendInvite() {
  var nombre = document.getElementById('invNombre').value.trim();
  var email  = document.getElementById('invEmail').value.trim();
  var rolId  = document.getElementById('invRol').value;
  var juris  = document.getElementById('invJuris').value.trim();
  if (!nombre || !email) { showToast('Nombre y email son requeridos', '‚ö†Ô∏è'); return; }
  if (!rolId) { showToast('Seleccion√° un rol', '‚ö†Ô∏è'); return; }
  var roles = loadRoles();
  var role  = roles.find(function(r){ return r.id === rolId; }) || { nombre: rolId, color: '#5F9EA5' };
  var initials = nombre.split(' ').map(function(n){ return n[0]; }).slice(0,2).join('').toUpperCase();
  var users = loadUsers();
  users.push({ nombre: nombre, email: email, rol: rolId, jurisdiccion: juris || 'Sin especificar',
                acceso: 'Seg√∫n rol', ultimo: 'Nunca', estado: 'activo', color: role.color });
  saveUsers(users);
  renderUsersTable();
  document.getElementById('inviteUserModal').style.display = 'none';
  showToast('Invitaci√≥n enviada a ' + email, 'üìß');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFIGURACI√ìN DEL PORTAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showCfgTab(tab, btn) {
  document.querySelectorAll('.cfg-panel').forEach(function(p){ p.style.display='none'; });
  document.querySelectorAll('.cfg-tab').forEach(function(b){ b.classList.remove('active'); });
  var panel = document.getElementById('cfgpanel-' + tab);
  if (panel) panel.style.display = 'block';
  if (btn) btn.classList.add('active');
  if (tab === 'categorias') cfgRenderCategorias();
  if (tab === 'faq')        cfgRenderFaq();
  if (tab === 'canales')    cfgLoadCanales();
  if (tab === 'formulario') cfgRenderCampos();
}

function cfgLoad() {
  if (typeof ArgusConfig === 'undefined') return;
  var cfg = ArgusConfig.get();
  setVal('cfg-empresa-nombre',       cfg.empresa.nombre);
  setVal('cfg-empresa-slogan',       cfg.empresa.slogan);
  setVal('cfg-empresa-email',        cfg.empresa.email);
  setVal('cfg-empresa-telefono',     cfg.empresa.telefono);
  setVal('cfg-empresa-logoUrl',      cfg.empresa.logoUrl);
  setVal('cfg-landing-heroTitle',    cfg.landing.heroTitle);
  setVal('cfg-landing-heroSubtitle', cfg.landing.heroSubtitle);
  setVal('cfg-landing-ctaLabel',     cfg.landing.ctaLabel);
  setVal('cfg-landing-ctaSecLabel',  cfg.landing.ctaSecLabel);
  setVal('cfg-color-primario-hex',   cfg.apariencia.colorPrimario);
  setVal('cfg-color-sidebar-hex',    cfg.apariencia.colorSidebar);
  var cp = document.getElementById('cfg-color-primario');
  if (cp) cp.value = cfg.apariencia.colorPrimario;
  var cs = document.getElementById('cfg-color-sidebar');
  if (cs) cs.value = cfg.apariencia.colorSidebar;
}

function cfgSaveAll() {
  if (typeof ArgusConfig === 'undefined') { showToast('Error: client-config.js no cargado', '‚ö†Ô∏è'); return; }
  var cfg = ArgusConfig.get();
  // Empresa
  cfg.empresa.nombre    = getVal('cfg-empresa-nombre')    || cfg.empresa.nombre;
  cfg.empresa.slogan    = getVal('cfg-empresa-slogan')    || cfg.empresa.slogan;
  cfg.empresa.email     = getVal('cfg-empresa-email')     || cfg.empresa.email;
  cfg.empresa.telefono  = getVal('cfg-empresa-telefono')  || cfg.empresa.telefono;
  cfg.empresa.logoUrl   = getVal('cfg-empresa-logoUrl');
  // Landing
  cfg.landing.heroTitle    = getVal('cfg-landing-heroTitle')    || cfg.landing.heroTitle;
  cfg.landing.heroSubtitle = getVal('cfg-landing-heroSubtitle') || cfg.landing.heroSubtitle;
  cfg.landing.ctaLabel     = getVal('cfg-landing-ctaLabel')     || cfg.landing.ctaLabel;
  cfg.landing.ctaSecLabel  = getVal('cfg-landing-ctaSecLabel')  || cfg.landing.ctaSecLabel;
  // Canales
  cfg.canales.web      = !!document.getElementById('cfg-canal-web')?.checked;
  cfg.canales.email    = !!document.getElementById('cfg-canal-email')?.checked;
  cfg.canales.telefono = !!document.getElementById('cfg-canal-telefono')?.checked;
  cfg.canales.whatsapp = !!document.getElementById('cfg-canal-whatsapp')?.checked;
  // Categor√≠as desde DOM
  var cats = [];
  document.querySelectorAll('.cfg-cat-input').forEach(function(i){ if(i.value.trim()) cats.push(i.value.trim()); });
  if (cats.length) cfg.categorias = cats;
  // FAQ desde DOM
  var faqs = [];
  document.querySelectorAll('.cfg-faq-row').forEach(function(row){
    var q = row.querySelector('.cfg-faq-q');
    var a = row.querySelector('.cfg-faq-a');
    if (q && a && q.value.trim()) faqs.push({ q: q.value.trim(), a: a.value.trim() });
  });
  if (faqs.length) cfg.faq = faqs;
  // Formulario ‚Äî campos extra
  cfg.formulario = cfg.formulario || {};
  cfg.formulario.camposExtra = cfgCollectCampos();
  // Apariencia
  cfg.apariencia.colorPrimario = getVal('cfg-color-primario-hex') || cfg.apariencia.colorPrimario;
  cfg.apariencia.colorSidebar  = getVal('cfg-color-sidebar-hex')  || cfg.apariencia.colorSidebar;

  ArgusConfig.save(cfg);
  showToast('Configuraci√≥n guardada. Se aplica al abrir el portal.', '‚úÖ');
}

function cfgReset() {
  if (!confirm('¬øRestaurar toda la configuraci√≥n a los valores por defecto?')) return;
  ArgusConfig.reset();
  cfgLoad();
  cfgRenderCategorias();
  cfgRenderFaq();
  cfgLoadCanales();
  cfgRenderCampos();
  showToast('Configuraci√≥n restaurada', '‚Ü©Ô∏è');
}

/* ‚îÄ‚îÄ Categor√≠as ‚îÄ‚îÄ */
function cfgRenderCategorias() {
  var list = document.getElementById('cfg-categorias-list');
  if (!list || typeof ArgusConfig === 'undefined') return;
  var cats = ArgusConfig.get().categorias;
  list.innerHTML = cats.map(function(cat, i){
    return '<div class="cfg-cat-row" data-idx="' + i + '">' +
      '<input type="text" class="bo-select-full cfg-cat-input" value="' + escHtml(cat) + '" />' +
      '<button class="bo-btn bo-btn-ghost" style="color:#DC2626;padding:6px 10px" onclick="cfgRemoveCategoria(this)">‚úï</button>' +
      '</div>';
  }).join('');
}
function cfgAddCategoria() {
  var list = document.getElementById('cfg-categorias-list');
  if (!list) return;
  var row = document.createElement('div');
  row.className = 'cfg-cat-row';
  row.innerHTML = '<input type="text" class="bo-select-full cfg-cat-input" placeholder="Nueva categor√≠a..." />' +
    '<button class="bo-btn bo-btn-ghost" style="color:#DC2626;padding:6px 10px" onclick="cfgRemoveCategoria(this)">‚úï</button>';
  list.appendChild(row);
  row.querySelector('input').focus();
}
function cfgRemoveCategoria(btn) { btn.closest('.cfg-cat-row').remove(); }

/* ‚îÄ‚îÄ FAQ ‚îÄ‚îÄ */
function cfgRenderFaq() {
  var list = document.getElementById('cfg-faq-list');
  if (!list || typeof ArgusConfig === 'undefined') return;
  var faqs = ArgusConfig.get().faq;
  list.innerHTML = faqs.map(function(item, i){
    return '<div class="cfg-faq-row">' +
      '<div class="cfg-faq-fields">' +
      '<input type="text" class="bo-select-full cfg-faq-q" placeholder="Pregunta..." value="' + escHtml(item.q) + '" />' +
      '<textarea class="bo-textarea cfg-faq-a" rows="2" placeholder="Respuesta...">' + escHtml(item.a) + '</textarea>' +
      '</div>' +
      '<button class="bo-btn bo-btn-ghost" style="color:#DC2626;font-size:11px;align-self:flex-start;margin-top:4px" onclick="cfgRemoveFaq(this)">‚úï Eliminar</button>' +
      '</div>';
  }).join('');
}
function cfgAddFaq() {
  var list = document.getElementById('cfg-faq-list');
  if (!list) return;
  var row = document.createElement('div');
  row.className = 'cfg-faq-row';
  row.innerHTML = '<div class="cfg-faq-fields">' +
    '<input type="text" class="bo-select-full cfg-faq-q" placeholder="Nueva pregunta..." />' +
    '<textarea class="bo-textarea cfg-faq-a" rows="2" placeholder="Respuesta..."></textarea>' +
    '</div>' +
    '<button class="bo-btn bo-btn-ghost" style="color:#DC2626;font-size:11px;align-self:flex-start;margin-top:4px" onclick="cfgRemoveFaq(this)">‚úï Eliminar</button>';
  list.appendChild(row);
  row.querySelector('input').focus();
}
function cfgRemoveFaq(btn) { btn.closest('.cfg-faq-row').remove(); }

/* ‚îÄ‚îÄ Formulario ‚Äî campos personalizados ‚îÄ‚îÄ */
var CAMPO_TIPOS = [
  { val:'text',     label:'Texto corto' },
  { val:'textarea', label:'Texto largo' },
  { val:'select',   label:'Selecci√≥n (lista)' },
  { val:'number',   label:'N√∫mero' },
  { val:'date',     label:'Fecha' },
  { val:'email',    label:'Email' },
];

function cfgRenderCampos() {
  var list  = document.getElementById('cfg-campos-list');
  var empty = document.getElementById('cfg-campos-empty');
  if (!list || typeof ArgusConfig === 'undefined') return;
  var campos = ArgusConfig.get().formulario.camposExtra || [];
  if (campos.length === 0) {
    list.innerHTML = '';
    if (empty) empty.style.display = 'block';
    return;
  }
  if (empty) empty.style.display = 'none';
  list.innerHTML = campos.map(function(c, i) {
    var tiposOpts = CAMPO_TIPOS.map(function(t) {
      return '<option value="' + t.val + '"' + (c.tipo === t.val ? ' selected' : '') + '>' + t.label + '</option>';
    }).join('');
    var opcionesRow = c.tipo === 'select'
      ? '<div class="cfg-campo-opciones-wrap" style="margin-top:8px">' +
          '<label style="font-size:11px;font-weight:600;color:var(--gray-500);text-transform:uppercase;letter-spacing:.05em">Opciones (una por l√≠nea)</label>' +
          '<textarea class="bo-textarea cfg-campo-opciones" rows="3" placeholder="Opci√≥n A\nOpci√≥n B\nOpci√≥n C">' +
            escHtml((c.opciones||[]).join('\n')) +
          '</textarea>' +
        '</div>'
      : '';
    return '<div class="cfg-campo-row bo-card" style="padding:16px" data-idx="' + i + '">' +
      '<div style="display:flex;align-items:flex-start;gap:12px">' +
        '<div style="flex:1;display:flex;flex-direction:column;gap:8px">' +
          '<div style="display:grid;grid-template-columns:1fr auto;gap:10px">' +
            '<div><label style="font-size:11px;font-weight:600;color:var(--gray-500);text-transform:uppercase;letter-spacing:.05em;display:block;margin-bottom:4px">Pregunta / etiqueta</label>' +
              '<input type="text" class="bo-select-full cfg-campo-label" value="' + escHtml(c.label) + '" placeholder="Ej: ¬øTen√©s testigos?" /></div>' +
            '<div><label style="font-size:11px;font-weight:600;color:var(--gray-500);text-transform:uppercase;letter-spacing:.05em;display:block;margin-bottom:4px">Tipo</label>' +
              '<select class="bo-select-full cfg-campo-tipo" style="min-width:150px" onchange="cfgToggleOpciones(this)">' + tiposOpts + '</select></div>' +
          '</div>' +
          '<div style="display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center">' +
            '<input type="text" class="bo-select-full cfg-campo-placeholder" value="' + escHtml(c.placeholder||'') + '" placeholder="Texto de ayuda (opcional)" />' +
            '<label style="display:flex;align-items:center;gap:6px;font-size:13px;white-space:nowrap;cursor:pointer">' +
              '<input type="checkbox" class="cfg-campo-required"' + (c.requerido ? ' checked' : '') + ' /> Obligatorio' +
            '</label>' +
          '</div>' +
          opcionesRow +
        '</div>' +
        '<button class="bo-btn bo-btn-ghost" style="color:#DC2626;padding:6px 10px;flex-shrink:0" onclick="cfgRemoveCampo(this)" title="Eliminar pregunta">‚úï</button>' +
      '</div>' +
    '</div>';
  }).join('');
}

function cfgToggleOpciones(sel) {
  var row = sel.closest('.cfg-campo-row');
  var wrap = row.querySelector('.cfg-campo-opciones-wrap');
  if (sel.value === 'select') {
    if (!wrap) {
      var opWrap = document.createElement('div');
      opWrap.className = 'cfg-campo-opciones-wrap';
      opWrap.style.marginTop = '8px';
      opWrap.innerHTML = '<label style="font-size:11px;font-weight:600;color:var(--gray-500);text-transform:uppercase;letter-spacing:.05em">Opciones (una por l√≠nea)</label>' +
        '<textarea class="bo-textarea cfg-campo-opciones" rows="3" placeholder="Opci√≥n A\nOpci√≥n B\nOpci√≥n C"></textarea>';
      row.querySelector('.cfg-campo-row > div > div:first-child, .cfg-campo-row div[style]').appendChild(opWrap);
      sel.closest('[style]').querySelector('div').appendChild(opWrap);
    } else {
      wrap.style.display = 'block';
    }
  } else if (wrap) {
    wrap.style.display = 'none';
  }
}

function cfgAddCampo() {
  if (typeof ArgusConfig === 'undefined') return;
  var cfg = ArgusConfig.get();
  cfg.formulario = cfg.formulario || { camposExtra: [] };
  cfg.formulario.camposExtra = cfg.formulario.camposExtra || [];
  cfg.formulario.camposExtra.push({ id: 'campo_' + Date.now(), label: '', tipo: 'text', placeholder: '', requerido: false, opciones: [] });
  ArgusConfig.save(cfg);
  cfgRenderCampos();
  var empty = document.getElementById('cfg-campos-empty');
  if (empty) empty.style.display = 'none';
  // Focus en el nuevo campo
  var rows = document.querySelectorAll('.cfg-campo-row');
  if (rows.length) rows[rows.length - 1].querySelector('.cfg-campo-label').focus();
}

function cfgRemoveCampo(btn) { btn.closest('.cfg-campo-row').remove(); cfgCheckCamposEmpty(); }

function cfgCheckCamposEmpty() {
  var list  = document.getElementById('cfg-campos-list');
  var empty = document.getElementById('cfg-campos-empty');
  if (list && empty) empty.style.display = list.children.length === 0 ? 'block' : 'none';
}

function cfgCollectCampos() {
  var campos = [];
  document.querySelectorAll('.cfg-campo-row').forEach(function(row) {
    var label = row.querySelector('.cfg-campo-label');
    var tipo  = row.querySelector('.cfg-campo-tipo');
    var ph    = row.querySelector('.cfg-campo-placeholder');
    var req   = row.querySelector('.cfg-campo-required');
    var opsTa = row.querySelector('.cfg-campo-opciones');
    if (!label || !label.value.trim()) return;
    var opciones = opsTa ? opsTa.value.split('\n').map(function(o){return o.trim();}).filter(Boolean) : [];
    campos.push({
      id:          'campo_' + label.value.trim().toLowerCase().replace(/[^a-z0-9]/g,'_'),
      label:       label.value.trim(),
      tipo:        tipo ? tipo.value : 'text',
      placeholder: ph ? ph.value.trim() : '',
      requerido:   req ? req.checked : false,
      opciones:    opciones
    });
  });
  return campos;
}

/* ‚îÄ‚îÄ Canales ‚îÄ‚îÄ */
function cfgLoadCanales() {
  if (typeof ArgusConfig === 'undefined') return;
  var c = ArgusConfig.get().canales;
  setCheck('cfg-canal-web',      c.web);
  setCheck('cfg-canal-email',    c.email);
  setCheck('cfg-canal-telefono', c.telefono);
  setCheck('cfg-canal-whatsapp', c.whatsapp);
}

/* ‚îÄ‚îÄ Colores preview ‚îÄ‚îÄ */
function cfgPreviewColor(val) {
  document.documentElement.style.setProperty('--primary', val);
  setVal('cfg-color-primario-hex', val);
  var btn = document.getElementById('cfgPreviewBtn');
  if (btn) btn.style.background = val;
  var badge = document.getElementById('cfgPreviewBadge');
  if (badge) badge.style.color = val;
}
function cfgSyncColor(val) {
  if (/^#[0-9a-fA-F]{6}$/.test(val)) {
    var cp = document.getElementById('cfg-color-primario');
    if (cp) cp.value = val;
    cfgPreviewColor(val);
  }
}
function cfgPreviewSidebar(val) {
  document.documentElement.style.setProperty('--gray-900', val);
  setVal('cfg-color-sidebar-hex', val);
}
function cfgSyncSidebar(val) {
  if (/^#[0-9a-fA-F]{6}$/.test(val)) {
    var cs = document.getElementById('cfg-color-sidebar');
    if (cs) cs.value = val;
    cfgPreviewSidebar(val);
  }
}

/* ‚îÄ‚îÄ utils ‚îÄ‚îÄ */
function getVal(id) { var el = document.getElementById(id); return el ? el.value.trim() : ''; }
function setVal(id, v) { var el = document.getElementById(id); if (el) el.value = v || ''; }
function setCheck(id, v) { var el = document.getElementById(id); if (el) el.checked = !!v; }
function escHtml(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ROLES Y PERMISOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var ROLES_KEY = 'argus_roles_' + (TENANT || 'default');

var PERMISOS_DEF = [
  { id:'ver_casos',          label:'Ver casos',              hint:'Acceder al listado y detalle de casos',              grupo:'Casos' },
  { id:'gestionar_casos',    label:'Crear / editar casos',   hint:'Crear casos manualmente y editar sus datos',         grupo:'Casos' },
  { id:'asignar_casos',      label:'Asignar investigadores', hint:'Cambiar el investigador responsable de un caso',     grupo:'Casos' },
  { id:'cerrar_casos',       label:'Resolver / cerrar casos',hint:'Registrar resoluci√≥n y cerrar casos',                grupo:'Casos' },
  { id:'ver_comunicaciones', label:'Ver comunicaciones',     hint:'Leer el historial de mensajes de cada caso',         grupo:'Casos' },
  { id:'ver_reportes',       label:'Ver reportes',           hint:'Acceder al m√≥dulo de reportes y estad√≠sticas',       grupo:'Reportes' },
  { id:'exportar_datos',     label:'Exportar datos',         hint:'Descargar reportes en PDF / Excel',                  grupo:'Reportes' },
  { id:'ver_auditoria',      label:'Ver auditor√≠a / log',    hint:'Acceder al log de actividad del sistema',            grupo:'Sistema' },
  { id:'gestionar_usuarios', label:'Gestionar usuarios',     hint:'Invitar, editar y desactivar usuarios',              grupo:'Sistema' },
  { id:'configurar_portal',  label:'Configurar portal',      hint:'Editar textos, categor√≠as, FAQ y apariencia',        grupo:'Sistema' },
];

var DEFAULT_ROLES = [
  {
    id: 'admin', nombre: 'Administrador', color: '#0097A7',
    descripcion: 'Acceso completo a todas las funciones del sistema.',
    sistema: true,
    permisos: { ver_casos:true, gestionar_casos:true, asignar_casos:true, cerrar_casos:true,
                ver_comunicaciones:true, ver_reportes:true, exportar_datos:true,
                ver_auditoria:true, gestionar_usuarios:true, configurar_portal:true }
  },
  {
    id: 'compliance', nombre: 'Compliance Officer', color: '#0097A7',
    descripcion: 'Gestiona todos los casos y accede a reportes. No configura el portal.',
    sistema: true,
    permisos: { ver_casos:true, gestionar_casos:true, asignar_casos:true, cerrar_casos:true,
                ver_comunicaciones:true, ver_reportes:true, exportar_datos:true,
                ver_auditoria:false, gestionar_usuarios:false, configurar_portal:false }
  },
  {
    id: 'investigador', nombre: 'Investigador', color: '#EA580C',
    descripcion: 'Trabaja sobre casos asignados. Sin acceso a configuraci√≥n ni usuarios.',
    sistema: true,
    permisos: { ver_casos:true, gestionar_casos:false, asignar_casos:false, cerrar_casos:false,
                ver_comunicaciones:true, ver_reportes:false, exportar_datos:false,
                ver_auditoria:false, gestionar_usuarios:false, configurar_portal:false }
  },
  {
    id: 'legal', nombre: 'Legal Reviewer', color: '#16A34A',
    descripcion: 'Solo lectura de casos de alto riesgo y legales. Puede exportar.',
    sistema: true,
    permisos: { ver_casos:true, gestionar_casos:false, asignar_casos:false, cerrar_casos:false,
                ver_comunicaciones:true, ver_reportes:true, exportar_datos:true,
                ver_auditoria:false, gestionar_usuarios:false, configurar_portal:false }
  },
  {
    id: 'auditor', nombre: 'Auditor Interno', color: '#7C3AED',
    descripcion: 'Solo lectura: casos, reportes y auditor√≠a. Sin gesti√≥n.',
    sistema: true,
    permisos: { ver_casos:true, gestionar_casos:false, asignar_casos:false, cerrar_casos:false,
                ver_comunicaciones:false, ver_reportes:true, exportar_datos:true,
                ver_auditoria:true, gestionar_usuarios:false, configurar_portal:false }
  },
  {
    id: 'rrhh', nombre: 'RRHH', color: '#DC2626',
    descripcion: 'Visualiza casos de acoso y laborales. Sin exportar ni configurar.',
    sistema: true,
    permisos: { ver_casos:true, gestionar_casos:false, asignar_casos:false, cerrar_casos:false,
                ver_comunicaciones:true, ver_reportes:false, exportar_datos:false,
                ver_auditoria:false, gestionar_usuarios:false, configurar_portal:false }
  },
];

function loadRoles() {
  try {
    var s = localStorage.getItem(ROLES_KEY);
    if (s) return JSON.parse(s);
  } catch(e) {}
  return JSON.parse(JSON.stringify(DEFAULT_ROLES));
}
function saveRoles(roles) { localStorage.setItem(ROLES_KEY, JSON.stringify(roles)); }
var ROLES_DATA = loadRoles();

/* ‚îÄ‚îÄ Sub-tabs usuarios/roles ‚îÄ‚îÄ */
function showUsrTab(tab, btn) {
  document.querySelectorAll('.usr-tab').forEach(function(b){ b.classList.remove('active'); });
  document.querySelectorAll('.usr-panel').forEach(function(p){ p.style.display = 'none'; });
  if (btn) btn.classList.add('active');
  var panel = document.getElementById('usrpanel-' + tab);
  if (panel) panel.style.display = 'block';

  var headerActions = document.getElementById('usr-header-actions');
  if (headerActions) {
    headerActions.innerHTML = tab === 'users'
      ? '<button class="bo-btn bo-btn-primary" onclick="showInviteModal()">+ Invitar usuario</button>'
      : '<button class="bo-btn bo-btn-primary" onclick="openRoleModal()">+ Nuevo rol</button>';
  }

  if (tab === 'roles') renderRolesGrid();
  if (tab === 'users') renderUsersTable();
}

/* ‚îÄ‚îÄ Render roles ‚îÄ‚îÄ */
function renderRolesGrid() {
  var grid = document.getElementById('roles-grid');
  if (!grid) return;
  ROLES_DATA = loadRoles();

  grid.innerHTML = ROLES_DATA.map(function(r) {
    var bgLight = hexToLight(r.color);
    var permsOn = PERMISOS_DEF.filter(function(p){ return r.permisos[p.id]; });
    var permsOff = PERMISOS_DEF.filter(function(p){ return !r.permisos[p.id]; });

    var chipsOn  = permsOn.map(function(p){
      return '<span class="role-perm-chip on">‚úì ' + p.label + '</span>';
    }).join('');
    var chipsOff = permsOff.map(function(p){
      return '<span class="role-perm-chip">‚úó ' + p.label + '</span>';
    }).join('');

    return '<div class="role-card">' +
      '<div class="role-card-head">' +
        '<div class="role-card-info">' +
          '<div style="display:flex;align-items:center;gap:8px">' +
            '<span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:' + r.color + ';flex-shrink:0"></span>' +
            '<span class="role-card-name">' + escHtml(r.nombre) + '</span>' +
            (r.sistema ? '<span class="role-sys-badge">Sistema</span>' : '') +
          '</div>' +
          '<div class="role-card-desc">' + escHtml(r.descripcion || '') + '</div>' +
        '</div>' +
        '<div class="role-card-actions">' +
          '<button class="bo-btn bo-btn-ghost" style="font-size:12px" onclick="openRoleModal(\'' + r.id + '\')">Editar</button>' +
          (!r.sistema ? '<button class="bo-btn bo-btn-ghost" style="font-size:12px;color:#DC2626" onclick="deleteRole(\'' + r.id + '\')">Eliminar</button>' : '') +
        '</div>' +
      '</div>' +
      '<div class="role-perm-list">' + chipsOn + chipsOff + '</div>' +
    '</div>';
  }).join('');
}

function hexToLight(hex) {
  return hex + '1A'; // fallback; s√≥lo para bg
}

/* ‚îÄ‚îÄ Matriz de permisos ‚îÄ‚îÄ */
function togglePermsMatrix() {
  var wrap = document.getElementById('perms-matrix-wrap');
  if (!wrap) return;
  var isHidden = wrap.style.display === 'none';
  wrap.style.display = isHidden ? 'block' : 'none';
  if (isHidden) renderPermsMatrix();
}

function renderPermsMatrix() {
  var head = document.getElementById('perms-matrix-head');
  var body = document.getElementById('perms-matrix-body');
  if (!head || !body) return;
  ROLES_DATA = loadRoles();

  // Header: permiso + un th por cada rol
  head.innerHTML = '<th class="perm-matrix-th">Permiso</th>' +
    ROLES_DATA.map(function(r) {
      return '<th class="perm-matrix-th"><span style="color:' + r.color + '">' + escHtml(r.nombre) + '</span></th>';
    }).join('');

  // Body: una fila por permiso
  body.innerHTML = PERMISOS_DEF.map(function(p) {
    var cells = ROLES_DATA.map(function(r) {
      var checked = r.permisos[p.id] ? ' checked' : '';
      return '<td class="perm-matrix-td"><input type="checkbox" class="perm-check" disabled' + checked + ' /></td>';
    }).join('');
    return '<tr><td class="perm-matrix-td" style="font-size:13px;color:var(--black);font-weight:500">' + p.label +
      '<br><span style="font-size:11px;color:var(--gray-400)">' + p.grupo + '</span></td>' + cells + '</tr>';
  }).join('');
}

/* ‚îÄ‚îÄ Modal rol ‚îÄ‚îÄ */
function openRoleModal(roleId) {
  var modal = document.getElementById('roleModal');
  var permsContainer = document.getElementById('roleModalPerms');
  if (!modal || !permsContainer) return;

  var role = roleId ? ROLES_DATA.find(function(r){ return r.id === roleId; }) : null;
  document.getElementById('roleModalTitle').textContent = role ? 'Editar rol: ' + role.nombre : 'Nuevo rol';
  document.getElementById('roleModalId').value = roleId || '';
  setVal('roleModalNombre', role ? role.nombre : '');
  setVal('roleModalDesc',   role ? role.descripcion : '');
  var color = (role && role.color) ? role.color : '#0097A7';
  document.getElementById('roleModalColor').value = color;
  setVal('roleModalColorHex', color);
  updateRolePreview(color, role ? role.nombre : 'Rol');

  // Agrupar permisos
  var grupos = {};
  PERMISOS_DEF.forEach(function(p) {
    if (!grupos[p.grupo]) grupos[p.grupo] = [];
    grupos[p.grupo].push(p);
  });

  var html = '';
  Object.keys(grupos).forEach(function(g) {
    html += '<div style="padding:8px 14px;background:var(--gray-100);font-size:11px;font-weight:700;color:var(--gray-500);text-transform:uppercase;letter-spacing:.06em">' + g + '</div>';
    grupos[g].forEach(function(p) {
      var checked = role ? !!role.permisos[p.id] : false;
      html += '<div class="perm-modal-row">' +
        '<div>' +
          '<div class="perm-modal-label">' + escHtml(p.label) + '</div>' +
          '<div class="perm-modal-hint">' + escHtml(p.hint) + '</div>' +
        '</div>' +
        '<label class="perm-toggle">' +
          '<input type="checkbox" data-perm="' + p.id + '"' + (checked ? ' checked' : '') + ' />' +
          '<span class="perm-toggle-slider"></span>' +
        '</label>' +
      '</div>';
    });
  });
  permsContainer.innerHTML = html;

  // Actualizar preview al cambiar nombre
  document.getElementById('roleModalNombre').oninput = function() {
    updateRolePreview(document.getElementById('roleModalColor').value, this.value || 'Rol');
  };
  document.getElementById('roleModalColor').oninput = function() {
    setVal('roleModalColorHex', this.value);
    updateRolePreview(this.value, getVal('roleModalNombre') || 'Rol');
  };

  modal.style.display = 'flex';
}

function updateRolePreview(color, nombre) {
  var preview = document.getElementById('roleModalPreview');
  if (!preview) return;
  preview.textContent = nombre || 'Rol';
  preview.style.color = color;
  preview.style.background = color + '22';
}

function closeRoleModal() { document.getElementById('roleModal').style.display = 'none'; }

function saveRole() {
  var nombre = getVal('roleModalNombre');
  if (!nombre) { showToast('El nombre del rol es obligatorio', '‚ö†Ô∏è'); return; }

  var roleId = getVal('roleModalId');
  var color  = getVal('roleModalColorHex') || '#0097A7';
  var desc   = getVal('roleModalDesc');

  var permisos = {};
  document.querySelectorAll('#roleModalPerms input[type=checkbox][data-perm]').forEach(function(cb) {
    permisos[cb.dataset.perm] = cb.checked;
  });

  ROLES_DATA = loadRoles();

  if (roleId) {
    var idx = ROLES_DATA.findIndex(function(r){ return r.id === roleId; });
    if (idx !== -1) {
      // Los roles de sistema conservan nombre fijo pero s√≠ se editan permisos y color
      ROLES_DATA[idx].descripcion = desc;
      ROLES_DATA[idx].color       = color;
      ROLES_DATA[idx].permisos    = permisos;
      if (!ROLES_DATA[idx].sistema) ROLES_DATA[idx].nombre = nombre;
    }
  } else {
    var newId = 'rol_' + Date.now();
    ROLES_DATA.push({ id: newId, nombre: nombre, color: color, descripcion: desc, sistema: false, permisos: permisos });
  }

  saveRoles(ROLES_DATA);
  closeRoleModal();
  renderRolesGrid();
  var matrixWrap = document.getElementById('perms-matrix-wrap');
  if (matrixWrap && matrixWrap.style.display !== 'none') renderPermsMatrix();
  showToast('Rol guardado correctamente', '‚úÖ');
}

function deleteRole(roleId) {
  if (!confirm('¬øEliminar este rol? Esta acci√≥n no se puede deshacer.')) return;
  ROLES_DATA = loadRoles().filter(function(r){ return r.id !== roleId; });
  saveRoles(ROLES_DATA);
  renderRolesGrid();
  showToast('Rol eliminado', 'üóëÔ∏è');
}

/* ‚îÄ‚îÄ Usuarios table (din√°mica) ‚îÄ‚îÄ */
var USERS_DATA_KEY = 'argus_users_' + (TENANT || 'default');
var DEMO_USERS = [
  { nombre:'Mar√≠a √Ålvarez',  email:'maria@empresa.com',   rol:'compliance',  jurisdiccion:'Argentina ¬∑ Uruguay', acceso:'Todos',           ultimo:'Hoy, 14:32',    estado:'activo',   color:'#0097A7' },
  { nombre:'Rodrigo Mendoza',email:'rodrigo@empresa.com', rol:'investigador',jurisdiccion:'Argentina',           acceso:'Asignados',       ultimo:'Hoy, 11:05',    estado:'activo',   color:'#D97706' },
  { nombre:'Julia Torres',   email:'julia@empresa.com',   rol:'legal',       jurisdiccion:'Argentina',           acceso:'Legal / Riesgo',  ultimo:'Hoy, 13:18',    estado:'activo',   color:'#059669' },
  { nombre:'Laura Garc√≠a',   email:'laura@empresa.com',   rol:'auditor',     jurisdiccion:'Multi-regi√≥n',        acceso:'Solo lectura',    ultimo:'Ayer, 16:20',   estado:'activo',   color:'#7C3AED' },
  { nombre:'Carlos P√©rez',   email:'carlos@empresa.com',  rol:'rrhh',        jurisdiccion:'Argentina',           acceso:'Acoso / Laboral', ultimo:'20/02/2025',    estado:'inactivo', color:'#DC2626' },
];
function loadUsers() {
  try { var s = localStorage.getItem(USERS_DATA_KEY); if (s) return JSON.parse(s); } catch(e) {}
  localStorage.setItem(USERS_DATA_KEY, JSON.stringify(DEMO_USERS));
  return JSON.parse(JSON.stringify(DEMO_USERS));
}
function saveUsers(u) { localStorage.setItem(USERS_DATA_KEY, JSON.stringify(u)); }

function renderUsersTable() {
  var tbody = document.getElementById('users-table-body');
  if (!tbody) return;
  var users = loadUsers();
  var roles = loadRoles();

  tbody.innerHTML = users.map(function(u) {
    var role = roles.find(function(r){ return r.id === u.rol; }) || { nombre: u.rol, color: '#5F9EA5' };
    var initials = u.nombre.split(' ').map(function(n){ return n[0]; }).slice(0,2).join('').toUpperCase();
    var estadoBg = u.estado === 'activo' ? '#F0FDF4' : '#FEF9C3';
    var estadoCol = u.estado === 'activo' ? '#16A34A' : '#854D0E';
    return '<tr class="bo-table-row">' +
      '<td><div style="display:flex;align-items:center;gap:10px">' +
        '<div class="bo-log-avatar" style="background:' + u.color + '">' + initials + '</div>' +
        '<div><strong>' + escHtml(u.nombre) + '</strong><br/>' +
        '<span style="font-size:12px;color:var(--gray-500)">' + escHtml(u.email) + '</span></div>' +
      '</div></td>' +
      '<td><span class="role-tag" style="background:' + role.color + '22;color:' + role.color + '">' + escHtml(role.nombre) + '</span></td>' +
      '<td>' + escHtml(u.jurisdiccion) + '</td>' +
      '<td>' + escHtml(u.acceso) + '</td>' +
      '<td>' + escHtml(u.ultimo) + '</td>' +
      '<td><span class="status-tag" style="background:' + estadoBg + ';color:' + estadoCol + '">' + (u.estado === 'activo' ? 'Activo' : 'Inactivo') + '</span></td>' +
      '<td><button class="bo-btn bo-btn-ghost" style="font-size:12px" onclick="editUser(' +
        JSON.stringify(u.nombre) + ',' + JSON.stringify(u.email) + ',' + JSON.stringify(u.rol) + ',' +
        JSON.stringify(u.jurisdiccion) + ',' + JSON.stringify(u.acceso) + ',' + JSON.stringify(u.estado) +
        ')">Editar</button></td>' +
    '</tr>';
  }).join('');
}

// Inicializar tabla de usuarios al cargar la vista
document.addEventListener('DOMContentLoaded', function() {
  renderUsersTable();
});

// Cargar config cuando el usuario abre la vista
var _origShowView = showView;
showView = function(name) {
  _origShowView(name);
  if (name === 'configuracion') {
    cfgLoad();
    cfgLoadCanales();
    cfgRenderCategorias();
    cfgRenderFaq();
    cfgRenderCampos();
  }
  if (name === 'usuarios') {
    renderUsersTable();
  }
};

// ‚îÄ‚îÄ Dashboard greeting ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setDashGreeting() {
  var h = new Date().getHours();
  var g = h < 12 ? 'Buenos d√≠as' : h < 19 ? 'Buenas tardes' : 'Buenas noches';
  var el = document.getElementById('dashGreeting');
  if (el) el.textContent = g;
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg, icon) {
  var t = document.getElementById('boToast');
  if (!t) return;
  document.getElementById('boToastMsg').textContent = msg;
  document.getElementById('boToastIcon').textContent = icon || '‚úÖ';
  t.style.display = 'flex';
  clearTimeout(window._toastTimer);
  window._toastTimer = setTimeout(function() { t.style.display = 'none'; }, 4000);
}

// ‚îÄ‚îÄ Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showNewCase() {
  document.getElementById('newCaseModal').style.display = 'flex';
}
function closeModal(e) {
  if (e.target.id === 'newCaseModal') e.target.style.display = 'none';
}
function createCase() {
  var tipo = document.getElementById('newCaseTipo');
  var riesgo = document.getElementById('newCaseRiesgo');
  var area = document.getElementById('newCaseArea');
  var inv = document.getElementById('newCaseInv');

  if (!tipo || tipo.value === '‚Äî Seleccion√° ‚Äî') { alert('Seleccion√° el tipo de denuncia.'); return; }
  if (!riesgo || riesgo.value === '‚Äî Evaluar ‚Äî') { alert('Seleccion√° el nivel de riesgo.'); return; }

  var riesgoMap = { 'Bajo':'low', 'Medio':'medium', 'Alto':'high', 'Cr√≠tico':'critical' };
  var riesgoCss = riesgoMap[riesgo.value] || 'medium';
  var invValue = inv && inv.value !== 'Sin asignar' ? inv.value.split(' (')[0] : '‚Äî';
  var areaVal = area && area.value !== '‚Äî Seleccion√° ‚Äî' ? area.value : 'Sin especificar';

  var lastId = parseInt((CASOS_DATA[0]?.id || 'ARG-2025-0044').split('-')[2]);
  var newId = 'ARG-2025-' + String(lastId + 1).padStart(4, '0');
  var today = new Date();
  var dateStr = String(today.getDate()).padStart(2,'0') + '/' + String(today.getMonth()+1).padStart(2,'0') + '/' + today.getFullYear();

  CASOS_DATA.unshift({
    id: newId,
    tipo: tipo.value,
    area: areaVal,
    canal: 'Manual',
    riesgo: riesgoCss,
    estado: 'new',
    anon: 'No',
    inv: invValue,
    sla: '60',
    sla_s: 'ok',
    fecha: dateStr
  });
  saveCasos();

  document.getElementById('newCaseModal').style.display = 'none';
  tipo.selectedIndex = 0;
  riesgo.selectedIndex = 0;
  if (area) area.selectedIndex = 0;
  if (inv) inv.selectedIndex = 0;

  showView('casos');
  showToast('Caso ' + newId + ' creado correctamente', '‚úÖ');
}

// ‚îÄ‚îÄ Notifications ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleNotifs() { /* placeholder */ }

// ‚îÄ‚îÄ Canvas chart (simple bars) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('load', () => {
  const canvas = document.getElementById('casesChart');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.parentElement.clientWidth - 40;
  const H = 180;
  canvas.width = W;
  canvas.height = H;

  const months = ['Sep','Oct','Nov','Dic','Ene','Feb'];
  const received = [8, 12, 7, 15, 11, 9];
  const closed =   [5,  9, 6, 12,  8, 11];
  const maxV = Math.max(...received, ...closed);
  const barW = 18;
  const gap = W / months.length;
  const padTop = 20;
  const padBot = 24;
  const chartH = H - padTop - padBot;

  ctx.font = '11px Inter, sans-serif';
  ctx.fillStyle = '#8CBDC3';
  ctx.textAlign = 'center';

  months.forEach((m, i) => {
    const x = gap * i + gap / 2;
    const rH = (received[i] / maxV) * chartH;
    const cH = (closed[i] / maxV) * chartH;

    // Received bar
    ctx.fillStyle = '#0097A7';
    ctx.beginPath();
    ctx.roundRect(x - barW - 2, H - padBot - rH, barW, rH, [4, 4, 0, 0]);
    ctx.fill();

    // Closed bar
    ctx.fillStyle = '#16A34A';
    ctx.beginPath();
    ctx.roundRect(x + 2, H - padBot - cH, barW, cH, [4, 4, 0, 0]);
    ctx.fill();

    // Label
    ctx.fillStyle = '#007A87';
    ctx.fillText(m, x, H - 4);
  });
});

function updateDashboard(days) { /* live filter ‚Äî placeholder */ }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EXPORTAR PDF / CSV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

/* Helpers ‚îÄ‚îÄ */
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EXPORTAR ‚Äî usa iframe oculto (no requiere permitir popups)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

var PRINT_CSS = [
  'body{font-family:system-ui,sans-serif;color:#111;margin:0;padding:24px 28px;font-size:12px}',
  '.ph{display:flex;justify-content:space-between;align-items:flex-start;border-bottom:2.5px solid #0097A7;padding-bottom:12px;margin-bottom:18px}',
  '.logo{font-size:20px;font-weight:900;color:#0097A7;letter-spacing:-.03em}',
  '.meta{font-size:11px;color:#666;text-align:right;line-height:1.7}',
  '.sec{font-size:11px;font-weight:700;color:#002B2E;text-transform:uppercase;letter-spacing:.06em;margin:18px 0 8px;border-left:3px solid #0097A7;padding-left:7px}',
  /* KPIs */
  '.bo-kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:4px}',
  '.bo-kpi-card{border:1px solid #dde8ea;border-radius:8px;padding:12px 14px;background:#fafefe}',
  '.bo-kpi-label{font-size:9px;text-transform:uppercase;letter-spacing:.06em;color:#5F9EA5;font-weight:600}',
  '.bo-kpi-value{font-size:26px;font-weight:800;color:#002B2E;margin:4px 0 2px}',
  '.bo-kpi-delta{font-size:10px}',
  '.bo-kpi-icon{display:none}',
  /* Table */
  'table{width:100%;border-collapse:collapse}',
  'th{background:#f0f7f8;padding:6px 8px;text-align:left;font-size:9px;text-transform:uppercase;letter-spacing:.05em;color:#5F9EA5;border-bottom:2px solid #cce8eb;font-weight:700;white-space:nowrap}',
  'td{padding:6px 8px;border-bottom:1px solid #eef5f6;vertical-align:middle}',
  'code{font-family:monospace;font-size:9px;background:#e0f7fa;padding:1px 5px;border-radius:3px;color:#006064}',
  '.risk-tag,.status-tag,.sla-tag{display:inline-block;padding:2px 7px;border-radius:100px;font-size:9px;font-weight:700}',
  '.risk-critical{background:#fef2f2;color:#dc2626}.risk-high{background:#fff7ed;color:#ea580c}',
  '.risk-medium{background:#fefce8;color:#ca8a04}.risk-low{background:#f0fdf4;color:#16a34a}',
  '.status-new{background:#e0f7fa;color:#0097a7}.status-investigating{background:#fff7ed;color:#ea580c}',
  '.status-review{background:#f5f3ff;color:#7c3aed}.status-closed-ok{background:#f0fdf4;color:#16a34a}',
  '.status-closed-no{background:#eaf6f7;color:#5f9ea5}',
  '.sla-ok{background:#f0fdf4;color:#16a34a}.sla-warn{background:#fff7ed;color:#ea580c}.sla-over{background:#fef2f2;color:#dc2626}',
  '.bo-unassigned{color:#9ca3af;font-style:italic;font-size:9px}',
  '.bo-table-link{display:none}.bo-checkbox{display:none}',
  'button{display:none}',
  '.print-footer{margin-top:18px;font-size:9px;color:#9ca3af;text-align:center;border-top:1px solid #eee;padding-top:8px}',
  '@media print{body{padding:10px}@page{size:landscape;margin:12mm}}',
].join('');

function _printViaIframe(html) {
  var old = document.getElementById('__print_frame');
  if (old) old.remove();

  var iframe = document.createElement('iframe');
  iframe.id = '__print_frame';
  iframe.style.cssText = 'position:fixed;top:0;left:0;width:0;height:0;border:none;opacity:0;pointer-events:none';
  document.body.appendChild(iframe);

  var doc = iframe.contentDocument || iframe.contentWindow.document;
  doc.open();
  doc.write(html);
  doc.close();

  // setTimeout m√°s confiable que onload con doc.write
  setTimeout(function() {
    try { iframe.contentWindow.focus(); iframe.contentWindow.print(); }
    catch(e) { showToast('No se pudo abrir el di√°logo de impresi√≥n', '‚ö†Ô∏è'); }
  }, 600);
}

function _buildPrintHeader(empresa, fecha, titulo, subtitulo) {
  return '<div class="ph">' +
    '<div><span class="logo">Argus<span style="color:#0097A7">.</span></span>' +
      '<div style="font-size:11px;color:#666;margin-top:2px">' + empresa + ' ¬∑ Back Office</div></div>' +
    '<div class="meta">' + titulo + '<br>' + (subtitulo ? subtitulo + '<br>' : '') + fecha + ' ¬∑ <strong>Confidencial</strong></div>' +
  '</div>';
}

/* ‚îÄ‚îÄ Dashboard PDF ‚îÄ‚îÄ */
function exportDashPdf() {
  var empresa  = (window.ArgusConfig ? ArgusConfig.get().empresa.nombre : '') || 'Argus';
  var fecha    = new Date().toLocaleDateString('es-AR', {year:'numeric', month:'long', day:'numeric'});
  var kpiGrid  = document.querySelector('.bo-kpi-grid');
  var dashWrap = document.querySelector('#view-dashboard .bo-table-wrap');

  var body = _buildPrintHeader(empresa, fecha, 'Reporte de Dashboard');
  body += '<div class="sec">Indicadores clave</div>';
  body += kpiGrid ? kpiGrid.outerHTML : '<p style="color:#999">Sin datos de KPIs</p>';
  if (dashWrap) {
    body += '<div class="sec">Casos recientes</div>' + dashWrap.outerHTML;
  }
  body += '<div class="print-footer">Generado por Argus Compliance ¬∑ ' + fecha + ' ¬∑ Documento confidencial ‚Äî uso interno</div>';

  _printViaIframe('<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><title>Dashboard ¬∑ ' + empresa + '</title>' +
    '<style>' + PRINT_CSS + '</style></head><body>' + body + '</body></html>');
  showToast('Preparando PDF del dashboard‚Ä¶', 'üñ®Ô∏è');
}

/* ‚îÄ‚îÄ Casos PDF ‚îÄ‚îÄ */
function exportCasosPdf() {
  var empresa = (window.ArgusConfig ? ArgusConfig.get().empresa.nombre : '') || 'Argus';
  var fecha   = new Date().toLocaleDateString('es-AR', {year:'numeric', month:'long', day:'numeric'});

  // Asegurar que la tabla de casos est√© renderizada
  if (!document.getElementById('casosTableBody') ||
      document.getElementById('casosTableBody').children.length === 0) {
    renderCasosTable();
  }

  var tabla    = document.querySelector('#view-casos .bo-table');
  var rowCount = tabla ? tabla.querySelectorAll('tbody tr').length : 0;
  var tableHtml = tabla ? tabla.outerHTML : '<p style="color:#999">Sin casos para mostrar</p>';

  var body = _buildPrintHeader(empresa, fecha, 'Repositorio de casos', rowCount + ' casos');
  body += tableHtml;
  body += '<div class="print-footer">Generado por Argus Compliance ¬∑ ' + fecha + ' ¬∑ Confidencial ‚Äî uso interno</div>';

  _printViaIframe('<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><title>Casos ¬∑ ' + empresa + '</title>' +
    '<style>' + PRINT_CSS + '</style></head><body>' + body + '</body></html>');
  showToast('Preparando PDF de casos‚Ä¶', 'üñ®Ô∏è');
}

/* ‚îÄ‚îÄ Casos CSV ‚îÄ‚îÄ */
function exportCasosCsv() {
  var riskMap = { critical:'CR√çTICO', high:'ALTO', medium:'MEDIO', low:'BAJO' };
  var stMap   = { new:'Nuevo', eval:'En evaluaci√≥n', review:'En revisi√≥n',
                  investigating:'Investigando', 'closed-ok':'Cerrado', 'closed-no':'Desestimado' };

  // Obtener casos visibles seg√∫n filtros activos
  var tbody = document.getElementById('casosTableBody');
  var rows;
  if (tbody && tbody.children.length > 0) {
    var visibleIds = Array.from(tbody.querySelectorAll('td:nth-child(2) code'))
                         .map(function(el){ return el.textContent.trim(); });
    rows = visibleIds.length > 0
      ? CASOS_DATA.filter(function(c){ return visibleIds.indexOf(c.id) !== -1; })
      : CASOS_DATA;
  } else {
    rows = CASOS_DATA;
  }

  if (!rows || rows.length === 0) {
    showToast('No hay casos para exportar', '‚ö†Ô∏è'); return;
  }

  var headers = ['ID','Tipo','√Årea','Canal','Riesgo','Estado','An√≥nimo','Investigador','SLA (d√≠as)','Fecha'];
  var csvLines = [headers.map(function(h){ return '"' + h + '"'; }).join(',')];
  rows.forEach(function(c) {
    csvLines.push([
      c.id, c.tipo, c.area, c.canal,
      riskMap[c.riesgo] || c.riesgo,
      stMap[c.estado]   || c.estado,
      c.anon, c.inv,
      c.sla_s === 'over' ? 'VENCIDO' : c.sla,
      c.fecha
    ].map(function(v){ return '"' + String(v||'').replace(/"/g,'""') + '"'; }).join(','));
  });

  var empresa  = (window.ArgusConfig ? ArgusConfig.get().empresa.nombre : 'argus') || 'argus';
  var filename = 'casos_' + empresa.toLowerCase().replace(/\s+/g,'-') + '_' + new Date().toISOString().slice(0,10) + '.csv';

  var blob = new Blob(['\uFEFF' + csvLines.join('\r\n')], { type: 'text/csv;charset=utf-8;' });
  var url  = URL.createObjectURL(blob);
  var a    = document.createElement('a');
  a.href = url; a.download = filename; a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  setTimeout(function(){ URL.revokeObjectURL(url); document.body.removeChild(a); }, 600);
  showToast(rows.length + ' casos exportados ‚Üí ' + filename, 'üìä');
}

// Inicializar UI del tenant cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', function() {
  if (TENANT) initTenantUI();
});
</script>

</body>
</html>
